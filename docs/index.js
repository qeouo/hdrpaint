/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (function() { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/blendfuncs/add.js":
/*!*******************************!*\
  !*** ./src/blendfuncs/add.js ***!
  \*******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n\n\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].blendfuncs.add = function (dst, d_idx, src, s_idx, alpha, power) {\n  var src_alpha = src[s_idx + 3] * alpha;\n  var dst_r = 1 - src_alpha;\n  var src_r = power * src_alpha;\n  dst[d_idx + 0] = dst[d_idx + 0] + src[s_idx + 0] * src_r;\n  dst[d_idx + 1] = dst[d_idx + 1] + src[s_idx + 1] * src_r;\n  dst[d_idx + 2] = dst[d_idx + 2] + src[s_idx + 2] * src_r;\n};\n\n//# sourceURL=webpack://hdrpaint/./src/blendfuncs/add.js?");

/***/ }),

/***/ "./src/blendfuncs/mul.js":
/*!*******************************!*\
  !*** ./src/blendfuncs/mul.js ***!
  \*******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n\n\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].blendfuncs.mul = function (dst, d_idx, src, s_idx, alpha, power) {\n  var src_alpha = src[s_idx + 3] * alpha;\n  var dst_r = 1 - src_alpha;\n  var src_r = power * src_alpha;\n  dst[d_idx + 0] = dst[d_idx + 0] * (dst_r + src[s_idx + 0] * src_r);\n  dst[d_idx + 1] = dst[d_idx + 1] * (dst_r + src[s_idx + 1] * src_r);\n  dst[d_idx + 2] = dst[d_idx + 2] * (dst_r + src[s_idx + 2] * src_r);\n};\n\n//# sourceURL=webpack://hdrpaint/./src/blendfuncs/mul.js?");

/***/ }),

/***/ "./src/blendfuncs/normal.js":
/*!**********************************!*\
  !*** ./src/blendfuncs/normal.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n\n\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].blendfuncs.normal = function (dst, d_idx, src, s_idx, alpha, power) {\n  var src_alpha = src[s_idx + 3] * alpha;\n  var sa = src[s_idx + 3] * alpha;\n  var da = dst[d_idx + 3] * (1 - sa);\n  var dst_r = 1 - sa;\n  var r = da + sa;\n\n  if (r == 0) {\n    return;\n  }\n\n  r = 1 / r;\n  da *= r;\n  sa *= r;\n  sa = power * sa;\n  dst[d_idx + 0] = dst[d_idx + 0] * da + src[s_idx + 0] * sa;\n  dst[d_idx + 1] = dst[d_idx + 1] * da + src[s_idx + 1] * sa;\n  dst[d_idx + 2] = dst[d_idx + 2] * da + src[s_idx + 2] * sa;\n  dst[d_idx + 3] = dst[d_idx + 3] * dst_r + src_alpha;\n};\n\n//# sourceURL=webpack://hdrpaint/./src/blendfuncs/normal.js?");

/***/ }),

/***/ "./src/blendfuncs/sub.js":
/*!*******************************!*\
  !*** ./src/blendfuncs/sub.js ***!
  \*******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n\n\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].blendfuncs.sub = function (dst, d_idx, src, s_idx, alpha, power) {\n  var src_alpha = src[s_idx + 3] * alpha;\n  var dst_r = 1 - src_alpha;\n  var src_r = power * src_alpha;\n  dst[d_idx + 0] = dst[d_idx + 0] - src[s_idx + 0] * src_r;\n  dst[d_idx + 1] = dst[d_idx + 1] - src[s_idx + 1] * src_r;\n  dst[d_idx + 2] = dst[d_idx + 2] - src[s_idx + 2] * src_r;\n};\n\n//# sourceURL=webpack://hdrpaint/./src/blendfuncs/sub.js?");

/***/ }),

/***/ "./src/blendfuncs/transmit.js":
/*!************************************!*\
  !*** ./src/blendfuncs/transmit.js ***!
  \************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n\n\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].blendfuncs.transmit = function (dst, d_idx, src, s_idx, alpha, power) {\n  var src_alpha = src[s_idx + 3] * alpha;\n  var dst_r = 1 - src_alpha;\n  var src_r = power * src_alpha;\n  dst[d_idx + 0] = dst[d_idx + 0] * dst_r * src[s_idx + 0] + src[s_idx + 0] * src_r;\n  dst[d_idx + 1] = dst[d_idx + 1] * dst_r * src[s_idx + 1] + src[s_idx + 1] * src_r;\n  dst[d_idx + 2] = dst[d_idx + 2] * dst_r * src[s_idx + 2] + src[s_idx + 2] * src_r;\n  dst[d_idx + 3] = dst[d_idx + 3] * dst_r + src_alpha;\n};\n\n//# sourceURL=webpack://hdrpaint/./src/blendfuncs/transmit.js?");

/***/ }),

/***/ "./src/brush.js":
/*!**********************!*\
  !*** ./src/brush.js ***!
  \**********************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Brush; }\n/* harmony export */ });\n/* harmony import */ var _lib_util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lib/util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _commandlog_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./commandlog.js */ \"./src/commandlog.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _redraw_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./redraw.js */ \"./src/redraw.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./layer.js */ \"./src/layer.js\");\n\n\n\n\n\n\n\nlet refresh_flg = false;\nlet pen_preview_img;\nlet pen_preview_command; //ブラシの描画プレビュー作成用のコマンドオブジェクト\n\nlet brush_id_count = 0;\n\nvar getBrushFromDiv = function (div) {\n  var result_brush = null;\n  return _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.find(function (a) {\n    return a.dom === div;\n  });\n};\n\nvar brushselect = function (e) {\n  //ブラシー一覧クリック時、クリックされたものをアクティブ化する\n  var brush = getBrushFromDiv(e.currentTarget);\n  brush.select();\n  e.stopPropagation();\n};\n\nvar drag_brush = null;\n\nvar DragStart = function (event) {\n  //ドラッグ開始\n  drag_brush = getBrushFromDiv(event.currentTarget); //     event.dataTransfer.setData(\"text\", drag_brush.id);\n\n  event.stopPropagation();\n}; //ドラッグ＆ドロップによるブラシ順編集\n\n\nvar dragover_handler = function (event) {\n  event.preventDefault();\n  event.dataTransfer.dropEffect = \"move\";\n};\n\nvar DragEnter = function (event) {\n  //ドラッグ移動時\n  var drop_brush = getBrushFromDiv(event.currentTarget);\n  event.stopPropagation();\n\n  if (drag_brush === drop_brush) {\n    //自分自身の場合は無視\n    return;\n  }\n\n  var num = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.indexOf(drag_brush);\n  var num2 = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.indexOf(drop_brush);\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.splice(num, 1);\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.splice(num2, 0, drag_brush);\n  Brush.refreshBrush();\n};\n\nclass Brush {\n  //ブラシ\n  constructor() {\n    this.name = \"\";\n    this.color_effect = [1, 1, 1, 1];\n    this.weight = 3.0;\n    this.softness = 0.0;\n    this.overlap = 0;\n    this.alpha = 1.0;\n    this.antialias = 0;\n    this.eraser = 0;\n    this.weight_pressure_effect = 0;\n    this.alpha_pressure_effect = 0;\n    this.stroke_correction = 1;\n    this.stroke_interpolation = 1;\n    this.shortcut = '';\n    var html = ` \n\t\t\t\t<img draggable=\"false\">\n\t\t\t\t<span class=\"name\"></span>\n\t\t\t\t<div class=\"attributes\"></div>\n\t\t\t`;\n    var dom = document.createElement(\"div\");\n    dom.insertAdjacentHTML('beforeend', html);\n    dom.classList.add(\"brush\");\n    dom.setAttribute(\"draggable\", \"true\");\n    dom.addEventListener(\"click\", brushselect);\n    dom.addEventListener(\"dragstart\", DragStart);\n    dom.addEventListener(\"dragover\", dragover_handler);\n    dom.addEventListener(\"dragenter\", DragEnter); //binder.bindNodes(dom,this);\n\n    binder.bind(dom.querySelector(\".name\"), \"\", this, [\"shortcut\", \"name\"], function (variables) {\n      return \"[\" + variables[0] + \"]\" + variables[1];\n    });\n    this.dom = dom;\n  }\n\n  static init() {\n    document.querySelector(\"#up_brush\").addEventListener(\"click\", function () {\n      var num = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.indexOf(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_brush);\n\n      if (num <= 0) {\n        return;\n      }\n\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.splice(num, 1);\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.splice(num - 1, 0, _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_brush);\n      Brush.refreshBrush();\n    });\n    document.querySelector(\"#down_brush\").addEventListener(\"click\", function () {\n      var num = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.indexOf(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_brush);\n\n      if (num + 1 >= _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.length) {\n        return;\n      }\n\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.splice(num, 1);\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.splice(num + 1, 0, _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_brush);\n      Brush.refreshBrush();\n    });\n    document.querySelector(\"#overwrite_brush\").addEventListener(\"click\", function () {\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_brush.overwrite();\n    });\n    document.querySelector(\"#create_brush\").addEventListener(\"click\", function () {\n      var brush = Brush.create();\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.push(brush);\n      brush.overwrite();\n      brush.select();\n      Brush.refreshBrush();\n    });\n    document.querySelector(\"#delete_brush\").addEventListener(\"click\", function () {\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_brush[\"delete\"]();\n    }); //ブラシプレビュー準備\n\n    pen_preview_command = new _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].commandObjs.brush();\n    var param = pen_preview_command.param;\n    var pen_preview = document.getElementById('pen_preview');\n    pen_preview_img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"](pen_preview.width, pen_preview.height);\n    param.layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].createLayer(pen_preview_img, 0);\n    var points = [];\n    var xs = [-1, -0.7, -0.3, 0.3, 0.7, 1];\n\n    for (var i = 0; i < xs.length; i++) {\n      var x = xs[i];\n      var point = {\n        \"pos\": new _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec2(),\n        \"pressure\": 0\n      };\n      point.pos[0] = (x * 0.8 + 1) * (pen_preview.width >>> 1);\n      point.pos[1] = (Math.sin(x * Math.PI) * 0.7 + 1) * (pen_preview.height >>> 1);\n      point.pressure = 1 - i / (xs.length - 1);\n      points.push(point);\n    }\n\n    param.points = points;\n    param.color_effect = new Float32Array([1.0, 1.0, 1.0, 1.0]);\n    param.undo_data = {};\n  } //削除\n\n\n  delete() {\n    var num = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.indexOf(this);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.splice(num, 1);\n\n    if (num >= _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.length) {\n      num = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.length - 1;\n    }\n\n    if (num >= 0) {\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes[num].select();\n    }\n\n    Brush.refreshBrush();\n  } //現在のブラシID 作るたびインクリメントされる\n\n\n  static create() {\n    var brush = new Brush();\n    brush.id = brush_id_count;\n    brush_id_count++; //Hdrpaint.brushes.push(brush);\n\n    brush.name = \"brush\" + (\"0000\" + brush.id).slice(-4);\n    Brush.refreshBrush(brush); //refreshBrush();\n    //brush.select();\n\n    return brush;\n  }\n\n  refresh() {\n    Brush.refreshBrush(this);\n    Brush.refreshPen(this);\n  }\n\n  overwrite() {\n    //現在の内容でアクティブブラシを上書き\n    var brush = this;\n    var members = Object.keys(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brush_status);\n    members.forEach(member => {\n      if (member === \"id\") return;\n      brush[member] = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brush_status[member];\n    });\n    brush.refresh();\n  }\n\n  delete() {\n    var num = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.indexOf(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_brush);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.splice(num, 1);\n    Brush.refreshBrush();\n  }\n\n  static setParam(param) {\n    var brush = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brush_status;\n    param.color = new Float32Array(4);\n    param.color[0] = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].color[0];\n    param.color[1] = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].color[1];\n    param.color[2] = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].color[2];\n    param.color[3] = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].color[3];\n    param.weight = Number(brush.weight);\n    param.softness = Number(brush.softness);\n    param.antialias = Number(brush.antialias);\n    param.eraser = Number(brush.eraser);\n    param.alpha = brush.alpha;\n    param.overlap = parseInt(brush.overlap);\n    param.pressure_effect_flgs = 1 * Number(brush.weight_pressure_effect) | 2 * Number(brush.alpha_pressure_effect);\n    param.alpha_pressure_effect = brush.alpha_pressure_effect;\n    param.stroke_interpolation = brush.stroke_interpolation;\n  }\n\n  static refreshPen(brush) {\n    var param = pen_preview_command.param;\n\n    if (!brush) {\n      Brush.setParam(param);\n    } else {\n      param.color = new Float32Array([0, 0, 0, 1]);\n      param.weight = parseFloat(brush[\"weight\"]);\n      param.softness = parseFloat(brush[\"softness\"]);\n      param.antialias = brush.antialias;\n      param.alpha = brush.alpha;\n      param.eraser = brush.eraser;\n      param.overlap = parseInt(brush.overlap);\n      param.pressure_effect_flgs = 1 * brush.weight_pressure_effect | 2 * brush.alpha_pressure_effect;\n      param.alpha_pressure_effect = brush.alpha_pressure_effect;\n      param.stroke_interpolation = brush.stroke_interpolation;\n    }\n\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].painted_mask.fill(0);\n\n    if (param.eraser) {\n      //消しゴムの場合は黒でクリア\n      var data = pen_preview_img.data;\n      var size = data.length;\n\n      for (var i = 0; i < size; i += 4) {\n        data[i] = 0;\n        data[i + 1] = 0;\n        data[i + 2] = 0;\n        data[i + 3] = 1;\n      }\n    } else {\n      //通常ブラシの場合は透明でクリア\n      pen_preview_img.clear();\n    }\n\n    var points = pen_preview_command.param.points;\n\n    for (var li = 1; li < points.length; li++) {\n      pen_preview_command.draw(li);\n    }\n\n    var dataurl = pen_preview_img.toDataURL();\n\n    if (brush) {\n      brush.dom.querySelector(\"img\").src = dataurl;\n    } else {\n      document.getElementById(\"pen_preview\").src = dataurl;\n    }\n  }\n\n  static refreshPreview() {\n    if (!refresh_flg) {\n      window.requestAnimationFrame(Brush.refreshPreview_);\n      refresh_flg = true;\n    }\n  }\n\n  static refreshPreview_() {\n    Brush.refreshPen();\n    refresh_flg = false;\n  }\n\n  select() {\n    //アクティブブラシ変更\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_brush = this;\n\n    for (var bi = 0; bi < _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.length; bi++) {\n      var brush = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes[bi];\n\n      if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_brush !== brush) {\n        //アクティブブラシ以外の表示を非アクティブにする\n        brush.dom.classList.remove(\"active\");\n      } else {\n        brush.dom.classList.add(\"active\");\n      }\n    } //アクティブブラシパラメータ更新\n\n\n    var brush = this;\n\n    if (!brush) {\n      return;\n    }\n\n    var members = Object.keys(brush);\n    members.forEach(member => {\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brush_status[member] = brush[member];\n    }); //ブラシ選択状態にする\n\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_tool = \"pen\";\n    Brush.refreshPreview();\n  }\n\n  static refreshBrush(brush) {\n    //ブラシ一覧更新\n    if (!brush) {\n      var container = document.getElementById(\"brushes_container\"); //子ブラシセット\n\n      while (container.firstChild) container.removeChild(container.firstChild);\n\n      for (var li = 0; li < _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.length; li++) {\n        container.appendChild(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes[li].dom);\n      }\n    } else {//\t\t\tvar div= brush.dom.getElementsByClassName(\"name\")[0];\n      //\t\t\tdiv.innerHTML=\"[\" + brush.shortcut + \"]\"  + brush.name;\n    }\n  }\n\n}\n;\n\n//# sourceURL=webpack://hdrpaint/./src/brush.js?");

/***/ }),

/***/ "./src/command/changeLayerAttribute.js":
/*!*********************************************!*\
  !*** ./src/command/changeLayerAttribute.js ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n\n\n\n\nclass ChangeLayerAttribute extends _commandbase_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"] {\n  //レイヤパラメータ変更\n  undo() {\n    this.f(this.undo_data.value);\n  }\n\n  f(value) {\n    var param = this.param;\n    var name = param.name;\n    var layer = _layer_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].findById(param.layer_id);\n\n    if (!this.undo_data) {\n      this.undo_data = {\n        value: layer[name]\n      };\n    }\n\n    layer[name] = value;\n    layer.refreshDiv();\n\n    if (layer.type === 2) {\n      layer.registRefreshThumbnail();\n    }\n\n    layer.parent.bubbleComposite();\n  }\n\n  func() {\n    this.f(this.param.value);\n  }\n\n}\n\n;\nChangeLayerAttribute.prototype.name = \"changeLayerAttribute\";\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].commandObjs.changeLayerAttribute = ChangeLayerAttribute;\n\n//# sourceURL=webpack://hdrpaint/./src/command/changeLayerAttribute.js?");

/***/ }),

/***/ "./src/command/changeModifierAttribute.js":
/*!************************************************!*\
  !*** ./src/command/changeModifierAttribute.js ***!
  \************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n //モディファイアパラメータ変更\n\nvar Command = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].Command;\n\nCommand[\"changeModifierAttribute\"] = function () {\n  return function (log, undo_flg) {\n    var param = log.param;\n    var name = param.name;\n    var value = param.value;\n    var layer = Layer.findById(param.layer_id);\n\n    if (undo_flg) {\n      value = log.undo_data.value;\n    }\n\n    if (!log.undo_data) {\n      log.undo_data = {\n        \"value\": layer[name]\n      };\n    }\n\n    layer[name] = value;\n    layer.refreshDiv();\n    layer.parent.bubbleComposite();\n  };\n}();\n\n//# sourceURL=webpack://hdrpaint/./src/command/changeModifierAttribute.js?");

/***/ }),

/***/ "./src/command/clear.js":
/*!******************************!*\
  !*** ./src/command/clear.js ***!
  \******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n\n\n\n\nclass Clear extends _commandbase_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"] {\n  func() {\n    //全クリア\n    var param = this.param;\n    var layer = _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].findById(param.layer_id);\n    var layer_img = layer.img;\n    var range = param.range;\n\n    if (!range) {\n      range = {};\n      range.x = 0;\n      range.y = 0;\n      range.w = layer_img.width;\n      range.h = layer_img.height;\n    }\n\n    if (!this.undo_data) {\n      var undo_data = {};\n      this.undo_data = undo_data;\n      var dif = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].createDif(layer, range.x, range.y, range.w, range.h);\n      undo_data.difs = [];\n      undo_data.difs.push(dif);\n    }\n\n    layer_img.clear(range.x, range.y, range.w, range.h);\n    layer.refreshImg();\n  }\n\n}\n\n;\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].commandObjs.clear = Clear;\n\n//# sourceURL=webpack://hdrpaint/./src/command/clear.js?");

/***/ }),

/***/ "./src/command/commandbase.js":
/*!************************************!*\
  !*** ./src/command/commandbase.js ***!
  \************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ CommandBase; }\n/* harmony export */ });\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n\n\nclass CommandBase {\n  constructor() {\n    this.param = {};\n    this.undo_data = null;\n  }\n\n  undo() {\n    //アンドゥ処理\n    var difs = this.undo_data.difs;\n\n    if (difs) {\n      //画像戻す\n      var param = this.param;\n      var layer_id = param.layer_id;\n      var layer = _layer_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].findById(layer_id);\n\n      for (var di = difs.length; di--;) {\n        var dif = difs[di];\n        _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].copy(layer.img, dif.x, dif.y, dif.img, 0, 0, dif.img.width, dif.img.height);\n        layer.refreshImg(dif.x, dif.y, dif.img.width, dif.img.height);\n      }\n    }\n  }\n\n  func() {//メイン処理\n  }\n\n  toString() {\n    var param_txt = \"\";\n    var param = this.param;\n    var keys = Object.keys(param);\n\n    for (var ki = 0; ki < keys.length; ki++) {\n      var key = keys[ki];\n\n      if (ki) {\n        param_txt += \",\";\n      }\n\n      param_txt += param[key];\n    }\n\n    return this.name + \"(\" + param_txt + \")\";\n  }\n\n}\n;\nCommandBase.prototype.name = \"command\";\n\n//# sourceURL=webpack://hdrpaint/./src/command/commandbase.js?");

/***/ }),

/***/ "./src/command/composite.js":
/*!**********************************!*\
  !*** ./src/command/composite.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n//レイヤ結合\n\n\n\n\nclass Composite extends _commandbase_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"] {\n  undo() {\n    var undo_data = this.undo_data;\n    var layer = undo_data.layer;\n    layer.children = undo_data.children;\n    layer.type = 1;\n    layer.refreshDiv();\n  }\n\n  func() {\n    //グループレイヤの子レイヤをすべて結合して通常レイヤにする\n    var param = this.param;\n    var layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(param.layer_id); //差分ログ作成\n\n    if (!this.undo_data) {\n      this.undo_data = {\n        \"layer\": layer,\n        \"children\": layer.children\n      };\n    }\n\n    layer.type = 0;\n    layer.children = null;\n    layer.refreshDiv();\n  }\n\n}\n\n;\nComposite.prototype.name = \"composite\";\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].commandObjs.composite = Composite;\n\n//# sourceURL=webpack://hdrpaint/./src/command/composite.js?");

/***/ }),

/***/ "./src/command/copy.js":
/*!*****************************!*\
  !*** ./src/command/copy.js ***!
  \*****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\n\n\nvar commandObjs = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].commandObjs;\n\nclass Copy extends _commandbase_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"] {\n  constructor() {\n    super();\n  }\n\n  undo() {\n    var undo_data = this.undo_data;\n    var layer = undo_data.layer;\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].removeLayer(layer);\n    return;\n  }\n\n  func() {\n    var param = this.param;\n    var src_layer = param.src_layer;\n    var n = param.position;\n    var layer;\n\n    if (!this.undo_data) {\n      var src_layer = _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].findById(param.src_layer_id);\n      var range = param.range;\n      var img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"](range.w, range.h);\n      _lib_img_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].copy(img, 0, 0, src_layer.img, range.x, range.y, range.w, range.h); //layer.refreshDiv();\n\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].clipboard = img;\n    } else {\n      layer = this.undo_data.layer;\n    }\n\n    return layer;\n  }\n\n}\n\n_defineProperty(Copy, \"name\", \"copy\");\n\ncommandObjs[\"copy\"] = Copy;\n\n//# sourceURL=webpack://hdrpaint/./src/command/copy.js?");

/***/ }),

/***/ "./src/command/copylayer.js":
/*!**********************************!*\
  !*** ./src/command/copylayer.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\n\n\nvar commandObjs = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].commandObjs;\n\nclass CopyLayer extends _commandbase_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"] {\n  constructor() {\n    super();\n  }\n\n  undo() {\n    var undo_data = this.undo_data;\n    var layer = undo_data.layer;\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].removeLayer(layer);\n    return;\n  }\n\n  func() {\n    var param = this.param;\n    var src_layer = param.src_layer;\n    var n = param.position;\n    var layer;\n\n    if (!this.undo_data) {\n      var src_layer = _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].findById(param.src_layer_id);\n      var img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"](src_layer.size[0], src_layer.size[1]);\n      _lib_img_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].copy(img, 0, 0, src_layer.img, 0, 0, img.width, img.height);\n      layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].createLayer(img, 0);\n      var keys = Object.keys(layer);\n\n      for (var i = 0; i < keys.length; i++) {\n        var key = keys[i];\n        if ([\"id\", \"dom\", \"img\", \"children\"].indexOf(key) >= 0) continue;\n\n        if (layer[key] instanceof _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2) {\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.copy(layer[key], src_layer[key]);\n        } else {\n          layer[key] = src_layer[key];\n        }\n      }\n\n      layer.refreshDiv();\n      this.undo_data = {\n        \"layer\": layer\n      };\n    } else {\n      layer = this.undo_data.layer;\n    }\n\n    var parentLayer = _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].findById(param.parent);\n    parentLayer.append(n, layer);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].select(layer);\n    return layer;\n  }\n\n}\n\n_defineProperty(CopyLayer, \"name\", \"copylayer\");\n\ncommandObjs[\"copylayer\"] = CopyLayer;\n\n//# sourceURL=webpack://hdrpaint/./src/command/copylayer.js?");

/***/ }),

/***/ "./src/command/createNewLayer.js":
/*!***************************************!*\
  !*** ./src/command/createNewLayer.js ***!
  \***************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n//レイヤ新規作成\n\n\n\n\n\nclass CreateNewLayer extends _commandbase_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"] {\n  constructor() {\n    super();\n  }\n\n  undo() {\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].removeLayer(this.undo_data.layer);\n    return;\n  }\n\n  func() {\n    var param = this.param;\n    var width = param.width;\n    var height = param.height;\n    var n = param.position;\n    var layer;\n\n    if (!this.undo_data) {\n      var img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](width, height);\n      var data = img.data;\n\n      for (var i = 0; i < data.length; i += 4) {\n        data[i + 0] = 1;\n        data[i + 1] = 1;\n        data[i + 2] = 1;\n        data[i + 3] = 0;\n      }\n\n      layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].createLayer(img, param.composite_flg);\n      this.undo_data = {\n        \"layer\": layer\n      };\n    } else {\n      layer = this.undo_data.layer;\n    }\n\n    var parentLayer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(param.parent);\n    parentLayer.append(n, layer);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].select(layer);\n    return layer;\n  }\n\n}\n\n;\nCreateNewLayer.prototype.name = \"createNewLayer\";\n\nclass CreateNewCompositeLayer extends CreateNewLayer {}\n\nCreateNewCompositeLayer.prototype.name = \"createNewCompositeLayer\";\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].commandObjs.createNewLayer = CreateNewLayer;\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].commandObjs.createNewCompositeLayer = CreateNewCompositeLayer;\n\n//# sourceURL=webpack://hdrpaint/./src/command/createNewLayer.js?");

/***/ }),

/***/ "./src/command/createmodifier.js":
/*!***************************************!*\
  !*** ./src/command/createmodifier.js ***!
  \***************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\n\nvar commandObjs = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].commandObjs;\n\nclass CreateModifier extends _commandbase_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"] {\n  constructor() {\n    super();\n  }\n\n  undo() {\n    var undo_data = this.undo_data;\n    var layer = undo_data.layer;\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].removeLayer(layer);\n    return;\n  }\n\n  func() {\n    var param = this.param;\n    var src_layer = param.src_layer;\n    var n = param.position;\n    var layer;\n\n    if (!this.undo_data) {\n      layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].createModifier(param.modifier);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.set(layer.size, param.width, param.height);\n      this.undo_data = {\n        \"layer\": layer\n      };\n    } else {\n      layer = this.undo_data.layer;\n    }\n\n    var parentLayer = _layer_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].findById(param.parent_layer_id);\n    parentLayer.append(n, layer);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].select(layer);\n    return layer;\n  }\n\n}\n\n_defineProperty(CreateModifier, \"name\", \"createmodifier\");\n\ncommandObjs[\"createmodifier\"] = CreateModifier;\n\n//# sourceURL=webpack://hdrpaint/./src/command/createmodifier.js?");

/***/ }),

/***/ "./src/command/deleteLayer.js":
/*!************************************!*\
  !*** ./src/command/deleteLayer.js ***!
  \************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n//レイヤ削除\n\n\n\n\nclass DeleteLayer extends _commandbase_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"] {\n  undo() {\n    var layer = this.undo_data.layer;\n    var idx = this.undo_data.position;\n    var parent_layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(this.undo_data.parent);\n    parent_layer.append(idx, layer);\n    layer.select();\n  }\n\n  func() {\n    var layer_id = this.param.layer_id;\n    var layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(layer_id);\n    var parent_layer = layer.parent;\n\n    if (parent_layer) {\n      var layers = parent_layer.children;\n      var idx = layers.indexOf(layer);\n\n      if (!this.undo_data) {\n        this.undo_data = {\n          \"layer\": layer,\n          \"position\": idx,\n          \"parent\": parent_layer.id\n        };\n      }\n\n      var index = layers.indexOf(layer); //レイヤ削除\n\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].removeLayer(layer);\n\n      if (layer === selected_layer) {\n        if (layers.length === 0) {\n          parent_layer.select();\n        } else {\n          if (index < layers.length) {\n            layers[index].select();\n          } else {\n            layers[layers.length - 1].select();\n          }\n        }\n      }\n    }\n\n    if (parent_layer) {\n      parent_layer.bubbleComposite();\n    }\n  }\n\n}\n\n;\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].commandObjs.deleteLayer = DeleteLayer;\n\n//# sourceURL=webpack://hdrpaint/./src/command/deleteLayer.js?");

/***/ }),

/***/ "./src/command/drawLine.js":
/*!*********************************!*\
  !*** ./src/command/drawLine.js ***!
  \*********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _penpoint_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../penpoint.js */ \"./src/penpoint.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n\n\n\n\n\n\nvar painted_mask = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].painted_mask;\n\nclass Brush extends _commandbase_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"] {\n  constructor() {\n    super();\n  }\n\n  toString() {\n    var points = this.param.points;\n    var str = this.name;\n\n    if (points.length) {\n      str += \"(\" + points[0].pos[0].toFixed(2) + \",\" + points[0].pos[1].toFixed(2) + \")-\";\n      str += points.length - 2 + \"-\";\n      str += \"(\" + points[points.length - 1].pos[0].toFixed(2) + \",\" + points[points.length - 1].pos[1].toFixed(2) + \")\";\n    }\n\n    return str;\n  }\n\n  func() {\n    //ペン描画\n    var param = this.param;\n    var layer = _layer_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].findById(param.layer_id);\n    var points = param.points;\n    painted_mask.fill(0);\n\n    for (var li = 1; li < points.length; li++) {\n      this.draw(li);\n    }\n  }\n\n  draw(n) {\n    var param = this.param;\n    var points = param.points;\n    var layer = _layer_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].findById(param.layer_id);\n\n    if (!layer) {\n      layer = param.layer;\n    }\n\n    var img = layer.img;\n    layer.getAbsolutePosition(absolute);\n    var point0 = points[n - 1];\n    var point1 = points[n];\n    var p0 = point0.pos;\n    var p1 = point1.pos;\n    var offset = 0; //補間するための係数を求める\n\n    if (n >= 2) {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(A, p0, points[n - 2].pos);\n      var l1 = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar(A);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(B, p1, p0);\n      var l2 = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar(B);\n\n      if (l1 + l2 > 0) {\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mul(q0, A, l2 / (l1 + l2));\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.madd(q0, q0, B, l1 / (l1 + l2));\n      }\n    } else {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(q0, p1, p0);\n    }\n\n    if (n + 1 < points.length) {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(A, p1, p0);\n      var l1 = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar(A);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(B, points[n + 1].pos, p1);\n      var l2 = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar(B);\n\n      if (l1 + l2 > 0) {\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mul(q1, A, l2 / (l1 + l2));\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.madd(q1, q1, B, l1 / (l1 + l2));\n      }\n    } else {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(q1, p1, p0);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.madd(q1, q1, q0, -0.5);\n    }\n\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.copy(D, p0);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.copy(C, q0);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.madd(A, q1, p1, -2);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.add(A, A, q0);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.madd(A, A, p0, 2);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(B, p1, A);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(B, B, q0);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(B, B, p0);\n    var dp = point1.pressure - point0.pressure;\n    var len = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.len(p1, p0);\n    var devide = clamp(len / 4 | 0, 1, MAX - 1);\n\n    if (!param.stroke_interpolation) {\n      //補間しない\n      devide = 1;\n    }\n\n    var _devide = 1 / devide;\n\n    var wei = param.weight * 0.5;\n\n    if (param.pressure_effect_flgs & 1) {\n      wei *= Math.max(point0.pressure, point1.pressure);\n    }\n\n    var left = img.width;\n    var right = 0;\n    var top = img.height;\n    var bottom = 0;\n\n    for (var i = 0; i < devide + 1; i++) {\n      var p = _p[i];\n      var dt = i * _devide + offset;\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mul(p.pos, A, dt * dt * dt);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.madd(p.pos, p.pos, B, dt * dt);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.madd(p.pos, p.pos, C, dt);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.add(p.pos, p.pos, D);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(p.pos, p.pos, absolute);\n      p.pressure = point0.pressure + dp * dt; //Vec2.sub(p.pos,p.pos,layer.position);\n\n      left = Math.min(p.pos[0], left);\n      right = Math.max(p.pos[0], right);\n      top = Math.min(p.pos[1], top);\n      bottom = Math.max(p.pos[1], bottom);\n    }\n\n    left = Math.floor(clamp(left - wei, 0, img.width - 1));\n    right = Math.ceil(clamp(right + wei, 0, img.width - 1));\n    top = Math.floor(clamp(top - wei, 0, img.height - 1));\n    bottom = Math.ceil(clamp(bottom + wei, 0, img.height - 1)); //差分ログ作成\n\n    if (!this.undo_data) {\n      this.undo_data = {\n        \"difs\": []\n      };\n    }\n\n    if (this.undo_data.difs.length < n) {\n      var dif = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].createDif(layer, left, top, right - left + 1, bottom - top + 1);\n      this.undo_data.difs.push(dif);\n    }\n\n    for (var i = 0; i < devide; i++) {\n      drawPen(layer.img, _p[i], _p[i + 1], param);\n    } //再描画\n\n\n    layer.refreshImg(left, top, right - left + 1, bottom - top + 1);\n  }\n\n}\n\n;\nBrush.prototype.name = \"brush\";\n\nclass Eraser extends Brush {}\n\nEraser.prototype.name = \"eraser\";\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].commandObjs.eraser = Eraser;\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].commandObjs.brush = Brush;\nvar absolute = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\nvar A = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2(),\n    B = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2(),\n    C = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2(),\n    D = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\nvar q0 = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\nvar q1 = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\nvar _p = [];\nvar MAX = 32;\n\nfor (var i = 0; i < MAX; i++) {\n  _p.push(new _penpoint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"]());\n}\n\nvar clamp = function (value, min, max) {\n  return Math.min(max, Math.max(min, value));\n};\n\nvar brush_blend = function (dst, idx, pressure, dist, flg, weight, param) {\n  var alpha_mask = param.alpha_mask;\n  var color = param.color;\n  var sa = color[3] * param.alpha;\n\n  if (param.eraser) {\n    sa = param.alpha;\n  }\n\n  if (param.alpha_pressure_effect) {\n    sa *= pressure;\n  }\n\n  var l = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar(dist);\n\n  if (param.softness) {\n    sa = sa * Math.min(1, (weight - weight * l) / (weight * param.softness));\n  } else {\n    if (param.antialias) {\n      sa = sa * Math.min(1, weight - weight * l);\n    }\n  }\n\n  if (param.eraser) {\n    if (param.overlap === 2) {\n      dst[idx + 3] = (1 - sa) * (1 - param.alpha);\n      return;\n    }\n  }\n\n  if (param.overlap === 2) {\n    dst[idx + 0] = color[0];\n    dst[idx + 1] = color[1];\n    dst[idx + 2] = color[2];\n\n    if (!alpha_mask) {\n      dst[idx + 3] = sa;\n    }\n\n    return;\n  }\n\n  if (param.overlap == 0) {\n    if (flg[idx >> 2] >= sa) {\n      return;\n    }\n\n    var olda = flg[idx >> 2];\n    flg[idx >> 2] = sa;\n    sa = (sa - olda) / (1 - olda);\n  }\n\n  if (param.eraser) {\n    dst[idx + 3] = dst[idx + 3] * (1 - sa) + 0 * sa;\n    return;\n  }\n\n  var da = dst[idx + 3] * (1 - sa);\n\n  if (!alpha_mask) {\n    dst[idx + 3] = da + sa;\n  }\n\n  if (dst[idx + 3] && !param.eraser) {\n    var rr = 1 / dst[idx + 3];\n    da *= rr;\n    sa *= rr;\n    dst[idx + 0] += dst[idx + 0] * (-1 + da) + color[0] * sa;\n    dst[idx + 1] += dst[idx + 1] * (-1 + da) + color[1] * sa;\n    dst[idx + 2] += dst[idx + 2] * (-1 + da) + color[2] * sa;\n  }\n};\n\nvar vec2 = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\nvar side = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\nvar dist = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\n\nvar drawPen = function (img, point0, point1, param) {\n  var weight = param.weight;\n  var pressure_mask = param.pressure_effect_flgs;\n  var softness = param.softness; //描画\n\n  var img_data = img.data;\n  weight *= 0.5;\n  var weight_pressure_effect = pressure_mask & 1;\n  var alpha_pressure_effect = (pressure_mask & 2) >> 1;\n  var pos1 = point1.pos;\n  var pos0 = point0.pos;\n  var pressure_0 = point0.pressure;\n  var d_pressure = point1.pressure - point0.pressure;\n  var weight_0pow2 = weight * ((pressure_0 - 1) * weight_pressure_effect + 1);\n  var weight_1pow2 = weight * ((d_pressure + pressure_0 - 1) * weight_pressure_effect + 1);\n  var max_weight = Math.max(weight_0pow2, weight_1pow2);\n  var weight_0pow2 = weight_0pow2 * weight_0pow2;\n  var weight_1pow2 = weight_1pow2 * weight_1pow2;\n  var left = Math.min(pos1[0], pos0[0]);\n  var right = Math.max(pos1[0], pos0[0]) + 1;\n  var top = Math.min(pos1[1], pos0[1]);\n  var bottom = Math.max(pos1[1], pos0[1]) + 1;\n  left = Math.floor(clamp(left - max_weight, 0, img.width));\n  right = Math.ceil(clamp(right + max_weight, 0, img.width));\n  top = Math.floor(clamp(top - max_weight, 0, img.height));\n  bottom = Math.ceil(clamp(bottom + max_weight, 0, img.height));\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(vec2, pos1, pos0);\n  var l = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar2(vec2);\n\n  if (l !== 0) {\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mul(vec2, vec2, 1 / l);\n  } else {\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.set(vec2, 0, 0);\n  }\n\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.set(side, vec2[1], -vec2[0]);\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.norm(side);\n  var drawfunc = brush_blend;\n\n  for (var dy = top; dy < bottom; dy++) {\n    for (var dx = left; dx < right; dx++) {\n      dist[0] = dx - pos0[0] + 0.5;\n      dist[1] = dy - pos0[1] + 0.5;\n      var dp = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.dot(vec2, dist);\n      var l = 0;\n      var l2 = 0;\n      var local_pressure = 0;\n\n      if (dp <= 0) {\n        //始点より前\n        if (_lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar2(dist) >= weight_0pow2) {\n          continue;\n        }\n\n        dp = 0;\n        l = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar(dist);\n        local_pressure = d_pressure * dp + pressure_0;\n        local_weight = weight * ((local_pressure - 1) * weight_pressure_effect + 1);\n      } else if (dp >= 1) {\n        //終端より後\n        dist[0] = dx - pos1[0] + 0.5;\n        dist[1] = dy - pos1[1] + 0.5;\n\n        if (_lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar2(dist) >= weight_1pow2) {\n          continue;\n        }\n\n        dp = 1;\n        l = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar(dist);\n        local_pressure = d_pressure * dp + pressure_0;\n        local_weight = weight * ((local_pressure - 1) * weight_pressure_effect + 1);\n      } else {\n        //線半ば\n        local_pressure = d_pressure * dp + pressure_0;\n        var local_weight = weight * ((local_pressure - 1) * weight_pressure_effect + 1);\n        l = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.dot(dist, side);\n\n        if (l * l >= local_weight * local_weight) {\n          //線幅より外の場合\n          continue;\n        }\n\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mul(dist, side, l);\n        l = Math.abs(l);\n      }\n\n      var idx = dy * img.width + dx | 0;\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mul(dist, dist, 1 / local_weight);\n      drawfunc(img_data, idx << 2, local_pressure, dist, painted_mask, local_weight, param);\n    }\n  }\n};\n\n//# sourceURL=webpack://hdrpaint/./src/command/drawLine.js?");

/***/ }),

/***/ "./src/command/fill.js":
/*!*****************************!*\
  !*** ./src/command/fill.js ***!
  \*****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n\n\n\n\n\nvar commandObjs = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].commandObjs;\nvar fillStack = [];\nvar joined_r, joined_g, joined_b, joined_a;\nvar target_r, target_g, target_b, target_a;\nvar offset = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\nvar refresh_left, refresh_top, refresh_bottom, refresh_right;\n\nvar fillCheckAll = function (layer, joined, x, y) {\n  var x2 = x + offset[0];\n  var y2 = y + offset[1];\n\n  if (joined.width <= x2 || x2 < 0 || y2 < 0 || joined.height <= y2) {\n    return false;\n  }\n\n  var target = layer.img;\n  var idx = target.getIndex(x, y) << 2;\n  var idx2 = joined.getIndex(x2, y2) << 2;\n  var joined_data = joined.data;\n  var target_data = target.data;\n  return joined_r === joined_data[idx2] && joined_g === joined_data[idx2 + 1] && joined_b === joined_data[idx2 + 2] && joined_a === joined_data[idx2 + 3] && target_r === target_data[idx] && target_g === target_data[idx + 1] && target_b === target_data[idx + 2] && target_a === target_data[idx + 3];\n};\n\nvar fillCheckLayer = function (layer, joined, x, y) {\n  var target = layer.img;\n  var idx = target.getIndex(x, y) << 2;\n  var target_data = target.data;\n  return target_r === target_data[idx] && target_g === target_data[idx + 1] && target_b === target_data[idx + 2] && target_a === target_data[idx + 3];\n};\n\nvar fillCheckAlpha = function (layer, joined, x, y) {\n  var x2 = x + offset[0];\n  var y2 = y + offset[1];\n\n  if (joined.width <= x2 || x2 < 0 || y2 < 0 || joined.height <= y2) {\n    return false;\n  }\n\n  var target = layer.img;\n  var idx = target.getIndex(x, y) << 2;\n  var idx2 = joined.getIndex(x2, y2) << 2;\n  var joined_data = joined.data;\n  var target_data = target.data;\n  return target_data[idx + 3] !== 1 && joined_data[idx2 + 3] !== 1;\n};\n\nvar fillCheck = fillCheckAll;\n\nvar fillSub = function (layer, y, left, right) {\n  var target = layer.img;\n  var joined_img = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].root_layer.img;\n  var mode = 0; //塗りつぶし領域を求める\n  //左の端を探す\n\n  var xi = left;\n  var yidx = target.getIndex(0, y) << 2;\n\n  for (; xi >= 0; xi--) {\n    var idx2 = yidx + (xi << 2);\n\n    if (fillCheck(layer, joined_img, xi, y)) {\n      if (mode === 0) {\n        mode = 1;\n      }\n    } else {\n      break;\n    }\n  }\n\n  if (mode === 1) {\n    fillStack.push(y);\n    fillStack.push(xi + 1);\n  }\n\n  for (var xi = left; xi < right; xi++) {\n    var idx2 = yidx + (xi << 2);\n\n    if (fillCheck(layer, joined_img, xi, y)) {\n      if (mode === 0) {\n        //塗りつぶし領域開始\n        fillStack.push(y);\n        fillStack.push(xi);\n        mode = 1;\n      }\n    } else {\n      if (mode === 1) {\n        //塗りつぶし領域外なので終了\n        fillStack.push(xi);\n        mode = 0;\n      }\n    }\n  } //右端\n\n\n  if (mode === 1) {\n    var xi = right - 1;\n\n    for (; xi < target.width; xi++) {\n      var idx2 = yidx + (xi << 2);\n\n      if (!fillCheck(layer, joined_img, xi, y)) {\n        break;\n      }\n    }\n\n    fillStack.push(xi);\n  }\n};\n\nclass Fill extends _commandbase_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"] {\n  func() {\n    //塗りつぶし\n    var param = this.param;\n    var layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(param.layer_id);\n    layer.getAbsolutePosition(offset);\n    var point_x = param.x;\n    var point_y = param.y;\n    var col = param.color;\n    fillCheck = fillCheckAll;\n\n    if (param.is_layer) {\n      fillCheck = fillCheckLayer;\n    }\n\n    if (inputs['fill_alpha'].checked) {\n      fillCheck = fillCheckAlpha;\n    } //アルファマスク保護設定\n\n\n    var mask_alpha = layer.mask_alpha;\n    var one_minus_mask_alpha = 1 - mask_alpha;\n    fillStack = [];\n    var x = point_x | 0;\n    var y = point_y | 0; //塗りつぶし範囲\n\n    refresh_top = y;\n    refresh_bottom = y;\n    refresh_left = x;\n    refresh_right = x; //塗りつぶし対象色\n\n    var target = layer.img;\n    var joined_img = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].root_layer.img;\n    var idx = joined_img.getIndex(x + layer.position[0], y + layer.position[1]) << 2;\n    joined_r = joined_img.data[idx];\n    joined_g = joined_img.data[idx + 1];\n    joined_b = joined_img.data[idx + 2];\n    joined_a = joined_img.data[idx + 3];\n    idx = target.getIndex(x, y) << 2;\n    target_r = target.data[idx];\n    target_g = target.data[idx + 1];\n    target_b = target.data[idx + 2];\n    target_a = target.data[idx + 3];\n    var draw_r = col[0];\n    var draw_g = col[1];\n    var draw_b = col[2];\n    var draw_a = col[3];\n    var target_data = target.data;\n\n    if (target_r === draw_r && target_g === draw_g && target_b === draw_b && target_a === draw_a) {\n      //同色の場合終了\n      return;\n    }\n\n    var old_img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"](target.width, target.height);\n    _lib_img_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].copy(old_img, 0, 0, target, 0, 0, target.width, target.height); //開始座標を登録\n\n    fillStack.push(y);\n    fillStack.push(x);\n    fillStack.push(x);\n\n    while (fillStack.length) {\n      var right = fillStack.pop(); //右端\n\n      var left = fillStack.pop(); //左端\n\n      var yi = fillStack.pop(); //y座標\n      //塗りつぶし\n\n      var yidx = target.getIndex(0, yi) << 2;\n\n      for (var xi = left; xi < right; xi++) {\n        idx = yidx + (xi << 2);\n        target_data[idx + 0] = draw_r;\n        target_data[idx + 1] = draw_g;\n        target_data[idx + 2] = draw_b;\n        target_data[idx + 3] = target_data[idx + 3] * mask_alpha + draw_a * one_minus_mask_alpha;\n      }\n\n      if (yi > 0) {\n        //上端に到達していない場合、ひとつ上の行を探索\n        fillSub(layer, yi - 1, left, right);\n      }\n\n      if (yi < target.height - 1) {\n        //下端に到達していない場合、ひとつ下の行を探索\n        fillSub(layer, yi + 1, left, right);\n      } //更新領域を求める\n\n\n      refresh_left = Math.min(refresh_left, left);\n      refresh_right = Math.max(refresh_right, right);\n      refresh_top = Math.min(refresh_top, yi);\n      refresh_bottom = Math.max(refresh_bottom, yi + 1);\n    }\n\n    var width = refresh_right - refresh_left;\n    var height = refresh_bottom - refresh_top;\n\n    if (!this.undo_data) {\n      this.undo_data = {};\n      var layer_img = layer.img;\n      layer.img = old_img;\n      var dif = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].createDif(layer, refresh_left, refresh_top, width, height);\n      layer.img = layer_img;\n      this.undo_data.difs = [];\n      this.undo_data.difs.push(dif);\n    }\n\n    layer.refreshImg(refresh_left, refresh_top, refresh_right - refresh_left + 1, refresh_bottom - refresh_top + 1);\n  }\n\n}\n\ncommandObjs[\"fill\"] = Fill;\n\n//# sourceURL=webpack://hdrpaint/./src/command/fill.js?");

/***/ }),

/***/ "./src/command/joinLayer.js":
/*!**********************************!*\
  !*** ./src/command/joinLayer.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n\n\n\n\n\n\nclass JoinLayer extends _commandbase_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"] {\n  undo() {\n    var undo_data = this.undo_data;\n    var layer = undo_data.layer;\n    var parent_layer = layer.parent;\n    parent_layer.append(undo_data.position, undo_data.layerA);\n    parent_layer.append(undo_data.positionB, undo_data.layerB);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].removeLayer(layer);\n    return;\n  }\n\n  func() {\n    var param = this.param;\n    var layer;\n    var layerA = _layer_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].findById(param.layer_id);\n    var layerB = _layer_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].findById(param.layer_id2);\n    var parent_layer = layerA.parent;\n    var layers = parent_layer.children;\n    var ls = [layerA, layerB];\n\n    if (!this.undo_data) {\n      //２つのレイヤが収まるサイズのグループレイヤを作成\n      var x = Math.min(layerA.position[0], layerB.position[0]);\n      var y = Math.min(layerA.position[1], layerB.position[1]);\n      var right = Math.max(layerA.position[0] + layerA.size[0], layerB.position[0] + layerB.size[0]);\n      var bottom = Math.max(layerA.position[1] + layerA.size[1], layerB.position[1] + layerB.size[1]);\n      var width = right - x;\n      var height = bottom - y;\n      var position = layers.indexOf(layerA);\n      var position2 = layers.indexOf(layerB);\n      var img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"](width, height);\n      layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].createLayer(img, 1);\n      layer.position[0] = x;\n      layer.position[1] = y;\n      layer.name = layerA.name + \",\" + layerB.name; //２つのレイヤを子レイヤとしてセット\n\n      layer.append(0, layerA);\n      layer.append(1, layerB);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(layerB.position, layerB.position, layer.position);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(layerA.position, layerA.position, layer.position); //結合\n\n      layer.composite();\n      layer.type = 0;\n      layer.children = [];\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.add(layerB.position, layerB.position, layer.position);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.add(layerA.position, layerA.position, layer.position);\n      layer.refreshDiv();\n      this.undo_data = {\n        \"layerA\": layerA,\n        \"position\": position,\n        \"layerB\": layerB,\n        \"positionB\": position2,\n        \"layer\": layer\n      };\n    } else {\n      layer = this.undo_data.layer;\n    } //結合元レイヤを削除\n\n\n    for (var li = 0; li < ls.length; li++) {\n      var n = layers.indexOf(ls[li]);\n      layers.splice(n, 1);\n    } //結合したレイヤを挿入\n\n\n    parent_layer.append(n, layer);\n    layer.select();\n  }\n\n}\n\n;\nJoinLayer.prototype.name = \"JoinLayer\";\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].commandObjs.joinLayer = JoinLayer;\n\n//# sourceURL=webpack://hdrpaint/./src/command/joinLayer.js?");

/***/ }),

/***/ "./src/command/loadImage.js":
/*!**********************************!*\
  !*** ./src/command/loadImage.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\nvar commandObjs = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].commandObjs;\n\nclass LoadImage extends _commandbase_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n  constructor() {\n    super();\n  }\n\n  undo() {\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].removeLayer(this.undo_data.layer);\n    return;\n  }\n\n  func() {\n    var param = this.param;\n    var n = param.position;\n    var img = this.param.img;\n    var file = param.file;\n    var parent_layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(param.parent_layer_id);\n    var layer;\n\n    if (!this.undo_data) {\n      param.img = null;\n      layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].createLayer(img);\n      this.undo_data = {\n        \"layer\": layer\n      };\n    } else {\n      layer = this.undo_data.layer;\n    }\n\n    parent_layer.append(param.position, layer);\n    layer.select();\n  }\n\n}\n\n_defineProperty(LoadImage, \"name\", \"LoadImage\");\n\ncommandObjs[\"loadImage\"] = LoadImage;\n\n//# sourceURL=webpack://hdrpaint/./src/command/loadImage.js?");

/***/ }),

/***/ "./src/command/moveLayer.js":
/*!**********************************!*\
  !*** ./src/command/moveLayer.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n//レイヤ位置移動\n\n\n\n\nclass MoveLayer extends _commandbase_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"] {\n  undo() {\n    this.func(true);\n  }\n\n  func(undo_flg) {\n    var param = this.param;\n    var layer = _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].findById(param.layer_id); //\t\tvar now_parent_layer= Layer.findParent(layer);\n\n    var now_parent_layer = layer.parent;\n    var layers = now_parent_layer.children;\n    var next_parent_layer = param.parent_layer_id;\n    var position = param.position;\n    var layer_num = layers.indexOf(layer);\n\n    if (undo_flg) {\n      position = this.undo_data.before;\n      next_parent_layer = this.undo_data.before_parent;\n    }\n\n    next_parent_layer = _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].findById(next_parent_layer);\n\n    if (position < 0 || next_parent_layer.children.length < position) {\n      return;\n    }\n\n    if (layer_num === position && now_parent_layer === next_parent_layer) {\n      return;\n    }\n\n    now_parent_layer.children.splice(layer_num, 1);\n    now_parent_layer.bubbleComposite();\n    var layers_container = layer.dom.parentNode;\n    next_parent_layer.append(position, layer);\n\n    if (!this.undo_data) {\n      this.undo_data = {\n        \"before\": layer_num,\n        \"before_parent\": now_parent_layer.id\n      };\n    }\n  }\n\n}\n\n;\nMoveLayer.prototype.name = \"moveLayer\";\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].commandObjs.moveLayer = MoveLayer;\n\n//# sourceURL=webpack://hdrpaint/./src/command/moveLayer.js?");

/***/ }),

/***/ "./src/command/multiCommand.js":
/*!*************************************!*\
  !*** ./src/command/multiCommand.js ***!
  \*************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n//複数コマンドバッチ\n\nvar Command = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].Command;\n\nCommand[\"multiCommand\"] = function () {\n  return function (_log, undo_flg) {\n    var logs = _log.param.logs;\n\n    if (undo_flg) {\n      for (var li = logs.length; li--;) {\n        var log = logs[li];\n        Command[log.command](log, true);\n        var difs = log.undo_data.difs;\n\n        if (difs) {\n          //画像戻す\n          var param = log.param;\n          var layer_id = param.layer_id;\n          var layer = Layer.findById(param.layer_id);\n\n          for (var di = difs.length; di--;) {\n            var dif = difs[di];\n            Img.copy(layer.img, dif.x, dif.y, dif.img, 0, 0, dif.img.width, dif.img.height);\n          }\n        }\n      }\n    } else {\n      if (!_log.undo_data) {\n        _log.undo_data = {};\n      }\n\n      for (var li = 0; li < logs.length; li++) {\n        var log = logs[li];\n        log.func();\n      }\n    }\n  };\n}();\n\n//# sourceURL=webpack://hdrpaint/./src/command/multiCommand.js?");

/***/ }),

/***/ "./src/command/paste.js":
/*!******************************!*\
  !*** ./src/command/paste.js ***!
  \******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n\n\n\n\n\nvar commandObjs = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].commandObjs;\n\nclass Paste extends _commandbase_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"] {\n  constructor() {\n    super();\n  }\n\n  undo() {\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].removeLayer(this.undo_data.layer);\n    return;\n  }\n\n  func() {\n    var param = this.param;\n    var n = param.position;\n    var layer;\n\n    if (!this.undo_data) {\n      var img = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].clipboard;\n      layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].createLayer(img, param.composite_flg);\n      layer.position[0] = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].select_rectangle.x;\n      layer.position[1] = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].select_rectangle.y;\n      this.undo_data = {\n        \"layer\": layer\n      };\n    } else {\n      layer = this.undo_data.layer;\n    }\n\n    var parentLayer = _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].findById(param.parent);\n    parentLayer.append(n, layer);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].select(layer);\n    return layer;\n  }\n\n}\n\ncommandObjs[\"paste\"] = Paste;\n\n//# sourceURL=webpack://hdrpaint/./src/command/paste.js?");

/***/ }),

/***/ "./src/command/resizeCanvas.js":
/*!*************************************!*\
  !*** ./src/command/resizeCanvas.js ***!
  \*************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n\n\n\n\n\n\nclass ResizeCanvas extends _commandbase_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"] {\n  undo() {\n    this.func(true);\n  }\n\n  func(undo_flg) {\n    var param = this.param;\n    var width = param.width;\n    var height = param.height;\n    var old_width = preview.width;\n    var old_height = preview.height;\n\n    if (undo_flg) {\n      width = this.undo_data.width;\n      height = this.undo_data.height;\n    }\n\n    if (!this.undo_data) {\n      this.undo_data = {\n        \"width\": old_width,\n        \"height\": old_height\n      };\n    }\n\n    preview.width = width;\n    preview.height = height;\n    preview_ctx_imagedata = preview_ctx.createImageData(width, height);\n    bloomed_img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](width, height);\n    bloom_img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](width, height);\n    var root_layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].root_layer;\n    root_layer.width = width;\n    root_layer.height = height;\n    root_layer.img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](width, height);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.set(root_layer.size, width, height);\n    root_layer.composite();\n  }\n\n}\n\n;\nResizeCanvas.prototype.name = \"resizeCavnas\";\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].commandObjs.resizeCanvas = ResizeCanvas;\n\n//# sourceURL=webpack://hdrpaint/./src/command/resizeCanvas.js?");

/***/ }),

/***/ "./src/command/resizeLayer.js":
/*!************************************!*\
  !*** ./src/command/resizeLayer.js ***!
  \************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _commandlog_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../commandlog.js */ \"./src/commandlog.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n//リサイズレイヤ\n//\n\n\n\n\n\n\nclass ResizeLayer extends _commandbase_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"] {\n  undo() {\n    this.func(true);\n  }\n\n  func(undo_flg) {\n    var param = this.param;\n\n    if (param.layer_id === -1) {\n      if (undo_flg) {\n        for (var li = this.cmds.length; li--;) {\n          this.cmds[li].undo();\n        }\n\n        return;\n      } //全レイヤ一括の場合バッチ化\n\n\n      var cmds = [];\n      var layers = _layer_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].layerArray();\n\n      for (var li = 0; li < layers.length; li++) {\n        var layer = layers[li];\n\n        if (layer === root_layer) {\n          continue;\n        }\n\n        var cmd = new ResizeLayer();\n        cmd.param = {\n          \"layer_id\": layer.id,\n          \"width\": param.width,\n          \"height\": param.height\n        };\n        cmd.func();\n        cmds.push(cmd);\n      }\n\n      this.cmds = cmds;\n      return;\n    }\n\n    var layer = _layer_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].findById(param.layer_id);\n    var img = layer.img;\n\n    if (!img) {\n      return;\n    }\n\n    var old_width = img.width;\n    var old_height = img.height;\n    var width = param.width;\n    var height = param.height;\n\n    if (undo_flg) {\n      width = this.undo_data.width;\n      height = this.undo_data.height;\n    } //差分ログ作成\n\n\n    if (!this.undo_data) {\n      this.undo_data = {\n        \"width\": old_width,\n        \"height\": old_height\n      };\n      var dx = old_width - width;\n      var dy = old_height - height;\n      this.undo_data.difs = [];\n      var dif;\n\n      if (dx > 0) {\n        dif = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].createDif(layer, width, 0, dx, old_height);\n        this.undo_data.difs.push(dif);\n      }\n\n      if (dy > 0) {\n        dif = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].createDif(layer, 0, height, old_width, dy);\n        this.undo_data.difs.push(dif);\n      }\n    }\n\n    var old_img = img;\n    layer.img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"](width, height);\n    layer.size[0] = width;\n    layer.size[1] = height;\n    _lib_img_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].copy(layer.img, 0, 0, old_img, 0, 0, old_img.width, old_img.height);\n    layer.refreshDiv();\n    layer.registRefreshThumbnail();\n\n    if (layer.parent) {\n      layer.parent.bubbleComposite();\n    }\n  }\n\n}\n\n;\nResizeLayer.prototype.name = \"resizeLayer\";\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].commandObjs.resizeLayer = ResizeLayer;\n\n//# sourceURL=webpack://hdrpaint/./src/command/resizeLayer.js?");

/***/ }),

/***/ "./src/command/translate.js":
/*!**********************************!*\
  !*** ./src/command/translate.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n\n\n\n\nclass TranslateLayer extends _commandbase_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"] {\n  undo() {\n    this.param.x *= -1;\n    this.param.y *= -1;\n    this.func();\n    this.param.x *= -1;\n    this.param.y *= -1;\n  }\n\n  func() {\n    var param = this.param;\n    var layer = _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].findById(param.layer_id);\n    var x = param.x;\n    var y = param.y;\n\n    if (!this.undo_data) {\n      this.undo_data = {};\n    }\n\n    if (!layer) {\n      //レイヤ指定無しの場合はルート直下のレイヤすべてを移動\n      var layers = root_layer.children;\n\n      for (var li = 0; li < layers.length; li++) {\n        var l = layers[li];\n        l.position[0] += x;\n        l.position[1] += y;\n\n        if (isNaN(l.position[0])) {\n          l.position[0] = 0;\n        }\n\n        if (isNaN(l.position[1])) {\n          l.position[1] = 0;\n        }\n\n        l.refreshDiv();\n      }\n\n      root_layer.composite();\n    } else {\n      layer.position[0] += x;\n      layer.position[1] += y;\n\n      if (isNaN(layer.position[0])) {\n        layer.position[0] = 0;\n      }\n\n      if (isNaN(layer.position[1])) {\n        layer.position[1] = 0;\n      }\n\n      layer.refreshDiv();\n      layer.refreshImg();\n    }\n  }\n\n}\n\n;\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].commandObjs.translateLayer = TranslateLayer;\n\n//# sourceURL=webpack://hdrpaint/./src/command/translate.js?");

/***/ }),

/***/ "./src/commandlog.js":
/*!***************************!*\
  !*** ./src/commandlog.js ***!
  \***************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ CommandLog; }\n/* harmony export */ });\n/* harmony import */ var _lib_util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lib/util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./layer.js */ \"./src/layer.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./lib/img.js */ \"./src/lib/img.js\");\n\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\nlet undo_max = 10; //undo情報最大保持ステップ数\n\nlet command_log_cursor = -1; //現在のログ位置(undo redoで移動する)\n\nlet log_id = 0;\nclass CommandLog {\n  //ログ制御\n  constructor() {\n    this.obj = null;\n    this.option = null;\n  }\n\n  refreshLabel() {\n    var log = this; //optionのテキストをセット\n\n    var label = \"\" + (\"0000\" + log.id).substr(-4) + \"| \";\n    label = label + log.obj.toString();\n    _lib_util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setText(this.option, label);\n  }\n\n  static reset() {\n    //コマンドログとヒストリをすべて削除\n    log_id = 0;\n    var options = inputs[\"history\"].options;\n\n    for (var i = options.length; i--;) {\n      inputs[\"history\"].removeChild(options[i]);\n    }\n\n    CommandLog.command_logs.length = 0;\n    command_log_cursor = -1;\n  }\n\n  static moveLog(n) {\n    //現在の処理を強制終了\n    pen_log = null;\n\n    if (pen_func) {\n      pen_func.end_flg = 1;\n      pen_func.pen_log.obj.param.points.length = pen_func.idx;\n      pen_func = null;\n    } //指定された番号のコマンドログが実行された状態にする\n\n\n    for (; command_log_cursor < n;) {\n      //リドゥ\n      command_log_cursor++;\n      var log = CommandLog.command_logs[command_log_cursor];\n      log.obj.func();\n    }\n\n    for (; command_log_cursor > n;) {\n      //アンドゥ\n      var log = CommandLog.command_logs[command_log_cursor];\n      log.obj.undo();\n      command_log_cursor--;\n    }\n  }\n\n  static createLog(command, param, flg) {\n    //ログオブジェクトを作成する\n    var log = null;\n\n    if (command_log_cursor >= 0 && !flg) {\n      var current_log = CommandLog.command_logs[command_log_cursor];\n      var log_command = current_log.obj;\n\n      if (command === log_command.name) {\n        if (command === \"changeLayerAttribute\") {\n          if (log_command.param.layer_id === param.layer_id && log_command.param.name === param.name) {\n            log = current_log;\n          }\n        } else if (command === \"translateLayer\") {\n          if (log_command.param.layer_id === param.layer_id) {\n            log = current_log;\n          }\n        } else if (command === \"moveLayer\") {\n          if (log_command.param.layer_id === param.layer_id) {\n            log = current_log;\n          }\n        }\n      }\n    } //カーソル以降のヒストリ削除\n\n\n    CommandLog.command_logs.splice(command_log_cursor + 1, CommandLog.command_logs.length - (command_log_cursor + 1));\n\n    if (!log) {\n      log = new CommandLog();\n      log.id = log_id;\n      log_id++;\n      command_log_cursor++;\n      CommandLog.command_logs.push(log);\n    }\n\n    return log;\n  }\n\n  static appendOption() {\n    //ヒストリ追加\n    var options = inputs[\"history\"].options; //現在のカーソル以降で一番小さいoptionを探す\n\n    var option = null;\n    var idx = options.length;\n\n    for (; idx--;) {\n      if (options[idx].value < command_log_cursor) {\n        break;\n      }\n\n      option = options[idx];\n    }\n\n    idx++;\n\n    for (var oi = options.length - 1; oi > idx; oi--) {\n      //カーソル以降のoptionを1こ残して削除\n      inputs[\"history\"].removeChild(options[oi]);\n    }\n\n    if (!option) {\n      //optionがない場合は新規追加\n      option = document.createElement(\"option\");\n      inputs[\"history\"].appendChild(option);\n    }\n\n    var log = CommandLog.command_logs[command_log_cursor];\n    option.value = command_log_cursor;\n    log.option = option; //log.refreshLabel();\n    //\t\tvar label=\"\" + (\"0000\" + log.id).substr(-4) + \"| \" \n    //\t\t\t+ log.command+\"(\"+param_txt+\")\";\n    //\t\tUtil.setText(option, label);\n    //選択状態にする\n\n    inputs[\"history\"].selectedIndex = options.length - 1;\n\n    if (options.length > undo_max) {\n      //アンドゥ制限超えた部分を無効化\n      var old_option = options[options.length - undo_max - 1];\n      var old_log = CommandLog.command_logs[old_option.value];\n      old_option.setAttribute(\"disabled\", \"disabled\");\n      old_log.undo_data = null;\n    }\n\n    if (options.length > 10) {\n      inputs[\"history\"].removeChild(options[0]);\n    }\n\n    return option;\n  }\n\n}\n\n_defineProperty(CommandLog, \"command_logs\", []);\n\n//# sourceURL=webpack://hdrpaint/./src/commandlog.js?");

/***/ }),

/***/ "./src/file.js":
/*!*********************!*\
  !*** ./src/file.js ***!
  \*********************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ FileManager; }\n/* harmony export */ });\n/* harmony import */ var _lib_util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lib/util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _brush_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./brush.js */ \"./src/brush.js\");\n/* harmony import */ var _lib_zip_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./lib/zip.js */ \"./src/lib/zip.js\");\n/* harmony import */ var _redraw_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./redraw.js */ \"./src/redraw.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./layer.js */ \"./src/layer.js\");\n\n\n\n\n\n\n\n\n\nvar loadHpd_ = function (buffer) {\n  var files = _lib_zip_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].read(buffer);\n  var doc_file = files.find(function (f) {\n    return f.name === \"doc.txt\";\n  });\n\n  if (!doc_file) {\n    return;\n  }\n\n  _redraw_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].disableRefresh();\n\n  if (root_layer) {\n    Command.deleteLayer({\n      param: {\n        \"layer_id\": root_layer.id\n      }\n    });\n  }\n\n  var doc_data = JSON.parse(_lib_util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].utf8ToString(doc_file.data)); //情報セット\n\n  var keys = Object.keys(doc_data);\n\n  for (var ki = 0; ki < keys.length; ki++) {\n    var id = keys[ki];\n    var input = inputs[id];\n\n    if (!input) {\n      continue;\n    }\n\n    input.value = doc_data[id];\n\n    if (input.type === \"checkbox\" && input.value === \"1\") {\n      input.checked = true;\n    }\n  }\n\n  _layer_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].layer_id_count = doc_data.layer_id_count;\n  var brushes = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].brushes;\n  brushes = [];\n\n  for (var bi = 0; bi < doc_data.brushes.length; bi++) {\n    //ブラシ読み込み\n    var doc_brush = doc_data.brushes[bi];\n    var brush = _brush_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].create();\n    brushes.push(brush); //パラメータ設定\n\n    var id = brush.id;\n    setParam(brush, doc_brush);\n    brush.id = id;\n    brush.refresh();\n  }\n\n  _brush_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].refreshBrush();\n  var layers = [];\n\n  for (var li = 0; li < doc_data.layers.length; li++) {\n    //レイヤ読み込み\n    var layer;\n    var doc_layer = doc_data.layers[li];\n\n    switch (parseInt(doc_layer.type)) {\n      case 0:\n        //通常レイヤ\n        var img_file_name = doc_data.layers[li].id + \".exr\";\n        var img_file = files.find(function (f) {\n          return f.name === img_file_name;\n        });\n\n        var img = _lib_img_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].loadExr(img_file.data);\n\n        layer = _layer_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].create(img, 0);\n        break;\n\n      case 1:\n        //グループレイヤ\n        img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"](doc_layer.size[0], doc_layer.size[1]);\n        layer = _layer_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].create(img, 1);\n        break;\n\n      case 2:\n        //モディファイア\n        layer = _layer_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].createModifier(doc_layer.modifier);\n    }\n\n    layers.push(layer); //レイヤパラメータ設定\n\n    var keys = Object.keys(doc_layer);\n\n    for (var ki = 0; ki < keys.length; ki++) {\n      if (typeof layer[keys[ki]] === \"number\") {\n        layer[keys[ki]] = parseFloat(doc_layer[keys[ki]]);\n      } else {\n        layer[keys[ki]] = doc_layer[keys[ki]];\n      }\n    }\n  }\n\n  root_layer = layers[0];\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].onlyExecute(\"resizeCanvas\", {\n    \"width\": root_layer.img.width,\n    \"height\": root_layer.img.height\n  });\n\n  for (var li = layers.length; li--;) {\n    //レイヤ親子復元\n    var layer = layers[li];\n    var doc_layer = doc_data.layers[li];\n\n    if (doc_layer.children) {\n      layer.children = [];\n\n      for (var ki = 0; ki < doc_layer.children.length; ki++) {\n        var child_id = doc_layer.children[ki];\n        var child = layers.find(function (a) {\n          return a.id === child_id;\n        });\n        layer.append(ki, child); //layer.children[ki]=layers.find(\n      }\n    }\n  }\n\n  var maxid = 0;\n\n  for (var li = 0; li < layers.length; li++) {\n    var layer = layers[li];\n    layer.refreshDiv();\n    maxid = Math.max(maxid, layer.id);\n  }\n\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].setLayerIdCount(maxid + 1);\n  _redraw_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].enableRefresh();\n  _redraw_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].compositeAll();\n  refreshTab(\"tools\");\n  root_layer.children[root_layer.children.length - 1].select(); //refreshTab(\"color_selector_tab\");\n  //createRGBA();\n\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].changeColor(null);\n  CommandLog.reset();\n\n  if (brushes.length > 0) {\n    brushes[0].select();\n  }\n};\n\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].addDialog(\"loading\", `\n\t\tファイル読み込み中...\n\n\t\t`);\n\nvar setParam = function (dst, src) {\n  var keys = Object.keys(src);\n\n  for (var ki = 0; ki < keys.length; ki++) {\n    var key = keys[ki];\n\n    if (typeof dst[key] === \"number\") {\n      dst[key] = Number(src[key]);\n    } else {\n      dst[key] = src[key];\n    }\n  }\n};\n\nvar addBrush = function (buffer) {\n  var files = _lib_zip_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].read(buffer);\n  var doc_file = files.find(function (f) {\n    return f.name === \"doc.txt\";\n  });\n\n  if (!doc_file) {\n    return;\n  }\n\n  var doc_data = JSON.parse(_lib_util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].utf8ToString(doc_file.data));\n\n  for (var bi = 0; bi < doc_data.brushes.length; bi++) {\n    //ブラシ読み込み\n    var doc_brush = doc_data.brushes[bi];\n    var brush = _brush_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].create();\n    brushes.push(brush); //パラメータ設定\n\n    var id = brush.id;\n    setParam(brush, doc_brush);\n    brush.id = id;\n    brush.refresh();\n  }\n\n  _brush_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].refreshBrush();\n};\n\nclass FileManager {\n  constructor() {}\n\n  static saveHpd(e) {\n    //ドキュメントファイル保存\n    var files = [];\n    var doc_data = {};\n    var brushes = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].brushes;\n    var layers = _layer_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].layerArray();\n    doc_data.layers = [];\n\n    for (var li = 0; li < layers.length; li++) {\n      var layer = layers[li];\n      var layer2 = {}; //レイヤをopneExrファイル化\n\n      if (layer.type === 0) {\n        //通常レイヤ\n        var file = {};\n        files.push(file);\n        file.data = new Uint8Array(layer.img.createExr(3));\n        file.name = layer.id + \".exr\";\n      } else {\n        //グループレイヤ\n        //モディファイア\n        layer2.size = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec2();\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec2.copy(layer2.size, layer.size);\n      } //レイヤ情報収集\n\n\n      var keys = Object.keys(layer);\n\n      for (var ki = 0; ki < keys.length; ki++) {\n        layer2[keys[ki]] = layer[keys[ki]];\n      } //親子関係をid化\n\n\n      if (layer.children) {\n        layer2.children = [];\n\n        for (var ki = 0; ki < layer.children.length; ki++) {\n          layer2.children.push(layer.children[ki].id);\n        }\n      } //不要なデータを削除\n\n\n      delete layer2.img;\n      delete layer2.parent;\n      delete layer2.div;\n      delete layer2.aaadiv;\n      doc_data.layers.push(layer2);\n    } //ブラシ情報セット\n\n\n    doc_data.brushes = [];\n\n    for (var bi = 0; bi < brushes.length; bi++) {\n      var brush = brushes[bi];\n      var brush2 = {}; //情報収集\n\n      var keys = Object.keys(brush);\n\n      for (var ki = 0; ki < keys.length; ki++) {\n        brush2[keys[ki]] = brush[keys[ki]];\n      } //不要なデータを削除\n\n\n      delete brush2.div;\n      doc_data.brushes.push(brush2);\n    } //その他情報をセット\n\n\n    doc_data.canvas_width = preview.width;\n    doc_data.canvas_height = preview.height;\n    var keys = Object.keys(inputs);\n\n    for (var i = 0; i < keys.length; i++) {\n      var id = keys[i];\n      var input = inputs[id];\n      doc_data[id] = input.value;\n\n      if (input.type === \"checkbox\") {\n        if (input.checked) {\n          doc_data[id] = 1;\n        } else {\n          doc_data[id] = 0;\n        }\n      }\n    }\n\n    doc_data.layer_id_count = _layer_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].layer_id_count; //ドキュメント情報をdoc.txtとして書き込む\n\n    var file = {};\n    file.data = _lib_util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].stringToUtf8(JSON.stringify(doc_data));\n    file.name = \"doc.txt\";\n    files.push(file); //doc.txtと画像ファイルを無圧縮zipにする\n\n    var buffer = _lib_zip_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].create(files, 0);\n    var blob = new Blob([buffer], {\n      type: \"application/octet-stream\"\n    });\n    var a = e.target;\n    a.href = window.URL.createObjectURL(blob);\n    a.target = '_blank';\n    a.download = \"project.hpd\";\n  }\n\n  static loadHpd(file) {\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].showDialog(\"loading\");\n    _lib_util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].loadBinary(file, function (buffer) {\n      loadHpd_(buffer);\n      var log = CommandLog.createLog(\"loadDocumentFile\", {\n        \"file\": file.name\n      });\n      CommandLog.appendOption(log);\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].closeDialog();\n    });\n  }\n\n  static saveHdr(e) {\n    var a = e.target;\n    var buffer = root_layer.img.createExr(3);\n    var blob = new Blob([buffer], {\n      type: \"application/octet-stream\"\n    });\n    a.href = window.URL.createObjectURL(blob);\n    a.target = '_blank';\n    a.download = \"preview_hdr.exr\";\n  }\n\n  static saveLdr(e) {\n    var a = e.target;\n    a.href = preview.toDataURL(\"image/png\");\n    a.target = '_blank';\n    a.download = \"preview_ldr.png\";\n  }\n\n}\n\n//# sourceURL=webpack://hdrpaint/./src/file.js?");

/***/ }),

/***/ "./src/hdrpaint.js":
/*!*************************!*\
  !*** ./src/hdrpaint.js ***!
  \*************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lib/util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./layer.js */ \"./src/layer.js\");\n/* harmony import */ var _commandlog_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./commandlog.js */ \"./src/commandlog.js\");\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./lib/vector.js */ \"./src/lib/vector.js\");\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\n\n\n\nclass Hdrpaint {\n  constructor() {\n    _defineProperty(this, \"onlyExecute\", function (command, param) {\n      if (param.layer_id && command !== \"changeLayerAttribute\") {\n        var layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(param.layer_id);\n\n        if (layer) {\n          if (layer.lock || !layer.display) {\n            return;\n          }\n        }\n      }\n\n      var commandObjs = this.commandObjs;\n      log.obj = new commandObjs[command]();\n      log.obj.param = param;\n      log.obj.func();\n    });\n\n    _defineProperty(this, \"blendfuncs\", {});\n\n    _defineProperty(this, \"blendfuncsname\", [\"normal\", \"mul\", \"add\", \"sub\", \"transmit\"]);\n\n    _defineProperty(this, \"addDialog\", function (id, html) {\n      var div = document.createElement(\"div\");\n      div.id = id;\n      div.style.display = \"none\";\n      div.classList.add(\"area\");\n      div.classList.add(\"dialog\");\n      div.insertAdjacentHTML('beforeend', html);\n      var dialog_parent = document.querySelector(\".dialog_parent\");\n      dialog_parent.appendChild(div);\n    });\n\n    _defineProperty(this, \"modifier\", {});\n\n    _defineProperty(this, \"registModifier\", (mod, name, html) => {\n      mod.prototype.typename = name;\n      this.modifier[name] = mod;\n      var div = document.createElement(\"div\");\n      div.id = \"div_\" + name;\n      div.classList.add(\"modifier_param\");\n      div.insertAdjacentHTML('beforeend', html);\n      var nodes = div.querySelectorAll(\"*[name]\");\n\n      for (var i = 0; i < nodes.length; i++) {\n        var node = nodes[i];\n        var nodename = node.getAttribute(\"name\");\n        node.setAttribute(\"title\", nodename);\n        node.setAttribute(\"bind:\", \"selected_layer.\" + nodename);\n      }\n\n      var dialog_parent = document.querySelector(\"#modifier_param_area\");\n      dialog_parent.appendChild(div);\n      var area = document.querySelector(\"#modifier_area\");\n      var input = document.createElement(\"input\");\n      input.type = \"button\";\n      input.title = name;\n      input.value = name;\n      area.appendChild(input);\n      this.stylesheet.insertRule(` \n\t\t\t#modifier_param_area[modifier=\"${name}\"] div#div_${name}{\n\t\t\t\tdisplay:inline;\n\t\t\t}\n\t\t`, this.stylesheet.cssRules.length);\n    });\n\n    _defineProperty(this, \"clearSelectArea\", () => {\n      //選択解除\n      this.selected_area_enable = false;\n    });\n\n    this.root_layer = null; //最上位レイヤ\n\n    this.selected_tool = \"pen\"; //選択しているツール\n\n    this.selected_layer_only = false; //選択レイヤのみプレビューに表示\n\n    this.color = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec4();\n    this.cursor_color = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec4(); //カーソル下のピクセル色\n    //現在選択状態にあるブラシ\n\n    this.selected_brush = null;\n    this.Command = {};\n    this.commandObjs = {};\n    this.painted_mask = new Float32Array(1024 * 1024); //選択レイヤ\n\n    this.selected_layer = null; //選択範囲\n\n    this.select_rectangle = null; //{x:0,y:0,x2:0,y2:0};\n\n    this.mode = \"\";\n    this.layer_id_count = 0; //全ブラシ\n\n    this.brushes = []; //ブラシ設定\n\n    this.brush_status = {};\n    this.post_effect = {\n      ch_bloom: false,\n      bloom_power: 0.2,\n      bloom_size: 8,\n      ev: 0,\n      ch_gamma: false,\n      gamma: 2.2\n    };\n  } // レイヤの範囲を表す点線 \n\n\n  refreshLayerRectangle() {\n    if (!this.selected_layer) return;\n    var rect = document.querySelector(\".layer_rectangle\");\n    var doc = this.doc;\n    rect.style.left = this.selected_layer.position[0] + doc.canvas_pos[0] - 1 + \"px\";\n    rect.style.top = this.selected_layer.position[1] + doc.canvas_pos[1] - 1 + \"px\";\n    rect.style.width = this.selected_layer.size[0] + \"px\";\n    rect.style.height = this.selected_layer.size[1] + \"px\";\n    rect.style.display = \"inline-block\";\n  }\n\n  getSelectArea() {\n    //領域選択されていない場合はレイヤー全体を選択\n    var rectangle = {};\n\n    if (!this.select_rectangle) {\n      rectangle.x = 0;\n      rectangle.y = 0;\n      rectangle.w = this.selected_layer.size[0];\n      rectangle.h = this.selected_layer.size[1];\n    } else {\n      rectangle.x = this.select_rectangle.x;\n      rectangle.y = this.select_rectangle.y;\n      rectangle.w = this.select_rectangle.w;\n      rectangle.h = this.select_rectangle.h;\n    }\n\n    return rectangle;\n  }\n\n  select(target_layer) {\n    //アクティブレイヤ変更\n    this.selected_layer = target_layer;\n    _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].eachLayers(function (layer) {\n      if (target_layer !== layer) {\n        //アクティブレイヤ以外の表示を非アクティブにする\n        layer.dom.classList.remove(\"active\");\n      } else {\n        layer.dom.classList.add(\"active\");\n      }\n    });\n\n    if (inputs[\"selected_layer_only\"].checked) {\n      refreshPreview(1);\n    }\n\n    this.refreshLayerRectangle();\n  }\n\n  setLayerIdCount(id) {\n    this.layer_id_count = id;\n  }\n\n  createLayer(img, composite_flg) {\n    var layer = new _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"]();\n\n    if (composite_flg) {\n      //グループレイヤの場合\n      layer.type = 1;\n      layer.children = [];\n    }\n\n    if (layer.type == 1) {\n      layer.dom.classList.add(\"group\");\n    } //layer_div.addEventListener(\"click\",layerSelect);\n\n\n    layer.img = img;\n\n    if (img) {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec2.set(layer.size, img.width, img.height);\n    }\n\n    layer.id = this.layer_id_count;\n    this.layer_id_count++;\n    layer.name = \"layer\" + (\"0000\" + layer.id).slice(-4);\n    layer.refreshDiv();\n    layer.registRefreshThumbnail();\n    return layer;\n  }\n\n  createModifier(modifier_name) {\n    var layer = new this.modifier[modifier_name]();\n    layer.type = 2;\n\n    if (layer.children) {\n      layer.dom.classList.add(\"group\");\n    }\n\n    layer.dom.classList.add(\"modifier\");\n    layer.img = null;\n    layer.id = this.layer_id_count;\n    this.layer_id_count++;\n    layer.modifier = modifier_name;\n    layer.name = modifier_name + (\"0000\" + layer.id).slice(-4);\n    layer.refreshDiv();\n    layer.registRefreshThumbnail();\n    return layer;\n  }\n\n  createNewCompositeLayer(e) {\n    //新規コンポジットレイヤを作成\n    var data = this.getPosition();\n    var width = preview.width;\n    var height = preview.height;\n    this.executeCommand(\"createNewCompositeLayer\", {\n      \"parent\": data.parent_layer.id,\n      \"position\": data.position,\n      \"width\": width,\n      \"height\": height,\n      \"composite_flg\": 1\n    });\n  }\n\n  createNewModifier(e) {\n    if (e.target.value === \"\") {\n      return;\n    }\n\n    var modifier = e.target.value; //新規モディファイア\n\n    var data = this.getPosition();\n    this.executeCommand(\"createmodifier\", {\n      \"modifier\": modifier,\n      \"parent_layer_id\": data.parent_layer.id,\n      \"position\": data.position,\n      \"width\": data.parent_layer.size[0],\n      \"height\": data.parent_layer.size[1]\n    });\n  }\n\n  copylayer(e) {\n    //レイヤコピー\n    var data = this.getPosition();\n    this.executeCommand(\"copylayer\", {\n      \"position\": data.position,\n      \"parent\": data.parent_layer.id,\n      \"src_layer_id\": this.selected_layer.id\n    });\n  }\n\n  redo() {\n    //リドゥ\n    var option_index = inputs[\"history\"].selectedIndex;\n    var options = inputs[\"history\"].options;\n\n    if (option_index === options.length - 1) {\n      return;\n    }\n\n    option_index++;\n    var option = options[option_index];\n    inputs[\"history\"].selectedIndex = option_index;\n    _commandlog_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].moveLog(parseInt(option.value));\n  }\n\n  undo() {\n    //アンドゥ\n    var option_index = inputs[\"history\"].selectedIndex;\n    var options = inputs[\"history\"].options;\n\n    if (option_index === 0) {\n      return;\n    }\n\n    var option = options[option_index - 1];\n\n    if (option.disabled) {\n      return;\n    }\n\n    option_index--;\n    inputs[\"history\"].selectedIndex = option_index;\n    _commandlog_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].moveLog(parseInt(option.value));\n  }\n\n  createNewLayer(e) {\n    //新規レイヤを作成\n    var data = this.getPosition();\n    var width = data.parent_layer.size[0];\n    var height = data.parent_layer.size[1];\n    this.executeCommand(\"createNewLayer\", {\n      \"position\": data.position,\n      \"parent\": data.parent_layer.id,\n      \"width\": width,\n      \"height\": height\n    });\n  }\n\n  getPosition() {\n    var data = {};\n\n    if (!this.selected_layer) {\n      data.parent_layer_id = Hdrpaint.root_layer.id;\n      data.parent_layer = Hdrpaint.root_layer;\n      data.position = Hdrpaint.root_layer.length;\n    } else {\n      if (this.selected_layer.children && this.selected_layer.dom.classList.contains(\"open\")) {\n        data.parent_layer_id = this.selected_layer.id;\n        data.parent_layer = this.selected_layer;\n        data.position = this.selected_layer.length;\n      } else {\n        data.parent_layer_id = this.selected_layer.parent.id;\n        data.parent_layer = this.selected_layer.parent;\n        data.position = this.selected_layer.parent.children.indexOf(this.selected_layer) + 1;\n      }\n    }\n\n    return data;\n  }\n\n  loadImageFile_(file) {\n    var data = this.getPosition();\n\n    var fu = function (img) {\n      var log = this.executeCommand(\"loadImage\", {\n        \"img\": img,\n        \"file\": file.name,\n        \"parent_layer_id\": data.parent_layer_id,\n        \"position\": data.position\n      });\n    };\n\n    if (/.*exr$/.test(file.name)) {\n      _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].loadExr(file, 0, fu);\n    } else if (/^image\\//.test(file.type)) {\n      _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].loadImg(file, 0, fu);\n    }\n  }\n\n  createDif(layer, left, top, width, height) {\n    //更新領域の古い情報を保存\n    var img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](width, height);\n    _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].copy(img, 0, 0, layer.img, left, top, width, height);\n    var dif = {};\n    dif.img = img;\n    dif.x = left;\n    dif.y = top;\n    return dif;\n  }\n\n  removeLayer(layer) {\n    var parent_layer = layer.parent;\n    var layers = parent_layer.children;\n    var idx = layers.indexOf(layer);\n    layers.splice(idx, 1);\n\n    if (layer == this.selected_layer) {\n      if (parent_layer.children.length > 0) {\n        if (parent_layer.children.length <= idx) {\n          idx = parent_layer.children.length - 1;\n        }\n\n        parent_layer.children[idx].select();\n      }\n    }\n\n    parent_layer.refreshDiv();\n    parent_layer.bubbleComposite();\n  }\n\n  executeCommand(command, param, flg) {\n    if (param.layer_id && command !== \"changeLayerAttribute\" && command !== \"moveLayer\") {\n      var layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(param.layer_id);\n\n      if (layer) {\n        if (layer.lock || !layer.display) {\n          return null;\n        }\n      }\n    }\n\n    var log = _commandlog_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].createLog(command, param, flg);\n    _commandlog_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].appendOption();\n    var commandObjs = this.commandObjs;\n\n    if (!log.obj) {\n      log.obj = new commandObjs[command]();\n    }\n\n    log.obj.param = param;\n    log.obj.func();\n    log.refreshLabel();\n    return log;\n  } //ブレンドファンクション\n\n\n  addFilter(id, name) {\n    var a = document.createElement(\"a\");\n    a.id = id;\n    _lib_util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setText(a, name);\n    a.setAttribute(\"href\", \"#\");\n    var area = document.getElementById(\"additional\");\n    area.appendChild(a);\n  }\n\n  showDialog(id) {\n    document.getElementById(id).style.display = \"inline\";\n    document.querySelector(\".dialog_parent\").style.display = \"flex\";\n  }\n\n  closeDialog() {\n    var parent = document.querySelector(\".dialog_parent\");\n    parent.style.display = \"none\";\n\n    for (var i = 0; i < parent.children.length; i++) {\n      parent.children[i].style.display = \"none\";\n    }\n  }\n\n}\n\nconst hdrpaint = new Hdrpaint(); //動的スタイルシート生成\n\nvar newStyle = document.createElement('style');\nnewStyle.type = \"text/css\";\ndocument.getElementsByTagName('head').item(0).appendChild(newStyle);\nhdrpaint.stylesheet = document.styleSheets.item(document.styleSheets.length - 1);\n/* harmony default export */ __webpack_exports__[\"default\"] = (hdrpaint);\n\n//# sourceURL=webpack://hdrpaint/./src/hdrpaint.js?");

/***/ }),

/***/ "./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _main_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./main.js */ \"./src/main.js\");\n\n\n//# sourceURL=webpack://hdrpaint/./src/index.js?");

/***/ }),

/***/ "./src/layer.js":
/*!**********************!*\
  !*** ./src/layer.js ***!
  \**********************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Layer; }\n/* harmony export */ });\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _redraw_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./redraw.js */ \"./src/redraw.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _lib_util_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./lib/util.js */ \"./src/lib/util.js\");\n\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\n\n\nvar arr = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\nlet stackThumbnail = [];\nlet composite_img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](512, 512);\nlet composite_area = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\nvar drag_layer = null;\n\nvar refreshThumbnail = function () {\n  if (Layer.enableRefreshThumbnail) {\n    var layer = stackThumbnail.shift();\n    layer.refreshThumbnail();\n  }\n\n  if (stackThumbnail.length > 0) {\n    window.requestAnimationFrame(function (e) {\n      refreshThumbnail();\n    });\n  }\n};\n\nvar getLayerFromDiv = function (div) {\n  var result_layer = null;\n  Layer.eachLayers(function (layer) {\n    if (layer.dom == div) {\n      result_layer = layer;\n      return true;\n    }\n  });\n  return result_layer;\n}; //レイヤサムネイル作成用\n\n\nvar thumbnail_img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](64, 64, 1); //ジェネレータサムネイル作成用\n\nvar gen_thumbnail_img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](240, 40, 0);\n\nvar click = function (e) {\n  //レイヤー一覧クリック時、クリックされたものをアクティブ化する\n  var layer = getLayerFromDiv(e.currentTarget);\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].select(layer);\n  e.stopPropagation();\n}; //ドラッグ＆ドロップによるレイヤ順編集\n\n\nvar DragStart = function (event) {\n  //ドラッグ開始\n  drag_layer = getLayerFromDiv(event.currentTarget); //     event.dataTransfer.setData(\"text\", drag_layer.id);\n\n  drag_layer.select;\n  event.stopPropagation();\n};\n\nvar DragOver = function (event) {\n  event.preventDefault(); // event.dataTransfer.dropEffect = \"move\";\n};\n\nvar DragEnter = function (event) {\n  //ドラッグ移動時\n  var drop_layer = getLayerFromDiv(event.currentTarget.parentNode);\n\n  if (!drop_layer) {\n    return;\n  }\n\n  event.stopPropagation();\n\n  if (drag_layer === drop_layer) {\n    //自分自身の場合は無視\n    return;\n  }\n\n  if (drag_layer.type !== 0) {\n    //グループレイヤドラッグ時は、自身の子になるかチェックし、その場合は無視\n    var flg = false;\n    Layer.bubble_func(drop_layer, function (layer) {\n      if (layer === drag_layer) {\n        flg = true;\n        return true;\n      }\n    });\n\n    if (flg) {\n      return;\n    }\n  }\n\n  var parent_layer = drop_layer.parent; //Layer.findParent(drop_layer);\n\n  var position = parent_layer.children.indexOf(drop_layer);\n  var now_position = parent_layer.children.indexOf(drag_layer);\n\n  if (now_position < 0) {\n    position++;\n  }\n\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].executeCommand(\"moveLayer\", {\n    \"layer_id\": drag_layer.id,\n    \"parent_layer_id\": parent_layer.id,\n    \"position\": position\n  });\n};\n\nvar DragEnterChild = function (event) {\n  //ドラッグ移動時\n  var drop_layer = getLayerFromDiv(event.currentTarget);\n  event.stopPropagation();\n  var drag = parseInt(event.dataTransfer.getData(\"text\"));\n  var parent_layer = getLayerFromDiv(event.currentTarget.parentNode);\n\n  if (drag_layer.type !== 0) {\n    //グループレイヤドラッグ時は、自身の子になるかチェックし、その場合は無視\n    var flg = false;\n    Layer.bubble_func(parent_layer, function (layer) {\n      if (layer === drag_layer) {\n        flg = true;\n        return true;\n      }\n    });\n\n    if (flg) {\n      return;\n    }\n  }\n\n  var position = 0;\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].executeCommand(\"moveLayer\", {\n    \"layer_id\": drag_layer.id,\n    \"parent_layer_id\": parent_layer.id,\n    \"position\": position\n  });\n};\n\nvar opencloseClick = function (e) {\n  var layer = getLayerFromDiv(event.target.parentNode);\n  layer.dom.classList.toggle(\"open\");\n  e.preventDefault();\n  return false;\n};\n\nclass Layer {\n  //レイヤ\n  constructor() {\n    this.name = \"\";\n    this.display = true;\n    this.lock = false;\n    this.power = 0.0;\n    this.alpha = 1.0;\n    this.blendfunc = \"normal\";\n    this.modifier = \"layer\";\n    this.div = null;\n    this.img = null;\n    this.mask_alpha = 0;\n    this.position = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\n    this.size = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\n    this.modifier_param = {};\n    this.type = 0; //1なら階層レイヤ ,2ならモデファイア\n\n    this.children = null; //子供レイヤ\n\n    var html = `\n\t\t\t\t<a href=\"#\" class=\"openclosebutton\">\n\t\t\t\t</a>\n\t\t\t\t<div class=\"layer_dragenter\" > </div>\n\t\t\t\t<div class=\"thumbnailouter\" >\n\t\t\t\t\t<img class=\"thumbnail\" >\n\t\t\t\t</div>\n\t\t\t\t<div class=\"name\"></div>\n\t\t\t\t<div class=\"layer_attributes\"></div>\n\t\t\t\t<div class=\"children\"></div>\n\t\t\t`;\n    var dom = document.createElement(\"div\");\n    dom.insertAdjacentHTML('beforeend', html);\n    dom.classList.add(\"layer\");\n    dom.classList.add(\"open\");\n    dom.setAttribute(\"draggable\", \"true\");\n    dom.addEventListener(\"dragstart\", DragStart);\n    dom.addEventListener(\"dragover\", DragOver);\n    dom.addEventListener(\"click\", click);\n    dom.querySelector(\".openclosebutton\").addEventListener(\"click\", opencloseClick);\n    dom.querySelector(\".layer_dragenter\").addEventListener(\"dragenter\", DragEnter);\n    dom.querySelector(\".children\").addEventListener(\"dragenter\", DragEnterChild);\n    this.dom = dom;\n    binder.bind(dom.querySelector(\".name\"), \"\", this, \"name\");\n  }\n\n  //レイヤ合成開始前処理\n  before(area) {}\n\n  //レイヤ合成直前処理\n  beforeReflect() {}\n\n  //レイヤ合成処理\n  reflect(img, x, y, w, h) {\n    var x = Math.max(img.offsetx, composite_area[0]);\n    var y = Math.max(img.offsety, composite_area[1]);\n    var x1 = Math.min(img.width + img.offsetx, composite_area[2] + composite_area[0]);\n    var y1 = Math.min(img.height + img.offsety, composite_area[3] + composite_area[1]);\n    var layer = this;\n    var img_data = img.data;\n    var img_width = img.width;\n    var layer_img_data = layer.img.data;\n    var layer_alpha = layer.alpha;\n    var layer_power = Math.pow(2, layer.power);\n    var layer_img_width = layer.img.width;\n    var func = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].blendfuncs[layer.blendfunc];\n    var layer_position_x = layer.position[0];\n    var layer_position_y = layer.position[1]; //レイヤのクランプ\n\n    var left2 = Math.max(x, layer.position[0]);\n    var top2 = Math.max(y, layer.position[1]);\n    var right2 = Math.min(layer.img.width + layer_position_x, x1);\n    var bottom2 = Math.min(layer.img.height + layer_position_y, y1);\n\n    for (var yi = top2; yi < bottom2; yi++) {\n      var idx = (yi - img.offsety) * img_width + left2 - img.offsetx << 2;\n      var max = (yi - img.offsety) * img_width + right2 - img.offsetx << 2;\n      var idx2 = (yi - layer_position_y) * layer_img_width + left2 - layer_position_x << 2;\n      var xi = left2;\n\n      for (; idx < max; idx += 4) {\n        func(img_data, idx, layer_img_data, idx2, layer_alpha, layer_power);\n        idx2 += 4;\n        xi++;\n      }\n    }\n  }\n\n  //レイヤ合成\n  composite(left, top, right, bottom) {\n    var layers = this.children;\n    var pow = 0;\n\n    if (typeof left === 'undefined') {\n      left = 0;\n      top = 0;\n      right = this.img.width - 1;\n      bottom = this.img.height - 1;\n    }\n\n    if (this.type !== 1) {\n      return;\n    }\n\n    var width = right - left + 1;\n    var height = bottom - top + 1;\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.set(composite_area, left, top, width, height);\n\n    for (var li = layers.length; li--;) {\n      var layer = layers[li];\n\n      if (!layer.display) {\n        //非表示の場合スルー\n        continue;\n      }\n\n      layer.before(composite_area);\n    }\n\n    left = Math.max(0, composite_area[0]);\n    top = Math.max(0, composite_area[1]);\n    right = Math.min(this.img.width, composite_area[2] + left);\n    bottom = Math.min(this.img.height, composite_area[3] + top);\n\n    if (composite_img.data.length < (right - left) * (bottom - top) << 2) {\n      composite_img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](right - left, bottom - top);\n    }\n\n    composite_img.offsetx = left;\n    composite_img.offsety = top;\n    composite_img.width = right - left;\n    composite_img.height = bottom - top;\n\n    if (this === _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].root_layer) {\n      var bg = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].doc.background_color;\n      composite_img.fill(bg[0], bg[1], bg[2], bg[3], 0, 0, composite_img.width, composite_img.height);\n    } else {\n      composite_img.clear(0, 0, composite_img.width, composite_img.height);\n    }\n\n    for (var li = 0; li < layers.length; li++) {\n      var layer = layers[li];\n\n      if (!layer.display) {\n        //非表示の場合スルー\n        continue;\n      }\n\n      layer.beforeReflect();\n      layer.reflect(composite_img, composite_area);\n    }\n\n    var x0 = composite_area[0];\n    var x1 = composite_area[0] + composite_area[2];\n    var y0 = composite_area[1];\n    var y1 = composite_area[1] + composite_area[3];\n    x0 = Math.max(0, x0);\n    y0 = Math.max(0, y0);\n    x1 = Math.min(this.img.width, x1);\n    y1 = Math.min(this.img.height, y1);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.set(composite_area, x0, y0, x1 - x0, y1 - y0);\n    _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].copy(this.img, composite_area[0], composite_area[1], composite_img, -composite_img.offsetx + composite_area[0], -composite_img.offsety + composite_area[1], composite_area[2], composite_area[3]);\n\n    if (this === _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].root_layer) {\n      //ルートレイヤの場合はプレビュー更新\n      _redraw_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].refreshPreview(0, composite_area[0], composite_area[1], composite_area[2], composite_area[3]);\n    } else {\n      //通常レイヤの場合はサムネ更新\n      this.registRefreshThumbnail();\n    }\n  }\n\n  getPixel(ret, idx, x, y) {\n    if (!this.img) {\n      return;\n    }\n\n    if (x < 0 || y < 0 || x >= this.img.width || y >= this.img.height) {\n      return ret;\n    }\n\n    if (y === undefined) {\n      y = x;\n      x = idx;\n      idx = 0;\n    }\n\n    if (this.img.data) {\n      var data = this.img.data;\n      var idx2 = this.img.getIndex(x, y) << 2;\n      ret[idx + 0] = data[idx2];\n      ret[idx + 1] = data[idx2 + 1];\n      ret[idx + 2] = data[idx2 + 2];\n      ret[idx + 3] = data[idx2 + 3];\n    }\n\n    return ret;\n  }\n\n  static bubble_func(layer, f) {\n    //親に伝搬する処理\n    f(layer); //var parent_layer= Layer.findParent(layer);\n\n    var parent_layer = layer.parent;\n\n    if (parent_layer) {\n      Layer.bubble_func(parent_layer, f);\n    }\n  }\n\n  static eachLayers(f) {\n    if (!_hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].root_layer) {\n      return;\n    }\n\n    var cb = function (layer) {\n      if (f(layer)) {\n        return true;\n      }\n\n      if (layer.type === 0) {\n        return false;\n      }\n\n      var layers = layer.children;\n\n      if (layers) {\n        for (var i = 0; i < layers.length; i++) {\n          if (cb(layers[i])) {\n            return true;\n          }\n        }\n      }\n\n      return false;\n    };\n\n    return cb(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].root_layer);\n  }\n\n  static findById(layer_id) {\n    var result_layer = null;\n    Layer.eachLayers(function (layer) {\n      if (layer.id == layer_id) {\n        result_layer = layer;\n        return true;\n      }\n    });\n    return result_layer;\n  }\n\n  static layerArray() {\n    var layers = [];\n    Layer.eachLayers(function (layer) {\n      layers.push(layer);\n    });\n    return layers;\n  }\n\n  refreshImg(x, y, w, h) {\n    var layer = this;\n    var left = 0;\n    var right = layer.img.width - 1;\n    var top = 0;\n    var bottom = layer.img.height - 1;\n\n    if (typeof w !== 'undefined') {\n      //更新領域設定、はみ出している場合はクランプする\n      left = Math.max(left, x);\n      right = Math.min(right, x + w - 1);\n      top = Math.max(top, y);\n      bottom = Math.min(bottom, y + h - 1);\n    }\n\n    left = Math.floor(left);\n    right = Math.ceil(right);\n    top = Math.floor(top);\n    bottom = Math.ceil(bottom);\n    var width = right - left + 1;\n    var height = bottom - top + 1;\n\n    if (layer.parent) {\n      if (typeof w === 'undefined') {\n        layer.parent.bubbleComposite();\n      } else {\n        layer.parent.bubbleComposite(left + layer.position[0], top + layer.position[1], right - left + 1, bottom - top + 1);\n      }\n    }\n\n    this.registRefreshThumbnail();\n  }\n\n  bubbleComposite(x, y, w, h) {\n    if (typeof x === 'undefined') {\n      x = 0;\n      y = 0;\n      w = this.size[0];\n      h = this.size[1];\n    }\n\n    var left = x;\n    var top = y;\n    var right = x + w - 1;\n    var bottom = y + h - 1;\n    left = Math.max(0, left);\n    top = Math.max(0, top);\n\n    if (this.img) {\n      right = Math.min(this.img.width - 1, right);\n      bottom = Math.min(this.img.height - 1, bottom);\n    }\n\n    left = Math.floor(left);\n    right = Math.ceil(right);\n    top = Math.floor(top);\n    bottom = Math.ceil(bottom);\n\n    if (left == right || top == bottom) {\n      return;\n    }\n\n    if (this.type === 2) {\n      if (this.parent) {\n        this.parent.bubbleComposite(left + this.position[0], top + this.position[1], right - left + 1, bottom - top + 1);\n      }\n\n      return;\n    }\n\n    if (typeof x === 'undefined') {\n      this.composite();\n    } else {\n      this.composite(left, top, right, bottom);\n    }\n\n    if (this.parent) {\n      this.parent.bubbleComposite(left + this.position[0], top + this.position[1], right - left + 1, bottom - top + 1);\n    }\n  }\n\n  showDivParam() {\n    var layer = this;\n    var txt = \"\";\n    txt += \"offset:[\" + layer.position[0] + \",\" + layer.position[1] + \"]\" + \"size:[\" + layer.size[0] + \",\" + layer.size[1] + \"]<br>\";\n    layer.power = Number(layer.power);\n    txt += \"pow:\" + layer.power.toFixed(2) + \"\";\n    layer.alpha = Number(layer.alpha);\n    txt += \"α:\" + layer.alpha.toFixed(2) + \"<br>\";\n    return txt;\n  }\n\n  refreshDiv() {\n    var layer = this;\n    var layers_container = null;\n\n    if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].selected_layer === layer) {\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].refreshLayerRectangle();\n    }\n\n    if (layer === _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].root_layer) {\n      layers_container = document.getElementById(\"layers_container\");\n    } else {\n      //layer.dom.className=\"layer\";\n      if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].selected_layer === layer) {\n        layer.dom.classList.add(\"active\");\n      } else {\n        layer.dom.classList.remove(\"active\");\n      }\n\n      if (layer.type === 0 || !layer.children) {\n        layer.dom.classList.remove(\"group\");\n      } else {\n        layer.dom.classList.add(\"group\");\n      }\n\n      var div = layer.dom.getElementsByClassName(\"name\")[0];\n      var name = layer.name;\n\n      if (!this.display) {\n        name += \"(非表示)\";\n        layer.dom.classList.add(\"invisible\");\n      } else {\n        layer.dom.classList.remove(\"invisible\");\n      }\n\n      if (this.lock) {\n        name += \"(lock)\";\n        layer.dom.classList.add(\"lock\");\n      } else {\n        layer.dom.classList.remove(\"lock\");\n      }\n\n      if (this.mask_alpha) {\n        name += \"(αlock)\";\n      } //div.innerHTML=name;\n\n\n      var span = layer.dom.getElementsByClassName(\"layer_attributes\")[0];\n      var txt = \"\";\n\n      if (layer.type === 2) {\n        txt += \"modifier:\" + layer.modifier + \"<br>\";\n      } else {\n        txt += \"func:\" + layer.blendfunc + \"<br>\";\n      }\n\n      txt += layer.showDivParam();\n      span.innerHTML = txt;\n      layers_container = layer.dom.getElementsByClassName(\"children\")[0];\n    } //子レイヤ設定\n\n\n    while (layers_container.firstChild) layers_container.removeChild(layers_container.firstChild);\n\n    if (layer.children) {\n      for (var li = layer.children.length; li--;) {\n        layers_container.appendChild(layer.children[li].dom);\n      }\n    } //\t\tif(layer === Hdrpaint.selected_layer){\n    //\t\t\tHdrpaint.refreshActiveLayerParam();\n    //\t\t}\n\n  }\n\n  append(idx, layer) {\n    var layers = this.children;\n    layers.splice(idx, 0, layer);\n    layer.parent = this;\n    this.refreshDiv(); //refreshMain();\n\n    this.bubbleComposite();\n  }\n\n  refreshThumbnail() {\n    //レイヤサムネイル更新\n    var layer = this;\n    var sum = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\n\n    if (layer.type === 2) {\n      var img = gen_thumbnail_img;\n      var newx = img.width;\n      var newy = img.height;\n      layer.beforeReflect(img);\n      img.offsetx = 0;\n      img.offsety = 0; //img.scan(function(ret,idx,x,y){\n      //\tlayer.getPixel(arr,x,y);\n      //\tret[idx+0]=arr[0];\n      //\tret[idx+1]=arr[1];\n      //\tret[idx+2]=arr[2];\n      //\tret[idx+3]=arr[3];\n      //});\n\n      layer.reflect(img, [0, 0, img.width, img.height]);\n      layer.dom.style.backgroundImage = \"url(\" + img.toDataURL() + \"),url(./css/back.png)\"; //\t\timg.toBlob((blob)=>{\n      //\t\t\tURL.revokeObjectURL(img.src);\n      //\t\t\tlayer.dom.style.backgroundImage = \"url(\"  + URL.createObjectURL(blob); +\")\";\n      //\t\t});\n\n      return;\n    }\n\n    if (!layer.img) {\n      return;\n    }\n\n    if (!layer.img.data) {\n      return;\n    }\n\n    var img = layer.img;\n    var img_data = img.data;\n    var layer_img = layer.dom.getElementsByTagName(\"img\")[0];\n    var can = img.toCanvas();\n    var ctx = _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].ctx;\n    var r = img.width;\n\n    if (img.width < img.height) {\n      r = img.height;\n      layer_img.style.width = \"auto\";\n      layer_img.style.height = \"100%\";\n    } else {\n      layer_img.style.width = \"100%\";\n      layer_img.style.height = \"auto\";\n    }\n\n    r /= 64;\n    var newx = img.width / r | 0;\n    var newy = img.height / r | 0;\n    thumbnail_img.clear(0, 0, newx, newy);\n    var data = img.data;\n    var dst_data = thumbnail_img.data;\n\n    var _255 = 1 / 255;\n\n    var ev = Number(inputs[\"ev\"].value);\n    var ev2 = Math.pow(2, -ev) * 255;\n    var rr255 = 255 / (r * r);\n\n    for (var yi = 0; yi < newy; yi++) {\n      for (var xi = 0; xi < newx; xi++) {\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.set(sum, 0, 0, 0, 0);\n\n        for (var yii = 0; yii < r; yii++) {\n          for (var xii = 0; xii < r; xii++) {\n            var idx = img.getIndex(xi * r + xii | 0, yi * r + yii | 0) << 2;\n            var alpha = data[idx + 3];\n            sum[0] += data[idx + 0] * alpha;\n            sum[1] += data[idx + 1] * alpha;\n            sum[2] += data[idx + 2] * alpha;\n            sum[3] += alpha;\n          }\n        }\n\n        var idx = thumbnail_img.getIndex(xi, yi) << 2;\n\n        var _r = ev2 / sum[3];\n\n        dst_data[idx] = sum[0] * _r;\n        dst_data[idx + 1] = sum[1] * _r;\n        dst_data[idx + 2] = sum[2] * _r;\n        dst_data[idx + 3] = sum[3] * rr255;\n      }\n    }\n\n    thumbnail_img.width = newx;\n    thumbnail_img.height = newy; //\t\tthumbnail_img.width=64;\n    //\t\tthumbnail_img.height=64;\n\n    thumbnail_img.toBlob(blob => {\n      URL.revokeObjectURL(layer_img.src);\n      layer_img.src = URL.createObjectURL(blob);\n    });\n    thumbnail_img.width = 64;\n    thumbnail_img.height = 64;\n  }\n\n  getAbsolutePosition(p) {\n    //レイヤの絶対座標取得\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.set(p, 0, 0);\n    Layer.bubble_func(this, function (layer) {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.add(p, p, layer.position);\n    });\n  }\n\n  select() {\n    //レイヤを選択状態にする\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].select(this);\n  }\n\n  registRefreshThumbnail() {\n    if (stackThumbnail.indexOf(this) >= 0) {\n      return;\n    }\n\n    stackThumbnail.push(this);\n\n    if (stackThumbnail.length === 1) {\n      window.requestAnimationFrame(function (e) {\n        refreshThumbnail();\n      });\n    }\n  }\n\n}\n\n_defineProperty(Layer, \"enableRefreshThumbnail\", true);\n\n;\nLayer.prototype.typename = \"normal_layer\";\nLayer.prototype.type = {\n  IMAGE: 0,\n  COMPOSITE: 1,\n  MODIFIER: 2\n};\n\n//# sourceURL=webpack://hdrpaint/./src/layer.js?");

/***/ }),

/***/ "./src/lib/binder.js":
/*!***************************!*\
  !*** ./src/lib/binder.js ***!
  \***************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Binder; }\n/* harmony export */ });\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _watcher_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./watcher.js */ \"./src/lib/watcher.js\");\n//バインド\n\n\nvar watcher = new _watcher_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"]();\n\nclass Bind {\n  constructor(node, variable) {\n    this.node = node;\n    this.attribute_name = \"\";\n    this.variables = [];\n    this.watches = [];\n  }\n\n  feedBack(value) {\n    if (value === undefined) {\n      var node = this.node;\n\n      if (node.getAttribute(\"type\") === \"checkbox\") {\n        value = node.checked;\n      } else if (node.getAttribute(\"type\") === \"radio\") {\n        value = node.value;\n      } else {\n        value = node.value;\n\n        if (node.hasAttribute(\"number\")) {\n          value = Number(value);\n        }\n      }\n    } //バインド変数にコントロールの値をセットする\n\n\n    var val = this.watches[0].setValue(value);\n  }\n\n  refresh() {\n    //バインドされた変数の値をノード属性にセット\n    var bind = this;\n    var check = false;\n    this.watches.forEach((w, idx) => {\n      if (w.change_flg) {\n        check = true;\n      }\n    });\n\n    if (!check) {\n      return;\n    }\n\n    var node = bind.node;\n    var value = bind.watches[0].getValue(0);\n\n    if (bind.func) {\n      var old = bind.watches.map(w => w.old_value);\n      value = bind.func(old);\n    }\n\n    if (bind.attribute_name !== \"\") {\n      node.setAttribute(bind.attribute_name, value);\n      return;\n    }\n\n    switch (node.tagName) {\n      case \"INPUT\":\n      case \"SELECT\":\n      case \"TEXTAREA\":\n        if (node.getAttribute(\"type\") === \"checkbox\") {\n          node.checked = value;\n        }\n\n        if (node.getAttribute(\"type\") === \"radio\") {\n          node.checked = Boolean(value === node.value);\n        } else {\n          node.value = value;\n        }\n\n        _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].fireEvent(node, \"input\");\n        break;\n\n      default:\n        if (value && (value instanceof HTMLElement || value.nodeName)) {\n          node.innerHTML = \"\";\n          node.appendChild(value);\n        } else {\n          node.textContent = value;\n        }\n\n    }\n  }\n\n}\n\nclass Binder {\n  constructor() {\n    this.binds = [];\n    this.variable_root = window;\n  }\n\n  init(_variable_root) {\n    //初期化&バインド\n    if (_variable_root) {\n      this.variable_root = _variable_root;\n    } //this.binds=[];\n\n\n    var bindedNodes = document.querySelectorAll(\"*\");\n    bindedNodes.forEach(node => {\n      for (var i = 0; i < node.attributes.length; i++) {\n        var attribute_name = node.attributes[i].name;\n        if (attribute_name.indexOf(\"bind:\") !== 0) continue;\n        var variable_name = node.getAttribute(attribute_name);\n        attribute_name = attribute_name.replace(\"bind:\", \"\");\n        var func = null;\n\n        if (node.hasAttribute(\"bindfunc\")) {\n          func = node.getAttribute(\"bindfunc\");\n          func = new Function('arg', func);\n        }\n\n        this.bind(node, attribute_name, null, variable_name, func);\n      }\n\n      ;\n    });\n\n    var func = () => {\n      this.refresh();\n      window.requestAnimationFrame(func);\n    };\n\n    func();\n  }\n\n  bind(node, attribute_name, variable_root, variable_names, func) {\n    var bind = this.binds.find(e => {\n      return e.node == node && e.attribute_name == attribute_name;\n    });\n\n    if (bind) {\n      return bind;\n    } //ノードとバインド変数を渡してバインド情報を登録する\n\n\n    bind = new Bind();\n    bind.node = node;\n    bind.attribute_name = attribute_name;\n\n    if (!variable_root) {\n      variable_root = this.variable_root;\n    }\n\n    if (!Array.isArray(variable_names)) {\n      variable_names = [variable_names];\n    }\n\n    variable_names.forEach(name => {\n      bind.watches.push(watcher.watch(variable_root, name));\n    });\n    bind.func = func;\n    bind.binder = this;\n    this.binds.push(bind);\n\n    if (node.hasAttribute(\"feedback\")) {\n      var f = node.getAttribute(\"feedback\");\n\n      if (f != null && f != \"\") {\n        var func = Function(f);\n        node.addEventListener(\"change\", () => {\n          bind.feedBack();\n          func();\n        });\n      } else {\n        node.addEventListener(\"change\", () => {\n          bind.feedBack();\n        });\n      }\n    }\n\n    return bind;\n  }\n\n  bindNodes(node, variable_root) {\n    var bindedNodes = node.querySelectorAll(\"*\");\n    bindedNodes.forEach(node => {\n      for (var i = 0; i < node.attributes.length; i++) {\n        var attribute_name = node.attributes[i].name;\n        if (attribute_name.indexOf(\"bind:\") !== 0) continue;\n        var variable_name = node.getAttribute(attribute_name);\n        attribute_name = attribute_name.replace(\"bind:\", \"\");\n        this.bind(node, attribute_name, variable_root, variable_name);\n      }\n\n      ;\n    });\n  }\n\n  refresh() {\n    watcher.refresh(); //バインドしたノードに変数の値をセット\n\n    for (var i = 0; i < this.binds.length; i++) {\n      this.binds[i].refresh();\n    }\n  }\n\n}\n\n//# sourceURL=webpack://hdrpaint/./src/lib/binder.js?");

/***/ }),

/***/ "./src/lib/colorpickerhdr.js":
/*!***********************************!*\
  !*** ./src/lib/colorpickerhdr.js ***!
  \***********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ ColorpickerHDR; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _slider_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./slider.js */ \"./src/lib/slider.js\");\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _img_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _colorselector_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./colorselector.js */ \"./src/lib/colorselector.js\");\n/* harmony import */ var _binder_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./binder.js */ \"./src/lib/binder.js\");\n\n\n\n\n\n\nvar binder = new _binder_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"](); //カラーピッカーHDR\n\nvar safe = 0;\nvar rgb = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\nvar parentInput = null; //カラーピッカーが表示されている親コントロール\n\nvar updateTextArea = function (textArea) {\n  //テキストの内容を背景色にセット\n  var sp = textArea.value.split(\",\");\n  rgb[0] = Number(sp[0]);\n  rgb[1] = Number(sp[1]);\n  rgb[2] = Number(sp[2]);\n  rgb[3] = Number(sp[3]); //textArea.style.backgroundColor= \"rgb(\" + rgb[0]*255+\",\"+rgb[1]*255+\",\" + rgb[2]*255 +\")\"\n\n  var rgba = _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].rgba(rgb[0] * 255, rgb[1] * 255, rgb[2] * 255, rgb[3]);\n  textArea.style.backgroundImage = \"linear-gradient( 0,\" + rgba + \",\" + rgba + \"),url(css/back.png)\";\n\n  if (textArea.readOnly) {\n    textArea.style.color = \"rgba(0,0,0,0)\";\n  } else {\n    textArea.style.color = 0.3 * rgb[0] + 0.6 * rgb[1] + 0.1 * rgb[2] < 0.5 ? \"white\" : \"black\";\n  }\n};\n\nvar parentUpdate = () => {\n  parentInput.value = R_txt.value + \", \" + G_txt.value + \", \" + B_txt.value + \", \" + A_txt.value;\n  _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].fireEvent(parentInput, \"change\");\n  updateTextArea(parentInput);\n};\n\nvar colorselector = new _colorselector_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"]();\nvar container = document.createElement(\"div\");\ncontainer.classList.add(\"colorpickerhdr_form\");\ncontainer.appendChild(colorselector.div);\n\ncolorselector.changeCallback = function () {\n  if (!parentInput) {\n    return;\n  }\n\n  parentInput.value = this.R_txt.value + \", \" + this.G_txt.value + \", \" + this.B_txt.value + \", \" + this.A_txt.value;\n  _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].fireEvent(parentInput, \"change\");\n  updateTextArea(parentInput);\n};\n\ndocument.body.appendChild(container);\nclass ColorpickerHDR {\n  constructor() {}\n\n  static init() {\n    //ページ読み込み時に className=\"colorpicker\"のinputタグを対象に\n    //カラーピッカーコントロール対応させる\n    var e = document.getElementsByClassName('colorpickerhdr');\n    container.addEventListener(\"pointerdown\", function (evt) {\n      safe = 1;\n    });\n    window.addEventListener(\"pointerdown\", function (evt) {\n      if (!safe) {\n        container.style.display = \"none\";\n      }\n\n      safe = 0;\n    });\n\n    for (var i = 0; i < e.length; i += 1) {\n      var node = e[i];\n      node.addEventListener(\"click\", function (evt) {\n        //クリック時、カラーピッカーを表示\n        parentInput = this;\n        container.style.display = \"block\";\n        var rect = this.getBoundingClientRect();\n        container.style.left = rect.left + window.pageXOffset + \"px\";\n        container.style.top = rect.top + rect.height + window.pageYOffset + \"px\";\n        var cols = evt.currentTarget.value.split(\",\");\n        colorselector.setColor(cols); //\t\t\t\tsafe=1;\n      });\n      node.addEventListener(\"input\", function (evt) {\n        //内容変更時、背景色とカーソルをリフレッシュする\n        updateTextArea(this);\n      });\n      updateTextArea(node); //\t\t\tbinder.bind(node,\"\",window,[],func){\n    }\n  }\n\n}\n;\nwindow.addEventListener(\"load\", ColorpickerHDR.init, false);\n\n//# sourceURL=webpack://hdrpaint/./src/lib/colorpickerhdr.js?");

/***/ }),

/***/ "./src/lib/colorselector.js":
/*!**********************************!*\
  !*** ./src/lib/colorselector.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ ColorSelector; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _slider_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./slider.js */ \"./src/lib/slider.js\");\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _img_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./img.js */ \"./src/lib/img.js\");\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\n //カラーセレクタHDR\n\nvar img = new _img_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"](128, 128, _img_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].FORMAT_UINT8);\nlet col = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\nlet col_org = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //色相画像作成\n\nvar img_h = {};\nvar data = img.data;\nvar idx = 0;\n\nfor (var yi = 0; yi < 128; yi++) {\n  col[0] = yi / 128;\n  col[1] = 1;\n  col[2] = 1;\n  _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].hsv2rgb(col, col);\n  col[0] = col[0] * 255 | 0;\n  col[1] = col[1] * 255 | 0;\n  col[2] = col[2] * 255 | 0;\n  idx = img.getIndex(0, yi) << 2;\n  data[idx] = col[0];\n  data[idx + 1] = col[1];\n  data[idx + 2] = col[2];\n  data[idx + 3] = 255;\n}\n\nvar h_img_dataurl = null;\nimg.toBlob(blob => {\n  //\tURL.revokeObjectURL(h_img_dataurl);\n  h_img_dataurl = URL.createObjectURL(blob);\n  var nodes = document.querySelectorAll(\".cphdr_h_img\");\n\n  for (var i = 0; i < nodes.length; i++) {\n    nodes[i].src = h_img_dataurl;\n  }\n}, \"image/png\", 1.0, 0, 0, 1, 128);\nclass ColorSelector {\n  constructor() {\n    _defineProperty(this, \"down\", e => {\n      if (!(e.buttons & 1)) {\n        this.drag_from = 0;\n      }\n\n      var hsv = this.hsv;\n      var rgb = this.rgb;\n\n      switch (this.drag_from) {\n        case 1:\n          var rect = this.sv_img.getBoundingClientRect();\n          hsv[2] = e.clientX - rect.left;\n          hsv[1] = e.clientY - rect.top;\n          hsv[2] /= img.width;\n          hsv[1] /= img.height;\n          hsv[1] = 1 - hsv[1];\n          hsv[1] = Math.min(Math.max(hsv[1], 0), 1);\n          hsv[2] = Math.min(Math.max(hsv[2], 0), 1);\n          break;\n\n        case 2:\n          var rect = this.h_img.getBoundingClientRect();\n          hsv[0] = e.clientY - rect.top;\n          hsv[0] = hsv[0] / this.h_img.height;\n          hsv[0] = Math.min(Math.max(hsv[0], 0), 1);\n          this.redrawSv();\n          break;\n\n        default:\n          return;\n      }\n\n      this.setCursor(hsv);\n      var vi = Math.pow(2, Number(this.Vi_txt.value));\n      _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].hsv2rgb(rgb, hsv);\n      this.R_txt.value = (rgb[0] * vi).toFixed(3);\n      this.G_txt.value = (rgb[1] * vi).toFixed(3);\n      this.B_txt.value = (rgb[2] * vi).toFixed(3);\n\n      if (this.changeCallback) {\n        this.changeCallback();\n      }\n    });\n\n    this.div = null;\n    this.sv_img = null;\n    this.h_img = null;\n    this.h_cursor = null;\n    this.s_cursor = null;\n    this.v_cursor = null;\n    this.R_txt = null;\n    this.G_txt = null;\n    this.B_txt = null;\n    this.A_txt = null;\n    this.Vi_txt = null;\n    this.changeCallback = null;\n    this.drag_from = 0;\n    this.rgb = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.hsv = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.parentInput = null; //カラーピッカーが表示されている親コントロール\n\n    this.hsv = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    var html = `\n\t\t\t\t<div class=\"div_main\">\n\t\t\t\t\t<div class=\"sv_parent\">\n\t\t\t\t\t\t<img class=\"cphdr_sv_img\" draggable=\"false\">\n\t\t\t\t\t\t<div class=\"cphdr_s_cursor cursor\"></div>\n\t\t\t\t\t\t<div class=\"cphdr_v_cursor cursor\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"sv_parent\">\n\t\t\t\t\t\t<img class=\"cphdr_h_img\" draggable=\"false\">\n\t\t\t\t\t\t<div class=\"cphdr_h_cursor cursor\" ></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"color_status\">\n\t\t\t\t\t<ul>\n\t\t\t\t\t<li class=\"red\">R<input type=\"text\" class=\"cphdr_R_txt\" value=\"0.8\" /></li>\n\t\t\t\t\t<li class=\"green\">G<input type=\"text\" class=\"cphdr_G_txt\" value=\"0.2\"/></li>\n\t\t\t\t\t<li class=\"blue\">B<input type=\"text\" class=\"cphdr_B_txt\" value=\"0.2\"/></li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t明るさ<input class=\"slider cphdr_Vi_txt\" min=\"-10\" max=\"10\" value=\"0\" step=\"0.01\"/>\n\t\t\t\t</div>\n\t\t\t\tA<input class=\"slider cphdr_A_txt\" max=\"1\" value=\"1\" step=\"0.001\"/>\n\t\t`;\n    this.div = document.createElement(\"div\");\n    this.div.classList.add(\"colorselector\");\n    this.div.insertAdjacentHTML('beforeend', html);\n    this.sv_img = this.div.querySelector(\".cphdr_sv_img\");\n    this.h_img = this.div.querySelector(\".cphdr_h_img\");\n    this.h_cursor = this.div.querySelector(\".cphdr_h_cursor\");\n    this.s_cursor = this.div.querySelector(\".cphdr_s_cursor\");\n    this.v_cursor = this.div.querySelector(\".cphdr_v_cursor\");\n    this.R_txt = this.div.querySelector(\".cphdr_R_txt\");\n    this.G_txt = this.div.querySelector(\".cphdr_G_txt\");\n    this.B_txt = this.div.querySelector(\".cphdr_B_txt\");\n    this.Vi_txt = this.div.querySelector(\".cphdr_Vi_txt\");\n    this.A_txt = this.div.querySelector(\".cphdr_A_txt\");\n    _slider_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].init(this.div);\n    this.redrawSv(0);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(col, 1, 1, 1);\n    this.setRGB(col);\n    this.div.querySelector(\".color_status\").addEventListener(\"change\", () => {\n      this.changeColor();\n\n      if (this.changeCallback) {\n        this.changeCallback();\n      }\n    });\n    this.A_txt.addEventListener(\"change\", () => {\n      this.changeColor();\n\n      if (this.changeCallback) {\n        this.changeCallback();\n      }\n    });\n    this.Vi_txt.addEventListener(\"change\", () => {\n      var vi = Math.pow(2, Number(this.Vi_txt.value));\n      _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].hsv2rgb(col, this.hsv);\n      this.R_txt.value = (col[0] * vi).toFixed(3);\n      this.G_txt.value = (col[1] * vi).toFixed(3);\n      this.B_txt.value = (col[2] * vi).toFixed(3);\n\n      if (this.changeCallback) {\n        this.changeCallback();\n      }\n    });\n    this.sv_img.parentNode.addEventListener(\"pointerdown\", e => {\n      this.drag_from = 1;\n      this.down(e);\n    });\n    this.h_img.parentNode.addEventListener(\"pointerdown\", e => {\n      this.drag_from = 2;\n      this.down(e);\n    });\n    window.addEventListener(\"pointermove\", this.down);\n  }\n\n  redrawSv() {\n    var idx = 0;\n    col[0] = this.hsv[0];\n    col[1] = 1;\n    col[2] = 1;\n    _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].hsv2rgb(col_org, col);\n    var data = img.data;\n    var alpha = Number(this.A_txt.value) * 255;\n\n    for (var yi = 0; yi < img.height; yi++) {\n      var yf = yi / img.height;\n      col[0] = (1 - col_org[0]) * yf + col_org[0];\n      col[1] = (1 - col_org[1]) * yf + col_org[1];\n      col[2] = (1 - col_org[2]) * yf + col_org[2];\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(col, col, 255 / img.width);\n\n      for (var xi = 0; xi < img.width; xi++) {\n        data[idx] = col[0] * xi;\n        data[idx + 1] = col[1] * xi;\n        data[idx + 2] = col[2] * xi;\n        data[idx + 3] = alpha;\n        idx += 4;\n      }\n    }\n\n    img.toBlob(blob => {\n      URL.revokeObjectURL(this.sv_img.src);\n      this.sv_img.src = URL.createObjectURL(blob);\n    }, \"image/png\");\n  }\n\n  setColor(c) {\n    this.R_txt.value = c[0];\n    this.G_txt.value = c[1];\n    this.B_txt.value = c[2];\n    this.A_txt.value = c[3];\n    this.changeColor();\n  }\n\n  changeColor() {\n    var rgb = this.rgb;\n    var hsv = this.hsv;\n    rgb[0] = Number(this.R_txt.value);\n    rgb[1] = Number(this.G_txt.value);\n    rgb[2] = Number(this.B_txt.value);\n    var max = Math.max(Math.max(rgb[0], Math.max(rgb[1], rgb[2])), 1);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(col, rgb, 1 / max);\n    _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].rgb2hsv(hsv, col);\n    this.redrawSv();\n    this.setCursor(hsv);\n    this.Vi_txt.value = Math.log2(max);\n  }\n\n  setRGB(col) {\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(this.rgb, col);\n    _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].rgb2hsv(this.hsv, this.rgb);\n    this.setCursor(this.hsv);\n  }\n\n  setCursor(hsv) {\n    this.h_cursor.style.top = hsv[0] * 127 - 1 + \"px\";\n    this.s_cursor.style.top = (1 - hsv[1]) * 127 - 1 + \"px\";\n    this.v_cursor.style.left = hsv[2] * 127 - 1 + \"px\";\n  }\n\n}\n; //window.addEventListener(\"load\",colorselector.init,false);\n\n//# sourceURL=webpack://hdrpaint/./src/lib/colorselector.js?");

/***/ }),

/***/ "./src/lib/datastream.js":
/*!*******************************!*\
  !*** ./src/lib/datastream.js ***!
  \*******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ DataStream; }\n/* harmony export */ });\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"./src/lib/util.js\");\n\nclass DataStream {\n  constructor(arraybuffer, offset, length) {\n    if (typeof arraybuffer === \"number\") {\n      this.byteBuffer = new Uint8Array(arraybuffer);\n    } else {\n      if (length) {\n        this.byteBuffer = new Uint8Array(arraybuffer, offset, length);\n      } else {\n        this.byteBuffer = new Uint8Array(arraybuffer);\n      }\n    }\n\n    this.dv = new DataView(this.byteBuffer.buffer, this.byteBuffer.byteOffset, this.byteBuffer.byteLength);\n    this.idx = 0;\n  }\n\n  getByteIndex() {\n    return this.idx >>> 3;\n  }\n\n  fill(value, n) {\n    //nバイト書き込む\n    for (var i = 0; i < n; i++) {\n      this.setUint8(value);\n    }\n\n    return;\n  }\n\n  setInt32(value, le) {\n    this.dv.setInt32(this.idx >> 3, value, le);\n    this.idx += 32;\n    return;\n  }\n\n  getInt32(le) {\n    var ret = this.dv.getInt32(this.idx >> 3, le);\n    this.idx += 32;\n    return ret;\n  }\n\n  setUint8(value) {\n    this.dv.setUint8(this.idx >> 3, value);\n    this.idx += 8;\n  }\n\n  getUint8(le) {\n    var ret = this.dv.getUint8(this.idx >> 3, le);\n    this.idx += 8;\n    return ret;\n  }\n\n  setUint32(value, le) {\n    this.dv.setUint32(this.idx >> 3, value, le);\n    this.idx += 32;\n    return;\n  }\n\n  getUint32(le) {\n    var ret = this.dv.getUint32(this.idx >> 3, le);\n    this.idx += 32;\n    return ret;\n  }\n\n  setUint16(value, le) {\n    this.dv.setUint16(this.idx >> 3, value, le);\n    this.idx += 16;\n    return;\n  }\n\n  getUint16(le) {\n    var ret = this.dv.getUint16(this.idx >> 3, le);\n    this.idx += 16;\n    return ret;\n  }\n\n  setUint64(value, le) {\n    var h = value / (65536 * 65536) | 0;\n    var l = value & 0xffffffff;\n\n    if (le) {\n      this.setUint32(l, le);\n      this.setUint32(h, le);\n    } else {\n      this.setUint32(h, le);\n      this.setUint32(l, le);\n    }\n  }\n\n  getUint64(le) {\n    var ret = this.getUint32(le);\n    var ret2 = this.getUint32(le);\n\n    if (le) {\n      return (ret2 << 32) + ret;\n    } else {\n      return (ret << 32) + ret2;\n    }\n  }\n\n  setFloat32(value, le) {\n    this.dv.setFloat32(this.idx >> 3, value, le);\n    this.idx += 32;\n  }\n\n  getFloat32(le) {\n    var ret = this.dv.getFloat32(this.idx >> 3, le);\n    this.idx += 32;\n    return ret;\n  }\n\n  setBytes(bytes) {\n    for (var si = 0; si < bytes.length; si++) {\n      this.setUint8(bytes[si]);\n    }\n\n    return;\n  }\n\n  getBytes(length) {\n    var array = new Uint8Array(length);\n\n    for (var si = 0; si < length; si++) {\n      array[si] = this.getUint8();\n    }\n\n    return array;\n  }\n\n  setTextBuf(str, flg) {\n    var utf8array = _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].stringToUtf8(str);\n    var dv = this.dv;\n\n    for (var si = 0; si < utf8array.length; si++) {\n      this.setUint8(utf8array[si]);\n    }\n\n    if (flg) {\n      this.setUint8(0);\n    }\n\n    return;\n  }\n\n  readTextBuf() {\n    var dv = this.dv;\n    var array = [];\n    var a;\n\n    while ((a = dv.getUint8(this.idx >> 3)) !== 0) {\n      array.push(a);\n      this.idx += 1 << 3;\n    }\n\n    this.idx += 1 << 3;\n    return _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].utf8ToString(array);\n  }\n\n  setFloat16(value, le) {\n    var dv = this.dv;\n    var s = -Math.sign(value) + 1 >> 1;\n    var val = Math.abs(value);\n    var e = Math.floor(Math.log2(val));\n    val = val / Math.pow(2, e) - 1;\n    var u = s << 15 | e + 15 << 10 | val * 1024 & 1023;\n    this.setUint16(u, le); //\t\tthis.idx-=16;\n    //\t\tvar val2= this.readFloat16(le);\n  }\n\n  readFloat16(le) {\n    var dv = this.dv;\n    var data = this.getUint16(le);\n    if (data === 0) return 0.0;\n    var sign = data >> 15 & 1;\n    sign = 1 - sign * 2;\n    var idx = (data >> 10 & 31) - 15;\n    var b = (data & 1023) * 1.0 / 1024.0 + 1.0;\n    return sign * b * Math.pow(2.0, idx);\n  }\n\n  outputBit(bit) {\n    //1ビットouput_bufferに書き込む\n    //書き込んだあとindexを1ビットすすめる\n    this.byteBuffer[this.idx >> 3] &= ~(1 << (this.idx & 7));\n    this.byteBuffer[this.idx >> 3] |= bit << (this.idx & 7);\n    this.idx++;\n  }\n\n  outputBits(bits, len) {\n    //ビット列をoutput_bufferに書き込む\n    for (var i = 0; i < len; i++) {\n      this.outputBit(bits >> i & 1);\n    }\n  }\n\n  outputBitsReverse(bits, len) {\n    //ビット列を逆順(上位ビットから順番)にoutput_bufferに書き込む\n    //ハフマン符号格納用\n    for (var i = len - 1; i >= 0; i--) {\n      this.outputBit(bits >> i & 1);\n    }\n  }\n\n  readBit() {\n    //bufferからoutput_indexの位置のビットを読み込み\n    //読み込んだあとoutput_indexを1つすすめる\n    var bit = this.byteBuffer[this.idx >> 3] >> (this.idx & 7) & 1;\n    this.idx++;\n    return bit;\n  }\n\n  readBits(len) {\n    //output_bufferからlen分読み込み\n    var bits = 0;\n\n    for (var i = 0; i < len; i++) {\n      bits = bits | this.readBit() << i;\n    }\n\n    return bits;\n  }\n\n  readBitsReverse(len) {\n    //output_bufferからlen分読み込み\n    //読み込んだビットは高次ビットから格納される\n    //ハフマン符号読み込み用\n    var bits = 0;\n\n    for (var i = 0; i < len; i++) {\n      bits = bits << 1 | this.readBit();\n    }\n\n    return bits;\n  }\n\n}\n\n//# sourceURL=webpack://hdrpaint/./src/lib/datastream.js?");

/***/ }),

/***/ "./src/lib/deflate.js":
/*!****************************!*\
  !*** ./src/lib/deflate.js ***!
  \****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Deflate; }\n/* harmony export */ });\n/* harmony import */ var _datastream_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./datastream.js */ \"./src/lib/datastream.js\");\n\nvar clen_huffmans = []; //データ長データ用ハフマン符号情報\n\nvar lit_huffmans = []; //リテラル/長さ用ハフマン符号情報\n\nvar dist_huffmans = []; //距離用ハフマン符号情報\n\nconst MAX_BITS = 15; //ハフマン符号に使う最大ビット長\n\nclass Deflate {\n  constructor() {}\n\n  static compress(arrayBuffer, comp_mode, block) {\n    //deflate圧縮を行う\n    var result; //ブロックを作成\n\n    if (!block) {\n      result = encBlock(arrayBuffer, 0, arrayBuffer.length, 1, comp_mode);\n    } else {\n      result = [];\n      var idx = 0;\n\n      while (idx < arrayBuffer.length) {\n        var size = Math.min(block, arrayBuffer.length - idx);\n\n        if (idx + size >= arrayBuffer.length) {\n          final = 1;\n        } else {\n          final = 0;\n        }\n\n        a = encBlock(arrayBuffer, idx, size, final, comp_mode);\n        result = result.concat(a);\n        idx += size;\n      }\n    }\n\n    return result;\n  }\n\n  static expand(compress_array_buffer, offset, length) {\n    //Deflate圧縮された情報を伸長する\n    var ds = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](compress_array_buffer, offset, length);\n    var decdata = [];\n    var bfinal = 0; //最終ブロックを伸長した後はループを抜ける\n\n    while (!bfinal) {\n      bfinal = ds.readBit();\n      var compless_type = ds.readBits(2);\n\n      if (compless_type === 0) {\n        //無圧縮\n        if (ds.idx & 7) {\n          ds.idx = (ds.idx & ~7) + 8;\n        } else {\n          ds.idx = ds.idx & ~7;\n        }\n\n        var len = ds.readBits(16);\n        ds.readBits(16);\n\n        for (var i = 0; i < len; i++) {\n          decdata.push(ds.readBits(8));\n        } //ds.idx+=len*8;\n\n      } else if (compless_type === 1 || compless_type === 2) {\n        var lenlist = [];\n\n        if (compless_type === 1) {\n          //固定ハフマン\n          for (var i = 0; i <= 143; i++) {\n            lenlist[i] = 8;\n          }\n\n          for (var i = 144; i <= 255; i++) {\n            lenlist[i] = 9;\n          }\n\n          for (var i = 256; i <= 279; i++) {\n            lenlist[i] = 7;\n          }\n\n          for (var i = 280; i <= 287; i++) {\n            lenlist[i] = 8;\n          }\n\n          lit_huffmans = createHuffmans(lenlist);\n          lenlist = [];\n\n          for (var i = 0; i <= 31; i++) {\n            lenlist[i] = 5;\n          }\n\n          dist_huffmans = createHuffmans(lenlist);\n        } else {\n          //ダイナミックハフマン\n          var hlit = ds.readBits(5);\n          var hdist = ds.readBits(5);\n          var hclen = ds.readBits(4); //コード長コード復号\n\n          var idx = [16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15];\n\n          for (var i = 0; i < idx.length; i++) {\n            if (i < hclen + 4) {\n              lenlist[idx[i]] = ds.readBits(3);\n            } else {\n              lenlist[idx[i]] = 0;\n            }\n          }\n\n          var clen_huffmans = createHuffmans(lenlist); //長さビット長リスト復元\n          //距離ビット長リスト復元\n\n          var lenlist2 = decodeClen(ds, hlit + hdist + 258, clen_huffmans);\n          lenlist = lenlist2.slice(0, hlit + 257);\n          lit_huffmans = createHuffmans(lenlist);\n          lenlist = lenlist2.slice(hlit + 257);\n          dist_huffmans = createHuffmans(lenlist);\n        }\n\n        while (1) {\n          var value = readHuffman(ds, lit_huffmans);\n\n          if (value < 256) {\n            //リテラル\n            decdata.push(value);\n          } else {\n            if (value == 256) {\n              //終了符号\n              break;\n            } //長さ\n\n\n            if (value === 285) {\n              value = 255;\n            } else {\n              var extra_bits = value - 261;\n\n              if (extra_bits >= 0) {\n                extra_bits = extra_bits >> 2;\n                value = value - 257;\n                var offset = 4 + extra_bits * 4;\n                var extra_data = ds.readBits(extra_bits);\n                value = (value - offset << extra_bits) + (4 << extra_bits) + extra_data;\n              } else {\n                value = value - 257;\n              }\n            } //len=value+3;\n\n\n            decdata.push(-(value + 3)); //-len\n            //距離\n\n            value = readHuffman(ds, dist_huffmans);\n            extra_bits = value - 2;\n\n            if (extra_bits >= 0) {\n              extra_bits = extra_bits >> 1;\n              var offset = 2 + extra_bits * 2;\n              var extra_data = ds.readBits(extra_bits);\n              value = (value - offset << extra_bits) + (2 << extra_bits) + extra_data;\n            } //dist=value+1;\n\n\n            decdata.push(value + 1); //dist\n          }\n        }\n\n        decdata = expandLZ77(decdata);\n      }\n    }\n\n    return decdata;\n  }\n\n}\n\nvar encBlock = function (src, offset, size, final, comp_type) {\n  //1ブロック分出力する\n  //出力用ストリーム\n  var ds = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](new ArrayBuffer(size * 2)); //元サイズの2倍くらいあれば多分大丈夫\n  //BFINAL\n\n  ds.outputBit(final); //complession type\n\n  ds.outputBits(comp_type, 2);\n\n  if (comp_type === 0) {\n    //無圧縮モード\n    //バイト頭まで移動\n    if (ds.idx & 7) {\n      ds.idx = (ds.idx & ~7) + 8;\n    } else {\n      ds.idx = dx.idx & ~7;\n    }\n\n    var len = size;\n    ds.outputBits(len, 16);\n    ds.outputBits(~len, 16);\n\n    for (var i = 0; i < src.length; i++) {\n      ds.outputBits(src[i + offset], 8);\n    }\n  } else {\n    var lit_list = []; //リテラル/長さ用のハフマン符号を作るための符号長リスト\n\n    var dist_list = []; //距離用のハフマン符号を作るための符号長リスト\n\n    var clen_list = []; //符号長用のハフマン符号リストを作成\n    //LZ77圧縮を行う\n\n    var lz77 = compressLZ77(src, offset, size);\n\n    if (comp_type === 1) {\n      //固定ハフマン符号圧縮\n      //リテラル/長さ用のハフマン符号を作るための符号長リスト\n      for (var i = 0; i <= 143; i++) {\n        lit_list[i] = 8;\n      }\n\n      for (var i = 144; i <= 255; i++) {\n        lit_list[i] = 9;\n      }\n\n      for (var i = 256; i <= 279; i++) {\n        lit_list[i] = 7;\n      }\n\n      for (var i = 280; i <= 287; i++) {\n        lit_list[i] = 8;\n      } //距離用のハフマン符号を作るための符号長リスト\n\n\n      for (var i = 0; i <= 31; i++) {\n        dist_list[i] = 5;\n      }\n    } else if (comp_type === 2) {\n      //カスタムハフマン符号圧縮\n      //符号長用のハフマン符号を作るための符号長リスト\n      for (var i = 0; i < 19; i++) {\n        clen_list.push(5);\n      } //符号長用のハフマン符号リストを作成\n\n\n      clen_huffmans = createHuffmans(clen_list); //リテラル/長さ用のハフマン符号を作るための符号長リスト\n\n      for (var i = 0; i <= 143; i++) {\n        lit_list[i] = 9;\n      }\n\n      for (var i = 144; i <= 255; i++) {\n        lit_list[i] = 8;\n      }\n\n      for (var i = 256; i <= 279; i++) {\n        lit_list[i] = 8;\n      }\n\n      for (var i = 280; i <= 287; i++) {\n        lit_list[i] = 7;\n      } //距離用のハフマン符号を作るための符号長リスト\n      //for(var i=0;i<=10;i++){ dist_list[i]=4;}\n      //for(var i=11;i<=20;i++){ dist_list[i]=5;}\n      //for(var i=21;i<=31;i++){ dist_list[i]=6;}\n\n\n      for (var i = 0; i <= 31; i++) {\n        dist_list[i] = 5;\n      } //リテラル/長さ用符号長リスト要素数を出力\n\n\n      ds.outputBits(lit_list.length - 257, 5); //距離用符号長リスト要素数を出力\n\n      ds.outputBits(dist_list.length - 1, 5); //符号長ハフマン符号用符号長リスト要素数を出力\n\n      ds.outputBits(clen_list.length - 4, 4); //符号長リストから符号長用ハフマン符号を作成\n\n      for (var i = 0; i < clen_list.length; i++) {\n        ds.outputBits(clen_list[i], 3);\n      } //符号長用ハフマン符号を用いてリテラル/長さ符号長リストを出力\n\n\n      var enc = encodeClen(lit_list, clen_huffmans);\n      outputClen(ds, enc, clen_huffmans); //符号長用ハフマン符号を用いて距離符号長リストを出力\n\n      enc = encodeClen(dist_list, clen_huffmans);\n      outputClen(ds, enc, clen_huffmans);\n    } //符号長リストからリテラル/長さハフマン符号を作成\n\n\n    lit_huffmans = createHuffmans(lit_list); //符号長リストから距離ハフマン符号を作成\n\n    dist_huffmans = createHuffmans(dist_list); //LZ77で圧縮されたデータをハフマン符号化し出力\n\n    for (var i = 0; i < lz77.length; i++) {\n      //if(!isNaN(src[i])){\n      if (lz77[i] >= 0) {\n        //リテラルの場合、リテラル/長さ用ハフマン符号を使って出力\n        outputHuffman(ds, lz77[i], lit_huffmans);\n      } else {\n        //繰り返し情報の場合、長さ、距離を符号+拡張情報の形に変えた後\n        //それぞれのハフマン符号を使って出力\n        //長さを符号+拡張情報化\n        var len = -lz77[i];\n        i++;\n        var dist = lz77[i];\n        var extra_bits = 0;\n        var extra_data = 0;\n        var code = 285;\n\n        if (len < 258) {\n          extra_bits = (Math.log2(Math.max(len - 3, 4)) | 0) - 2;\n          code = extra_bits * 4 + (len - 3 >> extra_bits) + 257;\n          extra_data = len - 3 & (1 << extra_bits) - 1;\n        } //長さ符号をハフマン符号を使って出力\n\n\n        outputHuffman(ds, code, lit_huffmans); //拡張情報はそのまま出力\n\n        ds.outputBits(extra_data, extra_bits); //距離を符号+拡張情報化\n\n        extra_bits = (Math.log2(Math.max(dist - 1, 2)) | 0) - 1;\n        code = extra_bits * 2 + (dist - 1 >> extra_bits);\n        var extra_data = dist - 1 & (1 << extra_bits) - 1; //距離符号をハフマン符号を使って出力\n\n        outputHuffman(ds, code, dist_huffmans); ///拡張情報はそのまま出力\n\n        ds.outputBits(extra_data, extra_bits);\n      }\n    } //ブロック終了符号(256)をリテラル/長さハフマン符号を使って出力\n\n\n    outputHuffman(ds, 256, lit_huffmans);\n  } //サイズぴったしに切り抜く\n  //\t\tvar result = new Uint8Array(Math.ceil(ds.idx/8));\n  //\t\tfor(var i=0;i<result.length;i++){\n  //\t\t\tresult[i]=ds.byteBuffer[i];\n  //\t\t}\n  //\t\treturn result;\n\n\n  return Array.from(ds.byteBuffer).slice(0, Math.ceil(ds.idx / 8));\n};\n\nvar createHuffmans = function (lenlist) {\n  //ビット長リストからハフマン符号情報を作成する\n  var enc_huffmans = [];\n  var max_bits = 0;\n\n  for (var i = 0; i < lenlist.length; i++) {\n    var t = {};\n    t.Len = lenlist[i];\n    t.Code = 0;\n    enc_huffmans.push(t);\n\n    if (max_bits < lenlist[i]) {\n      max_bits = lenlist[i];\n    }\n  }\n\n  var bl_count = new Array(max_bits + 1);\n\n  for (var i = 0; i < bl_count.length; i++) {\n    bl_count[i] = 0;\n  }\n\n  for (var i = 0; i < enc_huffmans.length; i++) {\n    bl_count[enc_huffmans[i].Len]++;\n  }\n\n  var code = 0;\n  var next_code = new Array(max_bits + 1);\n  bl_count[0] = 0;\n\n  for (var bits = 1; bits < next_code.length; bits++) {\n    code = code + bl_count[bits - 1] << 1;\n    next_code[bits] = code;\n  }\n\n  for (var n = 0; n < enc_huffmans.length; n++) {\n    var len = enc_huffmans[n].Len;\n\n    if (len != 0) {\n      enc_huffmans[n].Code = next_code[len];\n      next_code[len]++;\n    }\n  }\n\n  var dec_huffmans = {};\n\n  for (var i = 0; i < enc_huffmans.length; i++) {\n    if (enc_huffmans[i].Len) {\n      dec_huffmans[enc_huffmans[i].Code] = i;\n    }\n  }\n\n  var huffmans = {};\n  huffmans.enc_huffmans = enc_huffmans;\n  huffmans.dec_huffmans = dec_huffmans;\n  return huffmans;\n};\n\nvar readHuffman = function (dv, tree) {\n  //ハフマン符号のどれかに一致するまで\n  //output_bufferから1バイトずつ読みこみ\n  //一致したハフマン符号をデコードした値を返す\n  var dec_huffmans = tree.dec_huffmans;\n  var enc_huffmans = tree.enc_huffmans;\n\n  for (var i = 1; i <= MAX_BITS; i++) {\n    var value = dv.readBitsReverse(i);\n    var deccode = dec_huffmans[value];\n\n    if (deccode != null) {\n      if (enc_huffmans[deccode].Len === i) {\n        return deccode;\n      }\n    }\n\n    dv.idx -= i; //バッファのインデックスを戻す\n  }\n\n  return null;\n};\n\nvar encodeClen = function (lenlist) {\n  //符号長リストを0~18の符号列に変換する\n  var clen = [];\n\n  for (var i = 0; i < lenlist.length; i++) {\n    var target = lenlist[i];\n    var count = 1;\n\n    for (; count + i < lenlist.length && target === lenlist[i + count]; count++) {}\n\n    i += count - 1;\n\n    if (target === 0) {\n      while (count) {\n        if (count < 3) {\n          clen.push(0);\n          count -= 1;\n        } else if (count < 11) {\n          clen.push(17);\n          clen.push(count - 3);\n          count = 0;\n        } else if (count < 139) {\n          clen.push(18);\n          clen.push(count - 11);\n          count = 0;\n        } else {\n          clen.push(18);\n          clen.push(127);\n          count -= 138;\n        }\n      }\n    } else {\n      clen.push(target);\n      count -= 1;\n\n      while (count) {\n        if (count < 3) {\n          clen.push(target);\n          count -= 1;\n        } else if (count < 7) {\n          clen.push(16);\n          clen.push(count - 3);\n          count = 0;\n        } else {\n          clen.push(16);\n          clen.push(3);\n          count -= 6;\n        }\n      }\n    }\n  }\n\n  return clen;\n};\n\nvar decodeClen = function (ds, size, clen_huffmans) {\n  //ハフマン符号化された0~18の符号列から\n  //符号長リストを復元する\n  var lenlist = [];\n\n  while (1) {\n    if (lenlist.length >= size) {\n      break;\n    }\n\n    var value = readHuffman(ds, clen_huffmans);\n\n    if (value <= 15) {\n      lenlist.push(value);\n    } else if (value === 16) {\n      //直前値3~6コピー\n      var extra = ds.readBits(2);\n      var org = lenlist[lenlist.length - 1];\n\n      for (var j = 0; j < extra + 3; j++) {\n        lenlist.push(org);\n      }\n    } else if (value === 17) {\n      //3~10ゼロ埋め\n      var extra = ds.readBits(3);\n\n      for (var j = 0; j < extra + 3; j++) {\n        lenlist.push(0);\n      }\n    } else if (value === 18) {\n      //11~138ゼロ埋め\n      var extra = ds.readBits(7);\n\n      for (var j = 0; j < extra + 11; j++) {\n        lenlist.push(0);\n      }\n    }\n  }\n\n  return lenlist;\n};\n\nvar outputHuffman = function (ds, value, tree) {\n  //値をハフマン符号化しoutput_bufferに書き込む\n  var t = tree.enc_huffmans[value];\n  ds.outputBitsReverse(t.Code, t.Len);\n};\n\nvar outputClen = function (ds, src, tree) {\n  //コード長をハフマン符号化しoutput_bufferに書き込む\n  for (var i = 0; i < src.length; i++) {\n    var value = src[i];\n\n    if (value <= 15) {\n      outputHuffman(ds, value, tree);\n    } else if (value === 16) {\n      outputHuffman(ds, value, tree);\n      i++;\n      ds.outputBits(src[i], 2);\n    } else if (value === 17) {\n      outputHuffman(ds, value, tree);\n      i++;\n      ds.outputBits(src[i], 3);\n    } else if (value === 18) {\n      outputHuffman(ds, value, tree);\n      i++;\n      ds.outputBits(src[i], 7);\n    }\n  }\n};\n\nclass Queue {\n  constructor() {\n    this.front = [];\n    this.behind = [];\n  }\n\n  push(value) {\n    this.front.push(value);\n  }\n\n  shift() {\n    if (this.behind.length === 0) {\n      var buf = this.behind;\n      this.behind = this.front;\n      this.front = buf;\n      this.behind.reverse();\n    }\n\n    return this.behind.pop();\n  }\n\n  each(f) {\n    for (var i = this.behind.length; i--;) {\n      if (f(this.behind[i])) {\n        return;\n      }\n    }\n\n    for (var i = 0; i < this.front.length; i++) {\n      if (f(this.front[i])) {\n        return;\n      }\n    }\n  }\n\n  each_inv1(f) {\n    var i = this.front.length;\n    if (i > 0) i--;\n\n    for (; i--;) {\n      if (f(this.front[i])) {\n        return;\n      }\n    }\n\n    i = 0;\n\n    if (this.front.length === 0) {\n      i = 1;\n    }\n\n    for (; i < this.behind.length; i++) {\n      if (f(this.behind[i])) {\n        return;\n      }\n    }\n  }\n\n  each_inv(f) {\n    var flg = false;\n\n    for (var i = this.front.length; i--;) {\n      if (f(this.front[i])) {\n        return;\n      }\n    }\n\n    for (var i = 0; i < this.behind.length; i++) {\n      if (f(this.behind[i])) {\n        return;\n      }\n    }\n  }\n\n}\n\nvar setmap = function (maps, u8a, i) {\n  var key = (u8a[i] << 16) + (u8a[i + 1] << 8) + u8a[i + 2];\n\n  if (!(key in maps)) {\n    maps[key] = new Queue();\n  }\n\n  maps[key].push(i);\n};\n\nvar removemap = function (maps, u8a, i) {\n  maps[(u8a[i] << 16) + (u8a[i + 1] << 8) + u8a[i + 2]].shift();\n};\n\nvar compressLZ77 = function (u8a, offset, size) {\n  //LZ77で圧縮する\n  var result = new Array(size);\n  var idx = 0;\n  var maps = {};\n  var imax = offset + size - 2;\n  var dataview = new DataView(u8a.buffer);\n  var i = Math.max(0, offset - 32768);\n\n  for (; i < offset; i++) {\n    setmap(maps, u8a, i);\n  }\n\n  var imax = size - 2;\n\n  for (var i = 0; i < imax; i++) {\n    //先頭から走査\n    var offseti = offset + i;\n    var dist = 0;\n    var len_max = 2;\n    var kmax = Math.min(size - i, 258) + offseti;\n    var kmax2 = kmax - 4;\n    var key = (u8a[offseti] << 16) + (u8a[offseti + 1] << 8) + u8a[offseti + 2];\n    var map = maps[key];\n    if (map) map.each_inv(function (f) {\n      var j = offseti - f;\n      var k = offseti;\n\n      for (; k < kmax2; k += 4) {\n        if (dataview.getUint32(k) !== dataview.getUint32(k - j)) {\n          break;\n        }\n      }\n\n      for (; k < kmax; k++) {\n        if (dataview.getUint8(k) !== dataview.getUint8(k - j)) {\n          break;\n        }\n      }\n\n      if (k - offseti <= len_max) {\n        return false;\n      }\n\n      dist = j;\n      len_max = k - offseti;\n\n      if (k === kmax) {\n        return true;\n      }\n    });\n\n    if (dist) {\n      result[idx] = -len_max;\n      idx++;\n      result[idx] = dist;\n      i += len_max - 1; //マップ追加\n\n      for (j = 0; j < len_max; j++) {\n        setmap(maps, u8a, j + offseti);\n      } //マップ削除\n\n\n      var jmax = offseti - 32768 + len_max;\n      j = Math.max(0, offseti - 32768);\n\n      for (; j < jmax; j++) {\n        removemap(maps, u8a, j);\n      }\n    } else {\n      result[idx] = u8a[offseti]; //マップ追加\n\n      setmap(maps, u8a, offseti); //マップ削除\n\n      var j = offseti - 32768;\n\n      if (j >= 0) {\n        removemap(maps, u8a, j);\n      }\n    }\n\n    idx++;\n  }\n\n  for (; i < size; i++) {\n    result[idx] = u8a[offset + i];\n    idx++;\n  }\n\n  result.length = idx;\n  return result;\n};\n\nvar compressLZ77_ = function (u8a, offset, size) {\n  //LZ77で圧縮する\n  var result = new Array(size);\n  var idx = 0;\n  var maps = {};\n  var imax = offset + size - 2;\n  var i = Math.max(0, offset - 32768);\n\n  for (; i < imax; i++) {\n    var key = (u8a[i] << 16) + (u8a[i + 1] << 8) + u8a[i + 2];\n\n    if (!maps[key]) {\n      maps[key] = [];\n    }\n\n    maps[key].push(i);\n  }\n\n  var imax = size - 2;\n\n  for (var i = 0; i < imax; i++) {\n    //先頭から走査\n    var dist = 0;\n    var len_max = 2;\n    var offseti = offset + i;\n    var kmax = Math.min(size - i, 258);\n    var key = (u8a[offseti] << 16) + (u8a[offseti + 1] << 8) + u8a[offseti + 2];\n    var map = maps[key];\n\n    for (var m = map.length; m--;) {\n      var j = offseti - map[m];\n\n      if (j <= 0) {\n        continue;\n      }\n\n      if (j > 32768) {\n        continue;\n      }\n\n      ;\n      var offsetj = offseti - j;\n      var k = 3;\n\n      for (; k < kmax; k++) {\n        if (u8a[offseti + k] !== u8a[offsetj + k]) {\n          break;\n        }\n      }\n\n      if (k <= len_max) {\n        continue;\n      }\n\n      dist = j;\n      len_max = k;\n\n      if (len_max === kmax) {\n        break;\n      }\n    }\n\n    if (dist) {\n      result[idx] = -len_max;\n      idx++;\n      result[idx] = dist;\n      i += len_max - 1;\n    } else {\n      result[idx] = u8a[offseti];\n    }\n\n    idx++;\n  }\n\n  for (; i < size; i++) {\n    result[idx] = u8a[offset + i];\n    idx++;\n  }\n\n  result.length = idx;\n  return result;\n};\n\nvar expandLZ77 = function (data, exist_data) {\n  //LZ77圧縮データを伸長する\n  var decoded_data;\n\n  if (exist_data) {\n    decoded_data = exist_data;\n  } else {\n    decoded_data = [];\n  }\n\n  for (var i = 0; i < data.length; i++) {\n    if (data[i] >= 0) {\n      //リテラルの場合そのまま出力\n      decoded_data.push(data[i]);\n    } else {\n      //繰り返しの場合それを出力\n      var len = -data[i];\n      i++;\n      var dist = data[i];\n      var idx = decoded_data.length - dist;\n\n      for (var j = 0; j < len; j++) {\n        decoded_data.push(decoded_data[idx + j]);\n      }\n    }\n  }\n\n  return decoded_data;\n};\n\nvar formatBinary = function (array_buffer) {\n  var src = new Uint8Array(array_buffer);\n  var result = \"\";\n\n  for (var i = 0; i < src.length; i++) {\n    if (i !== 0) {\n      result += \",\";\n    }\n\n    result += ('00000000' + src[i].toString(2)).slice(-8);\n  }\n\n  return result;\n};\n\nvar formatHuffmans = function (huffmans) {\n  var result = \"\";\n\n  for (var i = 0; i < huffmans.length && i < 3; i++) {\n    if (i !== 0) {\n      result += \",\";\n    }\n\n    result += ('0000000000' + huffmans[i].Code.toString(2)).slice(-huffmans[i].Len);\n  }\n\n  return result;\n};\n\nvar format = function (src) {\n  //\n  var result = \"\";\n\n  for (var i = 0; i < src.length; i++) {\n    if (i !== 0) {\n      result += \",\";\n    }\n\n    if (isNaN(src[i])) {\n      result += \"&lt;\" + src[i].len.toString(10) + \",\" + src[i].dist.toString(10) + \"&gt;\";\n    } else {\n      result += src[i].toString(10);\n    }\n  }\n\n  return result;\n};\n\n//# sourceURL=webpack://hdrpaint/./src/lib/deflate.js?");

/***/ }),

/***/ "./src/lib/geono.js":
/*!**************************!*\
  !*** ./src/lib/geono.js ***!
  \**************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Geono; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./vector.js */ \"./src/lib/vector.js\");\n\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\nclass Geono {\n  static getOuterCenter(ans, p0, p1, p2) {\n    //外接円の中心\n    var a = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.len2(p2, p1);\n    var b = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.len2(p2, p0);\n    var c = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.len2(p0, p1);\n    var A = a * (b + c - a);\n    var B = b * (c + a - b);\n    var C = c * (a + b - c);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mul(ans, p0, A);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.madd(ans, ans, p1, B);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.madd(ans, ans, p2, C);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mul(ans, ans, 1 / (A + B + C));\n  }\n\n  static getOuterCenter3_sub(ans, p0, p1, p2) {\n    var a = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(p2, p1);\n    var b = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(p2, p0);\n    var c = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(p0, p1);\n    var A = a * (b + c - a);\n    var B = b * (c + a - b);\n    var C = c * (a + b - c);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(ans, p0, A);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans, ans, p1, B);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans, ans, p2, C);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(ans, ans, 1 / (A + B + C));\n  }\n\n  static getOuterCenter3(ans, p0, p1, p2, p3) {\n    //外接球の中心\n    var a = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(p2, p1);\n    var b = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(p2, p0);\n    var c = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(p0, p1);\n    var d = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(p0, p3);\n    var e = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(p1, p3);\n    var f = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(p2, p3);\n    var K = a * d * (e + f - a) + b * e * (f + a - e) + c * f * (a + e - f) - 2 * a * e * f;\n    var L = a * d * (b + f - d) + b * e * (f + d - b) + c * f * (d + b - f) - 2 * d * b * f;\n    var M = a * d * (e + c - d) + b * e * (c + d - e) + c * f * (d + e - c) - 2 * d * e * c;\n    var N = a * d * (b + c - a) + b * e * (c + a - b) + c * f * (a + b - c) - 2 * a * b * c;\n\n    if (Math.abs(K + L + M + N) > 0.00001) {\n      var det = 1 / (K + L + M + N);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(ans, p0, K * det);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans, ans, p1, L * det);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans, ans, p2, M * det);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans, ans, p3, N * det);\n    } else {\n      ans[0] = NaN; //Geono.getOuterCenter3_sub(ans,p0,p1,p2);\n    } //Vec3.mul(ans,ans,1/(K+L+M+N));\n\n  }\n\n  static LINE_POINT(ans, l1, l2, p1) {\n    //線分と点の最近点\n    var dir = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n    var dpos = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dir, l2, l1); //線分の向き\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dpos, p1, l1); //線分と点の差\n\n    var r = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(dir, dpos);\n\n    if (r <= 0) {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(ans, l1);\n    } else {\n      var r2 = dir[0] * dir[0] + dir[1] * dir[1] + dir[2] * dir[2];\n\n      if (r > r2) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(ans, l2);\n      } else {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans, l1, dir, r / r2);\n      }\n    }\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(2);\n    return _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(ans, p1);\n  }\n\n  static calcSquarePos(ans, A, B, C, D, P) {\n    //四角ABCD内の点Pを(0~1,0~1)座標に変換\n    var BA = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n    var CD = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n    var AP = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n    var DP = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n    var n = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross3(n, A, C, B, D); //四角の法線\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(BA, B, A);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(CD, C, D);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(AP, A, P);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(DP, D, P);\n    var a = 0;\n    var b = 0;\n    var c = 0;\n\n    for (var i = 0; i < 3; i++) {\n      var i1 = (i + 1) % 3;\n      var i2 = (i + 2) % 3;\n      a += (BA[i1] * CD[i2] - BA[i2] * CD[i1]) * n[i];\n      b += (BA[i1] * DP[i2] + AP[i1] * CD[i2] - (BA[i2] * DP[i1] + AP[i2] * CD[i1])) * n[i];\n      c += (AP[i1] * DP[i2] - AP[i2] * DP[i1]) * n[i];\n    }\n\n    var t;\n\n    if (!a) {\n      t = -c / b;\n    } else {\n      if (b * b - 4 * a * c < 0) {\n        t = -b / (2 * a);\n      } else {\n        t = (-b + Math.sqrt(b * b - 4 * a * c)) / (2 * a);\n      }\n\n      var AD = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(AD, A, D);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(AD, AD, n);\n      var BC = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(BC, B, C);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(BC, n, BC);\n      var BP = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(BP, B, P);\n\n      if (t < 0 && _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(AD, AP) > 0 || t > 1 && _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(BC, BP) > 0) {\n        t = (-b - Math.sqrt(b * b - 4 * a * c)) / (2 * a);\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(3);\n    }\n\n    ans[0] = t;\n    var FE = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n    var PE = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(FE, D, CD, t);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(FE, FE, BA, -t);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(FE, FE, A);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(PE, BA, t);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(PE, PE, A);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(PE, P, PE);\n    ans[1] = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(PE, FE) / _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(FE, FE);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(7);\n    return t;\n  }\n\n  static TETRA_POINT(ans, p, v) {\n    var vbuf = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n    var flg = true;\n\n    for (var i = 0; i < 4; i++) {\n      //4つの面それぞれから対象までの距離を求める\n      var t1 = v[i + 1 & 3];\n      var t2 = v[i + 2 & 3];\n      var t3 = v[i + 3 & 3];\n      var t4 = v[i];\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross2(vbuf, t1, t2, t3); //Vec3.sub(d,p,t1);\n\n      var l0 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(t1, vbuf); //面までの距離\n\n      var l1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(p, vbuf) - l0; //点までの距離\n\n      var l2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(t4, vbuf) - l0; //もうひとつの頂点までの距離\n\n      if (l2 * l2 <= 0.0000000001 || l1 * l2 < 0) {\n        //四面体に内包されない\n        flg = false;\n        break;\n      }\n\n      if (ans) {\n        ans[i] = l1 / l2;\n      }\n    }\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(1);\n    return flg;\n  }\n\n}\n\n_defineProperty(Geono, \"LINE_LINE\", function (a1, a2, p1, p2, p3, p4) {\n  //線分と線分の最近点\n  var dir1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var dir2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var cross = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var dpos = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var l;\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dir1, p2, p1); //線分1の向き\n\n  if (!(dir1[0] || dir1[1] || dir1[2])) {\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a1, p1);\n    this.LINE_POINT(a2, p3, p4, a1);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n    return;\n  }\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dir2, p4, p3); // 線分2の向き\n\n  if (!(dir2[0] || dir2[1] || dir2[2])) {\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a2, p3);\n    this.LINE_POINT(a1, p1, p2, a2);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n    return;\n  }\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(cross, dir1, dir2); //垂直ベクトル\n\n  if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.scalar(cross)) {\n    //2直線に垂直な方向から見たときの交点\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(cross, dir2, cross); //線分2に垂直かつ線分1に並行?なベクトル\n\n    var l1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross, dir1);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dpos, p3, p1);\n    var r1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross, dpos); //線分1の交差比率\n\n    if (r1 * l1 >= 0 && r1 * r1 <= l1 * l1) {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(cross, dir1, dir2); //垂直ベクトル\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(cross, dir1, cross); //線分1に垂直かつ線分2に並行?なベクトル\n\n      var l2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross, dir2);\n      var r2 = -_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross, dpos); //線分2の交差比率\n\n      if (r2 * l2 >= 0 && r2 * r2 <= l2 * l2) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(a1, p1, dir1, r1 / l1);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(a2, p3, dir2, r2 / l2);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n        return;\n      }\n    }\n  }\n\n  var min = this.LINE_POINT(dpos, p1, p2, p3);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a1, dpos);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a2, p3);\n  var l = this.LINE_POINT(dpos, p1, p2, p4);\n\n  if (l < min) {\n    min = l;\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a1, dpos);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a2, p4);\n  }\n\n  l = this.LINE_POINT(dpos, p3, p4, p1);\n\n  if (l < min) {\n    min = l;\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a1, p1);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a2, dpos);\n  }\n\n  l = this.LINE_POINT(dpos, p3, p4, p2);\n\n  if (l < min) {\n    min = l;\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a1, p2);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a2, dpos);\n  }\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n});\n\n_defineProperty(Geono, \"TRIANGLE_POINT\", function (ans, t1, t2, t3, p1) {\n  //三角と点の最近点\n  var dir = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var cross = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var cross2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var dpos = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  cross[0] = t2[1] * t3[2] - t2[2] * t3[1] + t1[2] * (-t2[1] + t3[1]) + t1[1] * (t2[2] - t3[2]);\n  cross[1] = t2[2] * t3[0] - t2[0] * t3[2] + t1[0] * (-t2[2] + t3[2]) + t1[2] * (t2[0] - t3[0]);\n  cross[2] = t2[0] * t3[1] - t2[1] * t3[0] + t1[1] * (-t2[0] + t3[0]) + t1[0] * (t2[1] - t3[1]);\n  var ts = [t1, t2, t3, t1, t2];\n\n  for (var i = 0; i < 3; i++) {\n    var v1 = ts[i];\n    var v2 = ts[i + 1];\n    var v3 = ts[i + 2];\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dpos, p1, v1);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dir, v2, v1); //線分の向き\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(cross2, cross, dir); //法線と線分に垂直なベクトル\n\n    if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross2, dpos) <= 0) {\n      var l = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(dpos, dir);\n\n      var _l = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(dir, dir);\n\n      if (l < 0) {\n        this.LINE_POINT(ans, v1, v3, p1);\n      } else if (l > _l) {\n        this.LINE_POINT(ans, v2, v3, p1);\n      } else {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans, v1, dir, l / _l);\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n      return;\n    }\n  }\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans, p1, cross, -_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross, dpos) / (cross[0] * cross[0] + cross[1] * cross[1] + cross[2] * cross[2]));\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n});\n\n_defineProperty(Geono, \"TRIANGLE_LINE\", function (t1, t2, t3, l1, l2) {\n  //三角と線分の最近点\n  var dpos = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var cross = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var pos2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var cross2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross2(cross, t1, t2, t3);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dpos, t1, l1); //線開始点とポリゴンの距離\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(pos2, l2, l1); //線開始点とポリゴンの距離\n\n  var l = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross, dpos) / _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross, pos2);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(pos2, l1, pos2, l); //面と線の交点\n\n  var ts = [t1, t2, t3, t1];\n\n  for (var j = 0; j < 3; j++) {\n    var v1 = ts[j];\n    var v2 = ts[j + 1];\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dpos, v2, v1); //線分の向き\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(cross2, cross, dpos); //法線と線分に垂直なベクトル\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dpos, pos2, v1);\n\n    if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross2, dpos) <= 0) {\n      //辺の外の場合はずれ\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n      return 99999;\n    }\n  }\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n  return l;\n});\n\n;\n\n//# sourceURL=webpack://hdrpaint/./src/lib/geono.js?");

/***/ }),

/***/ "./src/lib/img.js":
/*!************************!*\
  !*** ./src/lib/img.js ***!
  \************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Img; }\n/* harmony export */ });\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _openexr_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./openexr.js */ \"./src/lib/openexr.js\");\n\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\nlet ctx, canvas, ctx_imagedata;\ncanvas = document.createElement('canvas');\ncanvas.width = 1;\ncanvas.height = 1;\nctx = canvas.getContext('2d');\nctx_imagedata = ctx.createImageData(canvas.width, canvas.height);\nlet FORMAT_FLOAT32 = 0;\nlet FORMAT_UINT8 = 1;\nlet ret_data = new _vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec4();\n\nlet add = (dst, src, idx, idx2, idx3, r) => {\n  //var a2 = src[idx2+3];\n  //var a3 = src[idx3+3];\n  dst[idx + 0] += (src[idx2 + 0] + src[idx3 + 0]) * r;\n  dst[idx + 1] += (src[idx2 + 1] + src[idx3 + 1]) * r;\n  dst[idx + 2] += (src[idx2 + 2] + src[idx3 + 2]) * r;\n  dst[idx + 3] += (src[idx2 + 3] + src[idx3 + 3]) * r;\n};\n\nlet mul = (dst, idx) => {\n  var a = dst[idx + 3];\n\n  if (a === 0 || a === 1) {\n    return;\n  }\n\n  a = 1 / a;\n  dst[idx + 0] *= a;\n  dst[idx + 1] *= a;\n  dst[idx + 2] *= a;\n};\n\nclass Img {\n  //イメージ\n  constructor(_x, _y, format) {\n    _defineProperty(this, \"toDataURL\", function (p1, p2, x, y, w, h) {\n      return this.toCanvas(x, y, w, h).toDataURL(p1, p2);\n    });\n\n    _defineProperty(this, \"toBlob\", function (f, p1, p2, x, y, w, h) {\n      return this.toCanvas(x, y, w, h).toBlob(f, p1, p2);\n    });\n\n    _defineProperty(this, \"toBMP\", function () {\n      var height = this.height;\n      var width = this.width;\n      var l = height * (width * 4 + 1 >>> 2 << 2) * 2 + 14 + 40;\n      var dv = new DataStream(l); //0x0000　(2)\tbfType\tファイルタイプ　通常は'BM'\n\n      dv.setTextBuf(\"BM\", 0); //0x0002　(4)\tbfSize\tファイルサイズ (byte)\n\n      dv.setUint32(l, true); //0x0006　(2)\tbfReserved1\t予約領域　常に 0\n\n      dv.setUint16(0, true); //0x0008　(2)\tbfReserved2\t予約領域　常に 0\n\n      dv.setUint16(0, true); //0x000A　(4)\tbfOffBits\tファイル先頭から画像データまでのオフセット (byte)\n\n      dv.setUint32(12 + 42, true); //ヘッダサイズ\n\n      dv.setUint32(40, true); //画像幅\n\n      dv.setUint32(this.width, true); //画像高さ\n\n      dv.setUint32(this.height, true); //プレーン数\n\n      dv.setUint16(1, true); //1画素あたり\n\n      dv.setUint16(32, true); //圧縮\n\n      dv.setUint32(0, true); //画像サイズ\n\n      dv.setUint32(this.data.length, true); //横解像度\n\n      dv.setUint32(0, true); //縦解像度\n\n      dv.setUint32(0, true); //パレット\n\n      dv.setUint32(0, true); //重要パレット\n\n      dv.setUint32(0, true);\n      var data = this.data;\n\n      switch (this.format) {\n        case 1:\n          for (var yi = height; yi--;) {\n            var idx = yi * width << 2;\n\n            for (var xi = 0; xi < width; xi++) {\n              dv.setUint8(data[idx + 2], true);\n              dv.setUint8(data[idx + 1], true);\n              dv.setUint8(data[idx + 0], true);\n              dv.setUint8(data[idx + 3], true);\n              idx += 4;\n            }\n          }\n\n          break;\n\n        default:\n          break;\n      } //var blob = new Blob([dv.byteBuffer], {type: \"application/octet-stream\"});\n      //return  window.URL.createObjectURL(blob);\n\n\n      return dv.byteBuffer; //var b64= btoa(String.fromCharCode.apply(null,dv.byteBuffer));\n      //return \"data:image/bmp;base64,\"+b64;\n    });\n\n    if (!_x) {\n      _x = 0;\n      _y = 0;\n    }\n\n    this.width = _x;\n    this.height = _y;\n    this.data = null;\n    this.format = format;\n\n    if (this.width) {\n      switch (this.format) {\n        case FORMAT_UINT8:\n          this.imagedata = ctx.createImageData(this.width, this.height);\n          this.data = this.imagedata.data; //new Uint8Array(this.width*this.height<<2);\n\n          this.rgba = new Uint32Array(this.data.buffer);\n          break;\n\n        default:\n          this.data = new Float32Array(this.width * this.height << 2);\n          break;\n      }\n    }\n  }\n\n  scan(f, x, y, w, h) {\n    var data = this.data;\n\n    if (x === undefined) {\n      x = 0;\n      y = 0;\n      w = this.width;\n      h = this.height;\n    }\n\n    for (var yi = 0; yi < h; yi++) {\n      var idx = this.getIndex(x, yi + y) << 2;\n\n      for (var xi = 0; xi < w; xi++) {\n        f(data, idx, x + xi, y + yi); //data[idx ] =  ret_data[0];\n        //data[idx+1] = ret_data[1];\n        //data[idx+2] = ret_data[2];\n        //data[idx+3] = ret_data[3];\n\n        idx += 4;\n      }\n    }\n  }\n\n  static copy(dst, dst_x, dst_y, src, src_x, src_y, src_w, src_h, f) {\n    var dst_data = dst.data;\n    var dst_width = dst.width;\n    var src_data = src.data;\n    var src_width = src.width;\n\n    if (src_w + src_x > src.width) {\n      src_w = src.width - src_x;\n    }\n\n    if (src_h + src_y > src.height) {\n      src_h = src.height - src_y;\n    }\n\n    var left = dst_x;\n    var right = dst_x + src_w;\n    var top = dst_y;\n    var bottom = dst_y + src_h;\n\n    if (src_x < 0) {\n      left -= src_x;\n      src_x = 0;\n    }\n\n    if (src_y < 0) {\n      top -= src_y;\n      src_y = 0;\n    }\n\n    if (left < 0) {\n      src_x -= left;\n      left = 0;\n    }\n\n    if (top < 0) {\n      src_y -= top;\n      top = 0;\n    }\n\n    if (right > dst.width) {\n      right = dst.width;\n    }\n\n    if (bottom > dst.height) {\n      bottom = dst.height;\n    }\n\n    if (dst.type === FORMAT_UINT8 && src.type === FORMAT_UINT8) {\n      for (var yi = top; yi < bottom; yi++) {\n        var dst_idx = dst.getIndex(left, yi);\n        var src_idx = src.getIndex(src_x, src_y + yi - top);\n\n        for (var xi = left; xi < right; xi++) {\n          dst.rgba[dst_idx] = src.rgba[src_idx];\n          dst_idx++;\n          src_idx++;\n        }\n      }\n    } else {\n      for (var yi = top; yi < bottom; yi++) {\n        var dst_idx = dst.getIndex(left, yi);\n        var src_idx = src.getIndex(src_x, src_y + yi - top);\n        dst_idx <<= 2;\n        src_idx <<= 2;\n\n        for (var xi = left; xi < right; xi++) {\n          dst_data[dst_idx + 0] = src_data[src_idx + 0];\n          dst_data[dst_idx + 1] = src_data[src_idx + 1];\n          dst_data[dst_idx + 2] = src_data[src_idx + 2];\n          dst_data[dst_idx + 3] = src_data[src_idx + 3];\n          dst_idx += 4;\n          src_idx += 4;\n        }\n      }\n    }\n  }\n\n  copy(dst, dst_x, dst_y, src, src_x, src_y, src_w, src_h) {\n    Img.copy(this, dst, dst_x, dst_y, src, src_x, src_y, src_w, src_h);\n  }\n\n  getIndex(x, y) {\n    return y * this.width + x;\n  }\n\n  getIndexLoop(x, y) {\n    var xx = x % this.width;\n    var yy = y % this.height;\n    if (xx < 0) xx += this.width;\n    if (yy < 0) yy += this.height;\n    return yy * this.width + xx;\n  }\n\n  createExr(compression) {\n    var img = this;\n    var obj = {};\n    obj.width = img.width;\n    obj.height = img.height;\n    obj.attributes = [];\n    obj.attributes[\"compression\"] = compression;\n    obj.attributes[\"dataWindow\"] = {\n      xMin: 0,\n      yMin: 0,\n      xMax: img.width - 1,\n      yMax: img.height - 1\n    };\n    obj.attributes[\"displayWindow\"] = {\n      xMin: 0,\n      yMin: 0,\n      xMax: img.width - 1,\n      yMax: img.height - 1\n    };\n    obj.attributes[\"lineOrder\"] = 0;\n    obj.attributes[\"pixelAspectRatio\"] = 1;\n    obj.attributes[\"screenWindowCenter\"] = [0, 0];\n    obj.attributes[\"screenWindowWidth\"] = 1; //\t\tobj.attributes[\"chromaticities\"]=[0.1,0.1,0.1,0.2,0.3,0.4,0.5,0.6];\n\n    var size = img.width * img.height;\n    var channels = [];\n\n    for (var i = 0; i < 4; i++) {\n      var channel = {};\n      channel.data = new Float32Array(size);\n      channel.pixel_type = 1;\n      channel.pLiner = 0;\n      channel.reserved = 0;\n      channel.xSampling = 1;\n      channel.ySampling = 1;\n      channels.push(channel);\n    }\n\n    channels[0].name = \"A\";\n    channels[1].name = \"B\";\n    channels[2].name = \"G\";\n    channels[3].name = \"R\";\n    var img_data = img.data;\n\n    for (var i = 0; i < size; i++) {\n      var idx = i << 2;\n      channels[0].data[i] = img_data[idx + 3];\n      channels[1].data[i] = img_data[idx + 2];\n      channels[2].data[i] = img_data[idx + 1];\n      channels[3].data[i] = img_data[idx + 0];\n    }\n\n    obj.attributes.channels = channels;\n    return _openexr_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].toArrayBuffer(obj);\n  }\n\n  static loadImg(url, format, func) {\n    if (typeof url !== \"string\") {\n      _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].loadFile(url, function (url) {\n        Img.loadImg(url, format, func);\n      });\n      return null;\n    }\n\n    var image = new Image();\n    image.src = url;\n    var img = new Img();\n    img.name = url;\n    img.format = format;\n\n    image.onload = function (e) {\n      img.width = image.width;\n      img.height = image.height;\n\n      if (canvas.width < img.width || canvas.height < img.height) {\n        //開いた画像がキャンバスより大きい場合は広げる\n        if (canvas.width < img.width) {\n          canvas.width = img.width;\n        }\n\n        if (canvas.height < img.height) {\n          canvas.height = img.height;\n        }\n\n        ctx_imagedata = ctx.createImageData(canvas.width, canvas.height);\n      } //ピクセルデータ取得\n\n\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.drawImage(image, 0, 0);\n      var data = ctx.getImageData(0, 0, img.width, img.height).data;\n\n      switch (img.format) {\n        case 1:\n          img.data = new Uint8Array(img.width * img.height * 4);\n          img.rgba = new Uint32Array(img.data.buffer);\n\n          for (var di = 0; di < img.width * img.height * 4; di++) {\n            img.data[di] = data[di];\n          }\n\n          break;\n\n        default:\n          img.data = new Float32Array(img.width * img.height * 4);\n          var r = 1.0 / 255.0;\n\n          for (var di = 0; di < img.width * img.height * 4; di++) {\n            img.data[di] = data[di] * r;\n          }\n\n      }\n\n      if (func) {\n        func(img);\n      }\n    };\n\n    return img;\n  }\n\n  static loadExr(url, format, func) {\n    var img = new Img();\n\n    var f = function (buffer) {\n      var obj = {};\n      _openexr_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].fromArrayBuffer(obj, buffer);\n      img.width = obj.width;\n      img.height = obj.height;\n      img.data = new Float32Array(img.width * img.height * 4); //RGBAチャンネルの情報をdataにセットする\n\n      var channels = obj.attributes.channels;\n      var data = img.data;\n      var cindex = {};\n      cindex[\"R\"] = -1;\n      cindex[\"G\"] = -1;\n      cindex[\"B\"] = -1;\n      cindex[\"A\"] = -1;\n\n      for (var i = 0; i < channels.length; i++) {\n        cindex[channels[i].name] = i;\n      }\n\n      var r = cindex[\"R\"];\n      var g = cindex[\"G\"];\n      var b = cindex[\"B\"];\n      var size = img.width * img.height * 4;\n\n      for (var i = 0; i < size; i += 4) {\n        data[i] = channels[r].data[i >> 2];\n        data[i + 1] = channels[g].data[i >> 2];\n        data[i + 2] = channels[b].data[i >> 2];\n      }\n\n      var a = cindex[\"A\"];\n\n      if (a >= 0) {\n        for (var i = 0; i < size; i += 4) {\n          data[i + 3] = channels[a].data[i >> 2];\n        }\n      } else {\n        for (var i = 0; i < size; i += 4) {\n          data[i + 3] = 1;\n        }\n      }\n\n      if (func) {\n        func(img);\n      }\n    };\n\n    if (typeof url === \"string\") {\n      _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].loadBinary(url, function (buffer) {\n        f(buffer);\n      });\n    } else {\n      if (url.byteLength) {\n        f(url);\n      } else {\n        _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].loadBinary(url, function (buffer) {\n          f(buffer);\n        });\n      }\n    }\n\n    return img;\n  }\n\n  fill(r, g, b, a, x, y, w, h) {\n    var data = this.data;\n\n    if (x === undefined) {\n      var size = data.length;\n\n      for (var i = 0; i < size; i += 4) {\n        data[idx + 0] = r;\n        data[idx + 1] = g;\n        data[idx + 2] = b;\n        data[idx + 3] = a;\n      }\n    } else {\n      var img_width = this.width;\n      var bottom = Math.min(this.height, y + h);\n      var right = Math.min(img_width, x + w);\n\n      for (var yi = y; yi < bottom; yi++) {\n        var idx = yi * img_width + x << 2;\n        var max = yi * img_width + right << 2;\n\n        for (; idx < max; idx += 4) {\n          data[idx + 0] = r;\n          data[idx + 1] = g;\n          data[idx + 2] = b;\n          data[idx + 3] = a;\n        }\n      }\n    }\n  }\n\n  clear(x, y, w, h) {\n    //透明でクリア\n    var data = this.data;\n\n    if (x === undefined) {\n      var size = data.length;\n      data.fill(0);\n    } else {\n      var img_width = this.width;\n      var bottom = Math.min(this.height, y + h);\n      var right = Math.min(img_width, x + w);\n\n      for (var yi = y; yi < bottom; yi++) {\n        var idx = yi * img_width + x << 2;\n        var max = yi * img_width + right << 2;\n        data.fill(0, idx, max); //\t\t\t\tfor(;idx<max;idx+=4){\n        //\t\t\t\t\tdata[idx+0]=1;\n        //\t\t\t\t\tdata[idx+1]=1;\n        //\t\t\t\t\tdata[idx+2]=1;\n        //\t\t\t\t\tdata[idx+3]=0;\n        //\t\t\t\t}\n      }\n    }\n  }\n\n  toCanvas(x, y, w, h) {\n    if (x === undefined) {\n      x = 0;\n      y = 0;\n      w = this.width;\n      h = this.height;\n    }\n\n    canvas.width = w;\n    canvas.height = h;\n    ctx.putImageData(this.toImageData(), 0, 0, x, y, w, h);\n    return canvas;\n  }\n\n  toImageData() {\n    var ctx_imagedata;\n    var data = this.data;\n\n    switch (this.format) {\n      case FORMAT_UINT8:\n        ctx_imagedata = this.imagedata; //for(var yi=0;yi<this.height;yi++){\n        //\tfor(var xi=0;xi<this.width;xi++){\n        //\t\tvar idx=yi*this.width + xi<<2;\n        //\t\tfor(var ii=0;ii<4;ii++){\n        //\t\t\tctx_imagedata.data[idx+ii]=data[idx+ii];\n        //\t\t}\n        //\t}\n        //}\n\n        break;\n\n      default:\n        ctx_imagedata = ctx.createImageData(this.width, this.height);\n\n        for (var yi = 0; yi < this.height; yi++) {\n          for (var xi = 0; xi < this.width; xi++) {\n            var idx = yi * this.width + xi << 2;\n\n            for (var ii = 0; ii < 4; ii++) {\n              ctx_imagedata.data[idx + ii] = data[idx + ii] * 255.0;\n            }\n          }\n        }\n\n        break;\n    }\n\n    return ctx_imagedata;\n  }\n\n  gauss(d, size, left, top, w, h) {\n    if (!size) return;\n    var src = this;\n    d = Math.max(1, d);\n    var MAX = size | 0;\n\n    if (buffer_img.data.length < src.data.length) {\n      buffer_img = new Img(src.width, src.height);\n    }\n\n    buffer_img.width = src.width;\n    buffer_img.height = src.height;\n    var dst = buffer_img;\n    var right = left + w - 1;\n    var bottom = top + h - 1; //係数作成\n\n    var weight = new Array(MAX);\n    var t = 0.0;\n\n    for (var i = 0; i < weight.length; i++) {\n      var r = i;\n      var we = Math.exp(-(r * r) / (2 * d * d));\n      weight[i] = we;\n\n      if (i > 0) {\n        we *= 2.0;\n      }\n\n      t += we;\n    }\n\n    for (i = 0; i < weight.length; i++) {\n      weight[i] /= t;\n    }\n\n    var height = src.height;\n    var width = src.width;\n    var data = src.data;\n    var dstdata = dst.data; //横ぼかし\n\n    var top2 = Math.max(0, top - size);\n    var bottom2 = Math.min(src.height, bottom + size + 1);\n\n    for (var y = top2; y < bottom2; y++) {\n      var yidx = y * width;\n\n      for (var idx = yidx + left << 2, idxmax = yidx + (right + 1) << 2; idx < idxmax; idx += 4) {\n        var a = data[idx + 3];\n        data[idx + 0] *= a;\n        data[idx + 1] *= a;\n        data[idx + 2] *= a;\n      }\n\n      var x = left;\n      var idx = yidx + left << 2;\n      var max = yidx + right + 1 << 2;\n      var r = weight[0];\n      var maxidx = y * width + (width - 1) << 2;\n      var minidx = y * width << 2;\n\n      for (; idx < max; idx += 4) {\n        dstdata[idx + 0] = data[idx + 0] * r;\n        dstdata[idx + 1] = data[idx + 1] * r;\n        dstdata[idx + 2] = data[idx + 2] * r;\n        dstdata[idx + 3] = data[idx + 3] * r;\n      }\n\n      max = Math.min(MAX, right + 1);\n\n      for (; x < max; x++) {\n        var idx = yidx + x << 2;\n        var idx2 = idx;\n        var idx3 = idx;\n\n        for (var i = 1; i < MAX; i++) {\n          idx2 = Math.max(idx2 - 4, minidx);\n          idx3 = Math.min(idx3 + 4, maxidx);\n          var r = weight[i];\n          dstdata[idx + 0] += (data[idx2 + 0] + data[idx3 + 0]) * r;\n          dstdata[idx + 1] += (data[idx2 + 1] + data[idx3 + 1]) * r;\n          dstdata[idx + 2] += (data[idx2 + 2] + data[idx3 + 2]) * r;\n          dstdata[idx + 3] += (data[idx2 + 3] + data[idx3 + 3]) * r;\n        }\n      }\n\n      max = Math.min(width - MAX, right + 1);\n\n      for (; x < max; x++) {\n        var idx = yidx + x << 2;\n        var idx2 = idx;\n        var idx3 = idx;\n\n        for (var i = 1; i < MAX; i++) {\n          idx2 -= 4;\n          idx3 += 4;\n          var r = weight[i];\n          dstdata[idx + 0] += (data[idx2 + 0] + data[idx3 + 0]) * r;\n          dstdata[idx + 1] += (data[idx2 + 1] + data[idx3 + 1]) * r;\n          dstdata[idx + 2] += (data[idx2 + 2] + data[idx3 + 2]) * r;\n          dstdata[idx + 3] += (data[idx2 + 3] + data[idx3 + 3]) * r;\n        }\n      }\n\n      var max = Math.min(right + 1, width);\n\n      for (; x < max; x++) {\n        var idx = yidx + x << 2;\n        var idx2 = idx;\n        var idx3 = idx;\n\n        for (var i = 1; i < MAX; i++) {\n          idx2 = Math.max(idx2 - 4, minidx);\n          idx3 = Math.min(idx3 + 4, maxidx);\n          var r = weight[i];\n          dstdata[idx + 0] += (data[idx2 + 0] + data[idx3 + 0]) * r;\n          dstdata[idx + 1] += (data[idx2 + 1] + data[idx3 + 1]) * r;\n          dstdata[idx + 2] += (data[idx2 + 2] + data[idx3 + 2]) * r;\n          dstdata[idx + 3] += (data[idx2 + 3] + data[idx3 + 3]) * r;\n        }\n      }\n    } //縦ぼかし\n\n\n    data = dst.data;\n    dstdata = src.data;\n\n    for (var x = left; x < right + 1; x++) {\n      var width4 = width << 2;\n      var idx = top * width + x << 2;\n      var max = (bottom + 1) * width + x << 2;\n      var r = weight[0];\n\n      for (; idx < max; idx += width * 4) {\n        dstdata[idx + 0] = data[idx + 0] * r;\n        dstdata[idx + 1] = data[idx + 1] * r;\n        dstdata[idx + 2] = data[idx + 2] * r;\n        dstdata[idx + 3] = data[idx + 3] * r;\n      }\n\n      y = top;\n      max = Math.min(MAX, bottom + 1);\n      var maxidx = (height - 1) * width + x << 2;\n      var minidx = x << 2;\n\n      for (; y < max; y++) {\n        idx = y * width + x << 2;\n        idx2 = idx;\n        idx3 = idx;\n\n        for (var i = 1; i < MAX; i++) {\n          idx2 = Math.max(idx2 - width4, minidx);\n          idx3 = Math.min(idx3 + width4, maxidx);\n          var r = weight[i];\n          dstdata[idx + 0] += (data[idx2 + 0] + data[idx3 + 0]) * r;\n          dstdata[idx + 1] += (data[idx2 + 1] + data[idx3 + 1]) * r;\n          dstdata[idx + 2] += (data[idx2 + 2] + data[idx3 + 2]) * r;\n          dstdata[idx + 3] += (data[idx2 + 3] + data[idx3 + 3]) * r;\n        }\n      }\n\n      max = Math.min(height - MAX, bottom + 1);\n\n      for (; y < max; y++) {\n        idx = y * width + x << 2;\n        var idx2 = idx;\n        var idx3 = idx;\n        var aaa = width << 2;\n\n        for (var i = 1; i < MAX; i++) {\n          idx2 -= width4;\n          idx3 += width4;\n          var r = weight[i];\n          dstdata[idx + 0] += (data[idx2 + 0] + data[idx3 + 0]) * r;\n          dstdata[idx + 1] += (data[idx2 + 1] + data[idx3 + 1]) * r;\n          dstdata[idx + 2] += (data[idx2 + 2] + data[idx3 + 2]) * r;\n          dstdata[idx + 3] += (data[idx2 + 3] + data[idx3 + 3]) * r;\n        }\n      }\n\n      max = Math.min(height, bottom + 1);\n\n      for (; y < max; y++) {\n        idx = y * width + x << 2;\n        idx2 = idx;\n        idx3 = idx;\n\n        for (var i = 1; i < MAX; i++) {\n          idx2 = Math.max(idx2 - width4, minidx);\n          idx3 = Math.min(idx3 + width4, maxidx); //var idx2= Math.max(y-i,0) *width+ x  <<2;\n          //var idx3= Math.min(y+i,height-1)*width+x <<2;\n\n          var r = weight[i];\n          dstdata[idx + 0] += (data[idx2 + 0] + data[idx3 + 0]) * r;\n          dstdata[idx + 1] += (data[idx2 + 1] + data[idx3 + 1]) * r;\n          dstdata[idx + 2] += (data[idx2 + 2] + data[idx3 + 2]) * r;\n          dstdata[idx + 3] += (data[idx2 + 3] + data[idx3 + 3]) * r;\n        }\n      }\n\n      for (var idx = top * width + x << 2, idxmax = (bottom + 1) * width + x << 2; idx < idxmax; idx += 4 * width) {\n        var a = dstdata[idx + 3];\n\n        if (a > 0 && a < 1) {\n          a = 1 / a;\n          dstdata[idx + 0] *= a;\n          dstdata[idx + 1] *= a;\n          dstdata[idx + 2] *= a;\n        }\n      }\n    }\n  }\n\n}\n\n_defineProperty(Img, \"FORMAT_FLOAT32\", 0);\n\n_defineProperty(Img, \"FORMAT_UINT8\", 1);\n\nlet buffer_img = new Img(1024, 1024);\n\n//# sourceURL=webpack://hdrpaint/./src/lib/img.js?");

/***/ }),

/***/ "./src/lib/noise.js":
/*!**************************!*\
  !*** ./src/lib/noise.js ***!
  \**************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Noise; }\n/* harmony export */ });\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar ROOT3_2 = Math.sqrt(3) / 2;\n\nvar _ROOT3_2 = 1 / ROOT3_2;\n\nvar F3 = 1.0 / 3.0;\nvar G3 = -1.0 / 6.0;\n\nvar hash3 = function (x, y, z) {\n  return h[x + h[y + h[z & 0xff] & 0xff] & 0xff];\n};\n\nclass Noise {\n  constructor() {}\n\n  static valuenoise(x, y, z) {\n    var x_d = x - (x | 0);\n    var y_d = y - (y | 0);\n    var z_d = z - (z | 0);\n    var x_i = x & 0xff;\n    var y_i = y & 0xff;\n    var z_i = z & 0xff;\n    var x_f = fade(x_d);\n    var y_f = fade(y_d);\n    var z_f = fade(z_d);\n    var r = lerp(z_f, lerp(y_f, lerp(x_f, hash256(x_i, y_i, z_i), hash256(x_i + 1, y_i, z_i)), lerp(x_f, hash256(x_i, y_i + 1, z_i), hash256(x_i + 1, y_i + 1, z_i))), lerp(y_f, lerp(x_f, hash256(x_i, y_i, z_i + 1), hash256(x_i + 1, y_i, z_i + 1)), lerp(x_f, hash256(x_i, y_i + 1, z_i + 1), hash256(x_i + 1, y_i + 1, z_i + 1))));\n    return r * _NIGORO;\n  }\n\n  static perlinnoise(x, y, z) {\n    var x_d = x - (x | 0);\n    var y_d = y - (y | 0);\n    var z_d = z - (z | 0);\n    var x_i = x & 0xff;\n    var y_i = y & 0xff;\n    var z_i = z & 0xff;\n    var x_f = fade(x_d);\n    var y_f = fade(y_d);\n    var z_f = fade(z_d);\n    var r = lerp(z_f, lerp(y_f, lerp(x_f, grad(hash256(x_i, y_i, z_i), x_d, y_d, z_d), grad(hash256(x_i + 1, y_i, z_i), x_d - 1, y_d, z_d)), lerp(x_f, grad(hash256(x_i, y_i + 1, z_i), x_d, y_d - 1, z_d), grad(hash256(x_i + 1, y_i + 1, z_i), x_d - 1, y_d - 1, z_d))), lerp(y_f, lerp(x_f, grad(hash256(x_i, y_i, z_i + 1), x_d, y_d, z_d - 1), grad(hash256(x_i + 1, y_i, z_i + 1), x_d - 1, y_d, z_d - 1)), lerp(x_f, grad(hash256(x_i, y_i + 1, z_i + 1), x_d, y_d - 1, z_d - 1), grad(hash256(x_i + 1, y_i + 1, z_i + 1), x_d - 1, y_d - 1, z_d - 1))));\n    return r * 0.5 + 0.5;\n  }\n\n}\n\n_defineProperty(Noise, \"simplexnoise\", function (xin, yin, zin) {\n  var s = (xin + yin + zin) * F3;\n  var i = Math.floor(xin + s);\n  var j = Math.floor(yin + s);\n  var k = Math.floor(zin + s);\n  var t = (i + j + k) * G3;\n  var x0 = xin - (i + t);\n  var y0 = yin - (j + t);\n  var z0 = zin - (k + t);\n  var i1, j1, k1;\n  var i2, j2, k2;\n\n  if (x0 >= y0) {\n    if (y0 >= z0) {\n      i1 = 1;\n      j1 = 0;\n      k1 = 0;\n      i2 = 1;\n      j2 = 1;\n      k2 = 0;\n    } else if (x0 >= z0) {\n      i1 = 1;\n      j1 = 0;\n      k1 = 0;\n      i2 = 1;\n      j2 = 0;\n      k2 = 1;\n    } else {\n      i1 = 0;\n      j1 = 0;\n      k1 = 1;\n      i2 = 1;\n      j2 = 0;\n      k2 = 1;\n    }\n  } else {\n    if (y0 < z0) {\n      i1 = 0;\n      j1 = 0;\n      k1 = 1;\n      i2 = 0;\n      j2 = 1;\n      k2 = 1;\n    } else if (x0 < z0) {\n      i1 = 0;\n      j1 = 1;\n      k1 = 0;\n      i2 = 0;\n      j2 = 1;\n      k2 = 1;\n    } else {\n      i1 = 0;\n      j1 = 1;\n      k1 = 0;\n      i2 = 1;\n      j2 = 1;\n      k2 = 0;\n    }\n  }\n\n  var x1 = x0 - (i1 + G3);\n  var y1 = y0 - (j1 + G3);\n  var z1 = z0 - (k1 + G3);\n  var x2 = x0 - (i2 + 2.0 * G3);\n  var y2 = y0 - (j2 + 2.0 * G3);\n  var z2 = z0 - (k2 + 2.0 * G3);\n  var x3 = x0 - (1.0 + 3.0 * G3);\n  var y3 = y0 - (1.0 + 3.0 * G3);\n  var z3 = z0 - (1.0 + 3.0 * G3);\n  var v = fade2(Math.max(0.5 - (x0 * x0 + y0 * y0 + z0 * z0), 0)) * grad(hash3(i, j, k), x0, y0, z0) + fade2(Math.max(0.5 - (x1 * x1 + y1 * y1 + z1 * z1), 0)) * grad(hash3(i + i1, j + j1, k + k1), x1, y1, z1) + fade2(Math.max(0.5 - (x2 * x2 + y2 * y2 + z2 * z2), 0)) * grad(hash3(i + i2, j + j2, k + k2), x2, y2, z2) + fade2(Math.max(0.5 - (x3 * x3 + y3 * y3 + z3 * z3), 0)) * grad(hash3(i + 1, j + 1, k + 1), x3, y3, z3);\n  return v * 10 * 0.5 + 0.5;\n});\n\nvar _NIGORO = 1 / 256;\n\nvar MAX = (1 << 30) - 1;\n\nvar _MAX = 1 / MAX;\n\nvar h = [151, 160, 137, 91, 90, 15, 131, 13, 201, 95, 96, 53, 194, 233, 7, 225, 140, 36, 103, 30, 69, 142, 8, 99, 37, 240, 21, 10, 23, 190, 6, 148, 247, 120, 234, 75, 0, 26, 197, 62, 94, 252, 219, 203, 117, 35, 11, 32, 57, 177, 33, 88, 237, 149, 56, 87, 174, 20, 125, 136, 171, 168, 68, 175, 74, 165, 71, 134, 139, 48, 27, 166, 77, 146, 158, 231, 83, 111, 229, 122, 60, 211, 133, 230, 220, 105, 92, 41, 55, 46, 245, 40, 244, 102, 143, 54, 65, 25, 63, 161, 1, 216, 80, 73, 209, 76, 132, 187, 208, 89, 18, 169, 200, 196, 135, 130, 116, 188, 159, 86, 164, 100, 109, 198, 173, 186, 3, 64, 52, 217, 226, 250, 124, 123, 5, 202, 38, 147, 118, 126, 255, 82, 85, 212, 207, 206, 59, 227, 47, 16, 58, 17, 182, 189, 28, 42, 223, 183, 170, 213, 119, 248, 152, 2, 44, 154, 163, 70, 221, 153, 101, 155, 167, 43, 172, 9, 129, 22, 39, 253, 19, 98, 108, 110, 79, 113, 224, 232, 178, 185, 112, 104, 218, 246, 97, 228, 251, 34, 242, 193, 238, 210, 144, 12, 191, 179, 162, 241, 81, 51, 145, 235, 249, 14, 239, 107, 49, 192, 214, 31, 181, 199, 106, 157, 184, 84, 204, 176, 115, 121, 50, 45, 127, 4, 150, 254, 138, 236, 205, 93, 222, 114, 67, 29, 24, 72, 243, 141, 128, 195, 78, 66, 215, 61, 156, 180];\nh = h.concat(h);\n\nvar hash256 = function (x, y, z) {\n  return h[h[h[x] + y] + z];\n};\n\nvar hashInt = function (x, y, z) {\n  return xor(xor(xor(x * 123) + y * 5678) + z * 1234) & MAX;\n};\n\nvar xor = function (y) {\n  y = y ^ y << 13;\n  y = y ^ y >> 17;\n  return y ^ y << 5;\n};\n\nvar fade = function (t) {\n  return t * t * t * (t * (t * 6 - 15) + 10);\n};\n\nvar fade2 = function (t) {\n  return t * t;\n};\n\nvar grad = function (hash, x, y, z) {\n  switch (hash & 0xf) {\n    case 0x0:\n      return x + y;\n\n    case 0x1:\n      return -x + y;\n\n    case 0x2:\n      return x - y;\n\n    case 0x3:\n      return -x - y;\n\n    case 0x4:\n      return x + z;\n\n    case 0x5:\n      return -x + z;\n\n    case 0x6:\n      return x - z;\n\n    case 0x7:\n      return -x - z;\n\n    case 0x8:\n      return y + z;\n\n    case 0x9:\n      return -y + z;\n\n    case 0xa:\n      return y - z;\n\n    case 0xb:\n      return -y - z;\n\n    case 0xc:\n      return y + x;\n\n    case 0xd:\n      return -y + z;\n\n    case 0xe:\n      return y - x;\n\n    case 0xf:\n      return -y - z;\n\n    default:\n      return 0;\n  }\n};\n\nvar lerp = function (r, a, b) {\n  return a * (1 - r) + b * r;\n};\n\n//# sourceURL=webpack://hdrpaint/./src/lib/noise.js?");

/***/ }),

/***/ "./src/lib/openexr.js":
/*!****************************!*\
  !*** ./src/lib/openexr.js ***!
  \****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ OpenEXR; }\n/* harmony export */ });\n/* harmony import */ var _datastream_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./datastream.js */ \"./src/lib/datastream.js\");\n/* harmony import */ var _zlib_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./zlib.js */ \"./src/lib/zlib.js\");\n\n\nclass OpenEXR {\n  constructor() {}\n\n  static toArrayBuffer(obj) {\n    var channels = obj.attributes.channels;\n    var width = obj.attributes.dataWindow.xMax - obj.attributes.dataWindow.xMin + 1;\n    var height = obj.attributes.dataWindow.yMax - obj.attributes.dataWindow.yMin + 1;\n    var dv = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](height * (8 + 8 + width * 2 * channels.length) + 400); //Magic Number\n\n    dv.setUint32(20000630, true); //Version Field\n\n    dv.setUint16(2, true);\n    dv.setUint16(0, true); //header\n\n    var attributes = obj.attributes;\n    var keys = Object.keys(attributes);\n\n    for (var ai = 0; ai < keys.length; ai++) {\n      var attribute_name = keys[ai];\n      var attribute = attributes[attribute_name];\n      dv.setTextBuf(attribute_name, true);\n      var attribute_type = \"\";\n      var attribute_size_index = 0;\n\n      switch (attribute_name) {\n        case \"channels\":\n          attribute_type = \"chlist\";\n          break;\n\n        case \"compression\":\n          attribute_type = \"compression\";\n          break;\n\n        case \"dataWindow\":\n        case \"displayWindow\":\n          attribute_type = \"box2i\";\n          break;\n\n        case \"lineOrder\":\n          attribute_type = \"lineOrder\";\n          break;\n\n        case \"pixelAspectRatio\":\n          attribute_type = \"float\";\n          break;\n\n        case \"screenWindowCenter\":\n          attribute_type = \"v2f\";\n          break;\n\n        case \"screenWindowWidth\":\n          attribute_type = \"float\";\n          break;\n\n        case \"chromaticities\":\n          attribute_type = \"chromaticities\";\n          break;\n      }\n\n      dv.setTextBuf(attribute_type, true);\n      attribute_size_index = dv.idx;\n      dv.idx += 32;\n\n      if (attribute_type === \"box2i\") {\n        dv.setInt32(attribute.xMin, true);\n        dv.setInt32(attribute.yMin, true);\n        dv.setInt32(attribute.xMax, true);\n        dv.setInt32(attribute.yMax, true);\n      } else if (attribute_type === \"box2f\") {\n        dv.setFloat32(attribute.xMin, true);\n        dv.setFloat32(attribute.yMin, true);\n        dv.setFloat32(attribute.xMax, true);\n        dv.setFloat32(attribute.yMax, true);\n      } else if (attribute_type === \"chlist\") {\n        channels = attribute;\n\n        for (var ci = 0; ci < channels.length; ci++) {\n          var channel = channels[ci];\n          dv.setTextBuf(channel.name, true);\n          dv.setInt32(channel.pixel_type, true); //pixel type\n\n          dv.setUint8(channel.pLiner, true); //pliner\n\n          dv.setUint8(0, true); //reserved\n\n          dv.setUint8(0, true); //reserved\n\n          dv.setUint8(0, true); //reserved\n\n          dv.setInt32(channel.xSampling, true); //xSampling\n\n          dv.setInt32(channel.ySampling, true); //YSampling\n        }\n\n        dv.setTextBuf(\"\", true);\n      } else if (attribute_type === \"compression\") {\n        dv.setUint8(attribute);\n      } else if (attribute_type === \"double\") {\n        dv.setFloat64(attribute, true);\n      } else if (attribute_type === \"float\") {\n        dv.setFloat32(attribute, true);\n      } else if (attribute_type === \"int\") {\n        dv.setInt32(attribute, true);\n      } else if (attribute_type === \"lineOrder\") {\n        dv.getUint8(0, true);\n      } else if (attribute_type === \"string\") {\n        dv.setTextBuf(attribute, true);\n      } else if (attribute_type === \"v2i\") {\n        dv.setInt32(attribute[0], true);\n        dv.setInt32(attribute[1], true);\n      } else if (attribute_type === \"v2f\") {\n        dv.setFloat32(attribute[0], true);\n        dv.setFloat32(attribute[1], true);\n      } else if (attribute_type === \"chromaticities\") {\n        for (var vi = 0; vi < 8; vi++) {\n          dv.setFloat32(attribute[vi], true);\n        }\n      }\n\n      var a = dv.idx;\n      dv.idx = attribute_size_index;\n      dv.setUint32((a - attribute_size_index >> 3) - 4, true);\n      dv.idx = a;\n    }\n\n    dv.setTextBuf(\"\", true);\n    var offset_scan_line_idx = dv.idx;\n    dv.idx += 64 * obj.height;\n    var data_idx = dv.idx;\n    var line_size = obj.width * 2 * channels.length;\n    var linemax = 1;\n\n    if (obj.attributes.compression === 3) {\n      linemax = 16;\n    }\n\n    var data_stream = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](new ArrayBuffer(line_size * linemax));\n\n    for (var li = 0; li < height;) {\n      data_idx = dv.idx;\n      dv.idx = offset_scan_line_idx;\n      dv.setUint64(data_idx >> 3, true);\n      offset_scan_line_idx = dv.idx;\n      dv.idx = data_idx;\n      dv.setUint32(li, true);\n      data_stream.idx = 0;\n      var linemax_ = Math.min(linemax, height - li);\n\n      for (var l = 0; l < linemax_; l++) {\n        var idx = li * width;\n\n        for (var ci = 0; ci < channels.length; ci++) {\n          var channel_data = channels[ci].data;\n\n          for (var xi = 0; xi < width; xi++) {\n            data_stream.setFloat16(channel_data[idx + xi], true);\n          }\n        }\n\n        li++;\n      }\n\n      var data = new Uint8Array(data_stream.dv.buffer, 0, linemax_ * line_size);\n\n      if (obj.attributes.compression) {\n        var offset = data.length >> 1;\n        var data2 = new Uint8Array(data.length);\n\n        for (var di = 0; di < offset; di++) {\n          //上位バイトと下位バイトを分ける\n          data2[di] = data[di << 1];\n          data2[di + offset] = data[(di << 1) + 1];\n        }\n\n        for (var di = data2.length - 1; di > 0; di--) {\n          //差分情報作成\n          data2[di] = data2[di] - data2[di - 1] + 128 & 0xff;\n        }\n\n        data = _zlib_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].compress(data2, 1);\n      }\n\n      dv.setUint32(data.length, true);\n      dv.setBytes(data);\n    }\n\n    return dv.byteBuffer.buffer.slice(0, dv.idx >> 3);\n  }\n\n  static fromArrayBuffer(obj, arrayBuffer) {\n    var dv = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](arrayBuffer); //Magic Number\n\n    var c = dv.getUint32(true);\n\n    if (c !== 20000630) {\n      alert(\"exrファイルのマジックナンバーと違う\");\n      return;\n    } //Version Field\n\n\n    c = dv.getUint16(true); //if(c !== 2){\n    //\talert(\"SIngle-part scan line 以外は対応してません\");\n    //\treturn;\n    //}\n\n    var cc = dv.getUint16(true); //dv.idx+=2<<3;\n    //header\n\n    var attributes = [];\n\n    while (1) {\n      var attribute_name = dv.readTextBuf();\n\n      if (attribute_name === \"\") {\n        //空文字ならヘッダー終了\n        break;\n      }\n\n      var attribute_type = dv.readTextBuf();\n      var value = null;\n      var attribute_size = dv.getUint32(true);\n      var idxOld = dv.idx;\n\n      if (attribute_type === \"box2i\") {\n        value = {};\n        value.xMin = dv.getInt32(true);\n        value.yMin = dv.getInt32(true);\n        value.xMax = dv.getInt32(true);\n        value.yMax = dv.getInt32(true);\n      } else if (attribute_type === \"box2f\") {\n        value = {};\n        value.xMin = dv.getFloat32(true);\n        value.yMin = dv.getFloat32(true);\n        value.xMax = dv.getFloat32(true);\n        value.yMax = dv.getFloat32(true);\n      } else if (attribute_type === \"chlist\") {\n        value = [];\n\n        while (1) {\n          var ch = [];\n          ch.name = dv.readTextBuf();\n\n          if (ch.name === \"\") {\n            break;\n          }\n\n          ch.pixel_type = dv.getInt32(true);\n          ch.pLinear = dv.getUint8(true);\n          ch.reserved = dv.getUint8(true);\n          dv.idx += 2 << 3;\n          ch.xSampling = dv.getInt32(true);\n          ch.ySampling = dv.getInt32(true);\n          value.push(ch);\n        }\n      } else if (attribute_type === \"compression\") {\n        value = dv.getUint8(true);\n      } else if (attribute_type === \"double\") {\n        value = dv.getFloat64(true);\n      } else if (attribute_type === \"float\") {\n        value = dv.getFloat32(true);\n      } else if (attribute_type === \"int\") {\n        value = dv.getInt32(true);\n      } else if (attribute_type === \"lineOrder\") {\n        value = dv.getUint8(true);\n      } else if (attribute_type === \"string\") {\n        value = \"\";\n\n        for (var i = 0; i < attribute_size; i++) {\n          value += String.fromCharCode(dv.getUint8(true));\n        } //\t\t\tidx+=value.length+1;\n\n      } else if (attribute_type === \"v2i\") {\n        value = [];\n        value.push(dv.getInt32(true));\n        value.push(dv.getInt32(true));\n      } else if (attribute_type === \"v2f\") {\n        value = [];\n        value.push(dv.getFloat32(true));\n        value.push(dv.getFloat32(true));\n      } else if (attribute_type === \"chromaticities\") {\n        value = [];\n\n        for (var vi = 0; vi < 8; vi++) {\n          value.push(dv.getFloat32(true));\n        }\n      }\n\n      attributes[attribute_name] = value;\n      dv.idx = idxOld + (attribute_size << 3);\n    } //データ部\n\n\n    var channels = attributes.channels;\n    obj.width = attributes.dataWindow.xMax - attributes.dataWindow.xMin + 1;\n    obj.height = attributes.dataWindow.yMax - attributes.dataWindow.yMin + 1;\n    var datasize = obj.width * obj.height; //メモリ確保\n\n    for (var i = 0; i < channels.length; i++) {\n      var channel = channels[i];\n\n      if (channel.pixel_type === 0) {\n        channel.data = new Uint8Array(datasize);\n      }\n\n      if (channel.pixel_type === 1) {\n        channel.data = new Float32Array(datasize);\n      }\n\n      if (channel.pixel_type === 2) {\n        channel.data = new Float32Array(datasize);\n      }\n    } //ライン読み込み\n\n\n    for (var i = 0; i < obj.height; i++) {\n      var offset = dv.getUint64(true);\n      var oldIdx = dv.idx;\n      dv.idx = offset << 3;\n      var y = dv.getUint32(true);\n      var pixel_data_size = dv.getUint32(true);\n      var linedata;\n      var linemax = 1;\n\n      if (attributes.compression === 0) {\n        linedata = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](dv.dv.buffer, dv.idx >> 3, pixel_data_size);\n      }\n\n      if (attributes.compression === 2 || attributes.compression === 3) {\n        //zip展開\n        var data = _zlib_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].expand(dv.dv.buffer, dv.idx >> 3, pixel_data_size);\n      }\n\n      if (attributes.compression === 3) {\n        linemax = Math.min(obj.height - y, 16); //compression=3のときは16行固定\n      }\n\n      if (attributes.compression === 3 || attributes.compression === 2) {\n        //zip圧縮されていた場合はデータが加工されているので復元\n        var data2 = new Uint8Array(data.length);\n\n        for (var di = 1; di < data.length; di++) {\n          //差分情報から実際の値を復元\n          data[di] = data[di - 1] - 128 + data[di] & 0xff;\n        }\n\n        var offset = data.length >> 1;\n\n        for (var di = 0; di < offset; di++) {\n          //上位バイトと下位バイトをくっつける\n          data2[di << 1] = data[di];\n          data2[(di << 1) + 1] = data[di + offset];\n        }\n\n        linedata = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](data2.buffer);\n      }\n\n      for (var line = 0; line < linemax; line++) {\n        for (var ci = 0; ci < channels.length; ci++) {\n          var channel = channels[ci];\n          var data = channel.data;\n          var didx = (y + line) * obj.width;\n\n          if (channel.pixel_type == 0) {\n            for (var xi = 0; xi < obj.width; xi++) {\n              channel.data[didx + xi] = linedata.getUint8(true);\n            }\n          } else if (channel.pixel_type == 1) {\n            for (var xi = 0; xi < obj.width; xi++) {\n              channel.data[didx + xi] = linedata.readFloat16(true);\n            }\n          } else if (channel.pixel_type == 2) {\n            for (var xi = 0; xi < obj.width; xi++) {\n              channel.data[didx + xi] = linedata.getFloat32(true);\n            }\n          }\n        }\n      }\n\n      dv.idx = oldIdx;\n      i += linemax - 1;\n    }\n\n    obj.attributes = attributes;\n  }\n\n}\n\n//# sourceURL=webpack://hdrpaint/./src/lib/openexr.js?");

/***/ }),

/***/ "./src/lib/slider.js":
/*!***************************!*\
  !*** ./src/lib/slider.js ***!
  \***************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Slider; }\n/* harmony export */ });\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"./src/lib/util.js\");\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\nvar drag_target = null; //ドラッグ時処理\n\nvar drag = function (evt) {\n  if (!evt) {\n    evt = window.event;\n  }\n\n  if (!(evt.buttons & 1)) {\n    drag_target = null;\n  }\n\n  if (!drag_target) {\n    return;\n  }\n\n  var slider = drag_target;\n  var tumami = drag_target.tumami;\n  var mizo = slider.mizo;\n  var left = evt.clientX;\n  var rect = mizo.getBoundingClientRect();\n  var width = tumami.offsetWidth / 2 * 0;\n  var value = Math.round(left - rect.left - width);\n  value /= mizo.clientWidth;\n  value = Math.max(Math.min(value, 1), 0);\n  value = value * (slider.max - slider.min) + slider.min;\n\n  if (slider.step) {\n    value = Math.ceil(value / slider.step) * slider.step;\n  }\n\n  slider.input.value = value;\n  slider.setTumami();\n  _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].fireEvent(slider.input, \"change\");\n  return false;\n};\n\nvar createDiv = function (slider) {\n  return div;\n};\n\nvar replace = function (node, slider) {\n  //対象のノードオブジェクトをスライダに置き換える\n  node.parentNode.replaceChild(slider.node, node); //node.setAttribute(\"class\",\"js-text\");\n\n  node.classList.remove(\"slider\");\n  node.setAttribute(\"number\", \"\");\n  node.setAttribute(\"type\", \"text\");\n  slider.node.replaceChild(node, slider.input);\n  slider.input = node;\n  node.addEventListener(\"input\", slider.changeValue); //input.id=node.id;\n\n  slider.min = Number(node.getAttribute(\"min\"));\n  slider.max = Number(node.getAttribute(\"max\"));\n\n  if (slider.min === slider.max) {\n    slider.max = slider.min + 1;\n  }\n\n  slider.step = Number(node.getAttribute(\"step\"));\n  slider.setTumami();\n};\n\nclass Slider {\n  //スライダーコントロール\n  constructor() {\n    _defineProperty(this, \"setTumami\", () => {\n      var slider = this;\n      var tumami = this.tumami;\n      var mizo = this.mizo;\n      var value = Number(this.input.value);\n      value = (value - slider.min) / (slider.max - slider.min);\n      var max = mizo.offsetWidth;\n      var w = tumami.offsetWidth;\n      if (w == 0) w = 15;\n      if (max == 0) max = 100;\n      tumami.style.left = value * max - w / 2 + 'px';\n    });\n\n    _defineProperty(this, \"changeValue\", () => {\n      this.setTumami();\n    });\n\n    this.min = 0;\n    this.max = 1;\n    this.step = 0.1; //テキストエリア+スライダー\n\n    var div = document.createElement(\"span\");\n    div.setAttribute(\"class\", \"js-slider\");\n    div.insertAdjacentHTML('beforeend', `<input type=\"text\"  class=\"js-text\">\n\t\t\t\t<div class=\"js-slider3\">\n\t\t\t\t\t<span class=\"js-slider2\" ></span>\n\t\t\t\t\t<input type=\"button\"  class=\"tumami\">\n\t\t\t\t</div> `);\n    this.input = div.querySelector('.js-text'); //溝\n\n    this.mizo = div.querySelector('.js-slider3'); //クリック時ツマミ移動\n\n    this.mizo.addEventListener(\"pointerdown\", evt => {\n      drag_target = this;\n      drag(evt);\n      drag_target = null;\n    });\n\n    var _tumami = div.querySelector('.tumami');\n\n    this.tumami = _tumami; //ドラッグ開始\n\n    _tumami.addEventListener(\"pointerdown\", evt => {\n      drag_target = this;\n      evt.stopPropagation();\n    }); //デフォルト処理無効\n\n\n    _tumami.addEventListener(\"touchmove\", function (evt) {\n      evt.preventDefault();\n    }); //値直接変更時にツマミ反映\n\n\n    this.node = div;\n    this.setTumami();\n  }\n\n}\n\n_defineProperty(Slider, \"init\", function (dom) {\n  if (!dom) {\n    dom = document;\n  }\n\n  var e = dom.querySelectorAll('input.slider');\n\n  for (var i = 0; i < e.length; i += 1) {\n    var node = e[i];\n    var slider = new Slider();\n    replace(node, slider);\n  }\n});\n\nwindow.addEventListener(\"pointermove\", drag);\nwindow.addEventListener(\"load\", function (e) {\n  Slider.init();\n});\n\n//# sourceURL=webpack://hdrpaint/./src/lib/slider.js?");

/***/ }),

/***/ "./src/lib/util.js":
/*!*************************!*\
  !*** ./src/lib/util.js ***!
  \*************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Util; }\n/* harmony export */ });\n\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nwindow.globalParam = {};\nvar myIE = document.all; //IEflg\n\nvar ua = window.navigator.userAgent.toLowerCase();\n\nif (ua.indexOf(\"windows\" !== -1)) {\n  globalParam.windows = 1;\n}\n\nvar loadingCount = 0,\n    imagedatacanvas,\n    imagedatacontext,\n    fps = 30,\n    spf = 0,\n    nextsleep = 0,\n    fpserror = 0,\n    fpserrordelta = 0,\n    mainfunc,\n    SCREEN_W,\n    SCREEN_H;\nvar i = 0,\n    keymap = new Array(256);\nkeymap[37] = i++;\nkeymap[38] = i++;\nkeymap[39] = i++;\nkeymap[40] = i++;\nkeymap[' '.charCodeAt(0)] = i++;\nkeymap['X'.charCodeAt(0)] = i++;\nkeymap['C'.charCodeAt(0)] = i++;\nkeymap['V'.charCodeAt(0)] = i++;\nkeymap['A'.charCodeAt(0)] = i++;\nkeymap['W'.charCodeAt(0)] = i++;\nkeymap['D'.charCodeAt(0)] = i++;\nkeymap['S'.charCodeAt(0)] = i++;\nkeymap['F'.charCodeAt(0)] = i++;\nkeymap['G'.charCodeAt(0)] = i++;\nkeymap['H'.charCodeAt(0)] = i++;\nkeymap['J'.charCodeAt(0)] = i++;\nvar virtualPad = null;\nvar virtualPadP = null;\nvar virtualBtn = null;\nclass Util {\n  static getLoadingCount() {\n    return loadingCount;\n  }\n\n  static mainloop() {\n    var dx, dy;\n    Util.tap = 0;\n\n    if (Util.pressOn) {\n      Util.pressCount = Util.pressCount + 1;\n\n      if (Util.pressCount == 1) {\n        Util.oldcursorX2 = Util.cursorX;\n        Util.oldcursorY2 = Util.cursorY;\n        Util.oldcursorX = Util.cursorX;\n        Util.oldcursorY = Util.cursorY;\n      }\n    } else if (Util.pressCount > 0) {\n      dx = Util.cursorX - Util.oldcursorX2;\n      dy = Util.cursorY - Util.oldcursorY2;\n\n      if (Util.pressCount < 10 && dx * dx + dy * dy < 16) {\n        Util.tap = 1;\n      }\n\n      Util.pressCount = -1;\n    } else Util.pressCount = 0;\n\n    if (Util.pressOnRight) {\n      Util.pressCountRight += 1;\n    } else {\n      Util.pressCountRight = 0;\n    }\n\n    if (loadingCount == 0) {\n      mainfunc();\n    }\n\n    Util.oldcursorX = Util.cursorX;\n    Util.oldcursorY = Util.cursorY;\n    var i;\n\n    for (i = Util.keyflag.length; i--;) {\n      Util.keyflagOld[i] = Util.keyflag[i];\n    }\n  }\n\n  static loadImage(url, norepeat, func) {\n    var image = new Image();\n    var flg = true;\n    if (globalParam.files) for (var i = 0, f; f = globalParam.files[i]; i++) {\n      if (escape(f.name) == url) {\n        //ローカルファイルの場合\n        var reader = new FileReader();\n\n        reader.onload = function (e) {\n          image.src = e.target.result;\n        };\n\n        reader.readAsDataURL(f);\n        flg = false;\n        break;\n      }\n    }\n\n    if (flg) {\n      //リモートファイルの場合\n      image.src = url;\n    } //ロードカウンタを増やす\n\n\n    loadingCount++;\n\n    image.onerror = function () {\n      //エラーの場合減らす\n      loadingCount--;\n    };\n\n    console.log(\"load start\", url); //読み込みが終わっていない場合はイベントリスナ登録\n\n    image.addEventListener(\"load\", function (e) {\n      if (!image.pat) {\n        console.log(\"load end\", image); //ロード処理(1回のみ)\n        //ロードカウンタを減らす\n\n        loadingCount--;\n\n        if (norepeat) {\n          image.pat = Util.ctx.createPattern(image, \"no-repeat\");\n        } else {\n          image.pat = Util.ctx.createPattern(image, \"repeat\");\n        }\n\n        imagedatacontext.clearRect(0, 0, imagedatacanvas.width, imagedatacanvas.height);\n        imagedatacontext.drawImage(image, 0, 0);\n\n        if (imagedatacontext.getImageData) {\n          image.imagedata = imagedatacontext.getImageData(0, 0, image.width, image.height);\n        }\n      }\n\n      if (func) {\n        //コールバック指定がある場合は行う\n        func(image);\n      }\n    });\n    return image;\n  }\n\n  static loadText(url, callback) {\n    var flg = true;\n    var filename_ex = url.match(\"([^/]+?)([\\?#;].*)?$\")[1];\n\n    if (globalParam.files) {\n      for (var i = 0, f; f = globalParam.files[i]; i++) {\n        if (escape(f.name) == filename_ex) {\n          var reader = new FileReader();\n\n          reader.onload = function (e) {\n            var buf = e.target.result;\n\n            if (callback) {\n              callback(buf);\n            }\n          };\n\n          reader.readAsText(f);\n          flg = false;\n          break;\n        }\n      }\n    }\n\n    if (flg) {\n      var request = Util.createXMLHttpRequest();\n      request.open(\"GET\", url, true);\n\n      request.onload = function (e) {\n        if (request.status == 200 || request.status == 304) {\n          var buf = request.responseText;\n\n          if (callback) {\n            callback(buf);\n          }\n        }\n\n        loadingCount--;\n        console.log(\"loadtext end\", loadingCount);\n      };\n\n      console.log(\"loadtext start\", url);\n      loadingCount++;\n      request.send(\"\");\n    }\n\n    return null;\n  }\n\n  static loadFile(file, callback) {\n    var reader = new FileReader();\n\n    reader.onload = function (e) {\n      if (callback) {\n        callback(e.target.result);\n      }\n    };\n\n    reader.readAsDataURL(file);\n  }\n\n  static loadBinary(url, _callback) {\n    if (typeof url !== \"string\") {\n      Util.loadFile(url, function (url) {\n        Util.loadBinary(url, _callback);\n      });\n      return null;\n    }\n\n    var callback = _callback;\n\n    var cfunc = function (buf) {\n      if (callback) {\n        callback(buf);\n      }\n\n      loadingCount--;\n      console.log(\"loadbinary end\", loadingCount);\n    };\n\n    console.log(\"loadbinary start\");\n    loadingCount++;\n    var request = Util.createXMLHttpRequest();\n    request.open(\"GET\", url, true);\n    request.responseType = \"arraybuffer\";\n\n    request.onload = function (e) {\n      cfunc(request.response);\n    };\n\n    request.send(\"\");\n  }\n\n  static rgb(r, g, b) {\n    r = (0x100 | r * 255).toString(16);\n    g = (0x100 | g * 255).toString(16);\n    b = (0x100 | b * 255).toString(16);\n    return \"#\" + r.slice(-2) + g.slice(-2) + b.slice(-2);\n  }\n\n  static hex2rgb(rgb, hex) {\n    hex = hex + \"000000\";\n    rgb[0] = parseInt(hex.slice(0, 2), 16) / 255;\n    rgb[1] = parseInt(hex.slice(2, 4), 16) / 255;\n    rgb[2] = parseInt(hex.slice(4, 6), 16) / 255;\n    return rgb;\n  }\n\n  static str2rgba(rgba, str) {\n    var sp = str.split(\",\");\n    rgba[0] = Number(sp[0]);\n    rgba[1] = Number(sp[1]);\n    rgba[2] = Number(sp[2]);\n    rgba[3] = Number(sp[3]);\n    return rgba;\n  }\n\n  static rgba(r, g, b, a) {\n    return 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';\n  }\n\n  static hsv2rgb(rgb, hsv) {\n    //hsvをrgbに変換\n    var f;\n    var i, p, q, t;\n    var v = hsv[2];\n    var h = hsv[0];\n    var s = hsv[1];\n    i = (h * 6 | 0) % 6;\n    f = h * 6 - (h * 6 | 0);\n    p = v * (1.0 - s);\n    q = v * (1.0 - s * f);\n    t = v * (1.0 - s * (1.0 - f));\n\n    switch (i) {\n      case 0:\n        rgb[0] = v;\n        rgb[1] = t;\n        rgb[2] = p;\n        break;\n\n      case 1:\n        rgb[0] = q;\n        rgb[1] = v;\n        rgb[2] = p;\n        break;\n\n      case 2:\n        rgb[0] = p;\n        rgb[1] = v;\n        rgb[2] = t;\n        break;\n\n      case 3:\n        rgb[0] = p;\n        rgb[1] = q;\n        rgb[2] = v;\n        break;\n\n      case 4:\n        rgb[0] = t;\n        rgb[1] = p;\n        rgb[2] = v;\n        break;\n\n      case 5:\n        rgb[0] = v;\n        rgb[1] = p;\n        rgb[2] = q;\n        break;\n    }\n\n    return rgb;\n  }\n\n  static rgb2hsv(hsv, rgb) {\n    //rgbをhsvに変換\n    var max = Math.max(rgb[0], Math.max(rgb[1], rgb[2]));\n    var min = Math.min(rgb[0], Math.min(rgb[1], rgb[2]));\n\n    if (max == min) {\n      hsv[0] = 0;\n    } else if (max == rgb[0]) {\n      hsv[0] = 1 / 6 * (rgb[1] - rgb[2]) / (max - min) + 1;\n    } else if (max == rgb[1]) {\n      hsv[0] = 1 / 6 * (rgb[2] - rgb[0]) / (max - min) + 2 / 6;\n    } else if (max == rgb[2]) {\n      hsv[0] = 1 / 6 * (rgb[0] - rgb[1]) / (max - min) + 4 / 6;\n    }\n\n    hsv[0] -= hsv[0] | 0;\n\n    if (max == 0) {\n      hsv[1] = 0;\n    } else {\n      hsv[1] = (max - min) / max;\n    }\n\n    hsv[2] = max;\n    return hsv;\n  }\n\n  static init(canvas, canvasgl, _inputarea) {\n    Util.canvasgl = canvasgl;\n    Util.canvas = canvas;\n\n    if (!Util.canvas || !Util.canvas.getContext) {\n      return false;\n    }\n\n    SCREEN_W = Util.canvas.getAttribute('width');\n    SCREEN_H = Util.canvas.getAttribute('height');\n    Util.ctx = Util.canvas.getContext('2d');\n    Util.ctx.clearRect(0, 0, SCREEN_W, SCREEN_H);\n    imagedatacanvas = Util.createCanvas(1024, 1024);\n    imagedatacontext = imagedatacanvas.getContext('2d');\n    var inputarea = _inputarea;\n\n    if (inputarea) {\n      inputarea.onselect = function () {\n        return false;\n      };\n\n      inputarea.onselectstart = function () {\n        return false;\n      };\n    }\n\n    var setCursor = function (x, y) {\n      var target = Util.canvasgl;\n      var scalex = target.width / target.clientWidth;\n      var scaley = target.height / target.clientHeight;\n      Util.cursorX = (x - target.offsetLeft) * scalex;\n      Util.cursorY = (y - target.offsetTop) * scaley;\n    };\n\n    var tap = function () {};\n\n    var tapout = function () {\n      Util.padX = 0;\n      Util.padY = 0;\n      virtualPad.style.display = \"none\";\n    };\n\n    var rela = function (e) {\n      if (e.currentTarget.getBoundingClientRect) {\n        var rect = e.currentTarget.getBoundingClientRect();\n        e.relativeX = e.clientX - rect.left;\n        e.relativeY = e.clientY - rect.top;\n      }\n    };\n\n    var relo = function (e, t) {\n      e.pageX = t.pageX;\n      e.pageY = t.pageY;\n      e.layerX = t.layerX;\n      e.layerY = t.layerY;\n      e.clientX = t.clientX;\n      e.clientY = t.clientY;\n    };\n\n    Util.mouseMove = function (elem, func) {\n      if (!elem) return;\n\n      if (navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/Android/i)) {\n        elem.addEventListener(\"touchmove\", function (e) {\n          relo(e, e.touches[0]);\n          rela(e);\n          func(e);\n        });\n      } else {\n        elem.addEventListener(\"mousemove\", function (e) {\n          e = e || window.event;\n          rela(e);\n          func(e);\n        }, false);\n      }\n    };\n\n    Util.mouseDown = function (elem, func) {\n      if (!elem) return;\n\n      if (navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/Android/i)) {\n        elem.addEventListener(\"touchstart\", function (e) {\n          relo(e, e.touches[0]);\n          rela(e);\n          e.button = 0;\n          func(e);\n        });\n      } else {\n        elem.addEventListener(\"mousedown\", function (e) {\n          e = e || window.event;\n          rela(e);\n          func(e);\n        });\n      }\n    };\n\n    Util.mouseUp = function (elem, func) {\n      if (navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/Android/i)) {\n        elem.addEventListener(\"touchend\", function (e) {\n          relo(e, e.changedTouches[0]);\n          rela(e);\n          e.button = 0;\n          func(e);\n        });\n      } else {\n        elem.addEventListener(\"mouseup\", function (e) {\n          e = e || window.event;\n          rela(e);\n          func(e);\n        });\n      }\n    };\n\n    Util.mouseMove(inputarea, function (e) {\n      setCursor(e.pageX, e.pageY);\n\n      if (virtualPad.style.display === \"block\") {\n        var target = e.currentTarget;\n        Util.padX = (e.relativeX - virtualPad.offsetLeft) / virtualPad.offsetWidth * 2 - 1;\n        Util.padY = (e.relativeY - virtualPad.offsetTop) / virtualPad.offsetHeight * 2 - 1;\n        var l = Util.padX * Util.padX + Util.padY * Util.padY;\n\n        if (l > 1.0) {\n          l = Math.sqrt(l);\n          Util.padX = Util.padX / l;\n          Util.padY = Util.padY / l;\n          virtualPad.style.left = e.relativeX - Util.padX * virtualPad.offsetWidth * 0.5 + \"px\";\n          virtualPad.style.top = e.relativeY - Util.padY * virtualPad.offsetHeight * 0.5 + \"px\";\n        }\n\n        setPad();\n      }\n    });\n    Util.mouseDown(inputarea, function (e) {\n      setCursor(e.pageX, e.pageY);\n\n      switch (e.button) {\n        case 0:\n          Util.pressOn = 1;\n          break;\n\n        case 2:\n          Util.pressOnRight = 1;\n          break;\n      }\n    });\n    Util.mouseUp(window, function (e) {\n      setCursor(e.pageX, e.pageY);\n\n      switch (e.button) {\n        case 0:\n          Util.pressOn = 0;\n          tapout();\n          break;\n\n        case 2:\n          Util.pressOnRight = 0;\n          break;\n      }\n\n      Util.keyflag[4] = 0;\n    }); //バーチャルパッド\n\n    var setPad = function () {\n      virtualPadP.style.left = (Util.padX + 1.0) * 50 + \"%\";\n      virtualPadP.style.top = (Util.padY + 1.0) * 50 + \"%\";\n    };\n\n    var varea = document.getElementById(\"vertualPadArea\");\n    Util.mouseDown(varea, function (e) {\n      switch (e.button) {\n        case 0:\n          virtualPad.style.display = \"block\";\n          Util.padX = 0;\n          Util.padY = 0;\n          virtualPad.style.left = e.relativeX + \"px\";\n          virtualPad.style.top = e.relativeY + \"px\";\n          setPad();\n          e.stopPropagation();\n          break;\n      }\n    });\n\n    if (navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/Android/i)) {} else {\n      var wheelfunc = function (e) {\n        e = e || window.event;\n\n        if (e.wheelDelta) {\n          Util.wheelDelta = e.wheelDelta / 120;\n          if (window.opera) Util.wheelDelta = -Util.wheelDelta;\n        } else if (e.detail) {\n          Util.wheelDelta = -e.detail / 3;\n        }\n\n        if (e.preventDefault) e.preventDefault(); //e.returnValue = false\n      };\n\n      if (window.addEventListener) window.addEventListener('DOMMouseScroll', wheelfunc, {\n        passive: true\n      });else if (document.attachEvent) document.attachEvent('onmousewheel', wheelfunc);else if (inputarea) inputarea.onmousewheel = wheelfunc;\n\n      document.body.onkeydown = function (e) {\n        e = e || window.event;\n        var code = e.keyCode;\n\n        if (Util.keymap[code] != null) {\n          Util.keyflag[Util.keymap[code]] = 1;\n        }\n\n        if (code == 13) {\n          Util.canvasgl.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);\n\n          if (window.parent.screen.width / Util.canvasgl.width > window.parent.screen.height / Util.canvasgl.height) {\n            canvasgl.style.width = \"auto\";\n            canvasgl.style.height = \"100%\";\n          } else {\n            canvasgl.style.width = \"100%\";\n            canvasgl.style.height = \"auto\";\n          }\n        }\n      };\n\n      document.body.onkeyup = function (e) {\n        e = e || window.event;\n        var code = e.keyCode;\n\n        if (Util.keymap[code] != null) {\n          Util.keyflag[Util.keymap[code]] = 0;\n        }\n      };\n\n      document.body.onblur = function (e) {\n        e = e || window.event;\n        var code = e.keyCode;\n\n        for (var i = 0; i < Util.keyflag.length; i++) {\n          Util.keyflag[i] = 0;\n        }\n      };\n    }\n\n    virtualPad = document.createElement(\"div\");\n    virtualPad.style.backgroundColor = \"#ff0000\";\n    virtualPad.style.opacity = \"0.3\";\n    virtualPad.style.width = \"256px\";\n    virtualPad.style.height = \"256px\";\n    virtualPad.style.position = \"absolute\";\n    virtualPad.style.left = \"10px\";\n    virtualPad.style.top = \"10px\";\n    virtualPad.style.borderRadius = \"50%\";\n    virtualPad.style.zIndex = \"10\";\n    virtualPad.style.display = \"none\";\n    virtualPad.style.marginLeft = \"-128px\";\n    virtualPad.style.marginTop = \"-128px\";\n    if (inputarea) inputarea.appendChild(virtualPad);\n    virtualPadP = document.createElement(\"div\");\n    virtualPadP.style.backgroundColor = \"#00ff00\";\n    virtualPadP.style.width = \"32px\";\n    virtualPadP.style.height = \"32px\";\n    virtualPadP.style.position = \"absolute\";\n    virtualPadP.style.borderRadius = \"50%\";\n    virtualPadP.style.marginLeft = \"-16px\";\n    virtualPadP.style.marginTop = \"-16px\";\n    virtualPad.appendChild(virtualPadP);\n    virtualBtn = document.createElement(\"div\");\n    virtualBtn.style.backgroundColor = \"#0000ff\";\n    virtualBtn.style.opacity = \"0.25\";\n    virtualBtn.style.width = \"256px\";\n    virtualBtn.style.height = \"256px\";\n    virtualBtn.style.position = \"absolute\";\n    virtualBtn.style.right = \"10%\";\n    virtualBtn.style.bottom = \"20%\";\n    virtualBtn.style.borderRadius = \"50%\";\n    virtualBtn.style.zIndex = \"100\";\n    virtualBtn.style.display = \"none\";\n    virtualBtn.innerHTML = \"jump\";\n    if (inputarea) inputarea.appendChild(virtualBtn);\n\n    if (Util.enableVirtualBtn) {\n      virtualBtn.style.display = \"inline\";\n    }\n\n    if (navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/Android/i)) {\n      virtualBtn.addEventListener(\"touchstart\", function (e) {\n        e = e || window.event;\n        Util.keyflag[4] = 1;\n      }, false);\n      window.addEventListener(\"touchend\", function (e) {\n        e = e || window.event;\n        Util.keyflag[4] = 0;\n      }, false);\n      virtualBtn.addEventListener(\"touchmove\", function (e) {}, false);\n      virtualBtn.addEventListener(\"touchend\", function (e) {\n        Util.keyflag[4] = 0;\n      }, false);\n    } else {\n      virtualBtn.onmousedown = function (e) {\n        e = e || window.event;\n        Util.keyflag[4] = 1; //e.stopPropagation();\n      };\n\n      virtualBtn.onmouseup = function (e) {\n        e = e || window.event;\n        Util.keyflag[4] = 0;\n      };\n    }\n  }\n\n  static setFps(argfps, mf) {\n    fps = argfps | 0;\n    spf = 1000 / fps | 0;\n    fpserror = 0;\n    fpserrordelta = 1000 % fps;\n    nextsleep = performance.now(); //Date.now();\n\n    mainfunc = mf;\n    Util.pressCount = 0;\n  }\n\n  static drawText(target, x, y, text, img, sizex, sizey) {\n    var dx = x;\n    var dy = y;\n    var i, max;\n    var sx, sy;\n\n    for (i = 0, max = text.length; i < max; i++) {\n      sx = text.charCodeAt(i) - 32;\n      sy = (sx >> 4) * sizex;\n      sx = (sx & 0xf) * sizey;\n      target.drawImage(img, sx, sy, sizex, sizey, dx, dy, sizex, sizey);\n      dx = dx + sizex;\n    }\n  }\n\n  static convertURLcode(str) {\n    var imax = str.length,\n        jmax,\n        i,\n        j,\n        charcode,\n        percent = '%'.charCodeAt(0),\n        decode = \"\",\n        sub;\n\n    for (i = 0; i < imax; i++) {\n      charcode = str.charCodeAt(i);\n\n      if (charcode == percent) {\n        i++;\n        charcode = parseInt(str.slice(i, i + 2), 16);\n\n        if ((charcode & 0xF0) == 0xE0) {\n          jmax = 2;\n          charcode = charcode & 0xf;\n        } else if ((charcode & 0xE0) == 0xC0) {\n          jmax = 1;\n          charcode = charcode & 0x1f;\n        } else {\n          jmax = 0;\n        }\n\n        i += 1;\n\n        for (j = 0; j < jmax; j++) {\n          i += 2;\n          charcode <<= 6;\n          charcode |= parseInt(str.slice(i, i + 2), 16) & 0x3f;\n          i += 1;\n        }\n      }\n\n      decode += String.fromCharCode(charcode);\n    }\n\n    return decode;\n  }\n\n  static fireEvent(elem, eventname, evt) {\n    if (document.all) {\n      elem.fireEvent(\"on\" + eventname);\n    } else {\n      if (!evt) {\n        evt = document.createEvent(\"Event\");\n      }\n\n      evt.initEvent(eventname, true, true);\n      elem.dispatchEvent(evt);\n    }\n  }\n\n  static setText(elem, text) {\n    elem.innerText = text; //elem.textContent=text;\n    //elem.innerHTML=text;\n  }\n\n  static getText(elem) {\n    return elem.textContent ? elem.textContent : elem.innerText;\n  }\n\n  static getLoadingCount() {\n    return loadingCount;\n  }\n\n  static stringToUtf8(str) {\n    var utf8str = unescape(encodeURIComponent(str));\n    var utf8array = new Uint8Array(utf8str.length);\n\n    for (var i = 0; i < utf8str.length; i++) {\n      utf8array[i] = utf8str.charCodeAt(i);\n    }\n\n    return utf8array;\n  }\n\n  static utf8ToString(array) {\n    var str = \"\";\n\n    for (var i = 0; i < array.length; i++) {\n      str += String.fromCharCode(array[i]);\n    }\n\n    return decodeURIComponent(escape(str));\n  }\n\n}\n\n_defineProperty(Util, \"ctx\", null);\n\n_defineProperty(Util, \"canvas\", null);\n\n_defineProperty(Util, \"canvasgl\", null);\n\n_defineProperty(Util, \"cursorX\", 0);\n\n_defineProperty(Util, \"cursorY\", 0);\n\n_defineProperty(Util, \"padX\", 0);\n\n_defineProperty(Util, \"padY\", 0);\n\n_defineProperty(Util, \"wheelDelta\", 0);\n\n_defineProperty(Util, \"pressOn\", 0);\n\n_defineProperty(Util, \"pressCount\", 0);\n\n_defineProperty(Util, \"pressOnRight\", 0);\n\n_defineProperty(Util, \"pressCountRight\", 0);\n\n_defineProperty(Util, \"oldcursorX\", 0);\n\n_defineProperty(Util, \"oldcursorY\", 0);\n\n_defineProperty(Util, \"screenscale\", 1);\n\n_defineProperty(Util, \"tap\", 0);\n\n_defineProperty(Util, \"keyflag\", [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);\n\n_defineProperty(Util, \"keyflagOld\", [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);\n\n_defineProperty(Util, \"keymap\", keymap);\n\n_defineProperty(Util, \"enablePad\", 1);\n\n_defineProperty(Util, \"createCanvas\", function (width, height) {\n  var canvas = document.createElement(\"canvas\");\n\n  if (typeof G_vmlCanvasManager !== 'undefined') {\n    canvas = G_vmlCanvasManager.initElement(canvas);\n  }\n\n  canvas.setAttribute('width', width);\n  canvas.setAttribute('height', height);\n  return canvas;\n});\n\n_defineProperty(Util, \"createXMLHttpRequest\", function () {\n  if (window.XMLHttpRequest) {\n    return new XMLHttpRequest();\n  } else if (window.ActiveXObject) {\n    try {\n      return new ActiveXObject(\"Msxml2.XMLHTTP\");\n    } catch (e) {\n      try {\n        return new ActiveXObject(\"Microsoft.XMLHTTP\");\n      } catch (e2) {\n        return null;\n      }\n    }\n  } else {\n    return null;\n  }\n});\n\n_defineProperty(Util, \"fpsman\", function () {\n  var nowTime = performance.now(); //Date.now();\n\n  var dt = nextsleep - nowTime; //\t\tif(0<dt>>1){\n  //\t\t\tsetTimeout(fpsman,dt>>1);\n  //\t\t\treturn;\n  //\t\t}\n  //端数処理\n\n  fpserror += fpserrordelta;\n  if (dt > spf) dt = spf;\n  if (dt < -spf) dt = -spf;\n\n  if (fpserror >= fps) {\n    //時間誤差が1msを超えたら次回1ms増やす\n    fpserror -= fps;\n    dt += 1;\n  }\n\n  nextsleep = nowTime + spf + dt;\n  Util.mainloop();\n  nowTime = performance.now(); //Date.now();\n\n  dt = nextsleep - nowTime;\n  if (dt <= 0) dt = 1;\n  setTimeout(Util.fpsman, dt);\n});\n\n_defineProperty(Util, \"getCurrent\", function () {\n  var current = \"/\";\n\n  if (document.currentScript) {\n    current = document.currentScript.src;\n  } else {\n    var scripts = document.getElementsByTagName('script'),\n        script = scripts[scripts.length - 1];\n\n    if (script.src) {\n      current = script.src;\n    }\n  }\n\n  current = current.substring(0, current.lastIndexOf('/') + 1);\n  return current;\n});\n\n_defineProperty(Util, \"loadJs\", function (path, func) {////var script = document.createElement('script');\n  ////script.type=\"module\"\n  ////script.src = path;\n  //loadingCount++;\n  //var _func = func;\n  //import(path)\n  //.then( function(){\n  //\tloadingCount--;\n  //\tif(_func){\n  //\t\t_func();\n  //\t}\n  //})\n  //.catch(function(){\n  //\tloadingCount--;\n  //})\n  ////document.head.appendChild(script);\n});\n\n//# sourceURL=webpack://hdrpaint/./src/lib/util.js?");

/***/ }),

/***/ "./src/lib/vector.js":
/*!***************************!*\
  !*** ./src/lib/vector.js ***!
  \***************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"Mat33\": function() { return /* binding */ Mat33; },\n/* harmony export */   \"Mat43\": function() { return /* binding */ Mat43; },\n/* harmony export */   \"Mat44\": function() { return /* binding */ Mat44; },\n/* harmony export */   \"Vec2\": function() { return /* binding */ Vec2; },\n/* harmony export */   \"Vec3\": function() { return /* binding */ Vec3; },\n/* harmony export */   \"Vec4\": function() { return /* binding */ Vec4; }\n/* harmony export */ });\n\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar Vec2 = function () {\n  var Vec2 = function () {\n    this[0] = 0.0;\n    this[1] = 0.0;\n  };\n\n  var ret = Vec2;\n\n  ret.copy = function (a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n  };\n\n  ret.scalar = function (a) {\n    return Math.sqrt(a[0] * a[0] + a[1] * a[1]);\n  };\n\n  ret.scalar2 = function (a) {\n    return a[0] * a[0] + a[1] * a[1];\n  };\n\n  ret.set = function (a, x, y) {\n    a[0] = x;\n    a[1] = y;\n  };\n\n  ret.add = function (a, b, c) {\n    a[0] = b[0] + c[0];\n    a[1] = b[1] + c[1];\n  };\n\n  ret.sub = function (a, b, c) {\n    a[0] = b[0] - c[0];\n    a[1] = b[1] - c[1];\n  };\n\n  ret.mul = function (a, b, c) {\n    a[0] = b[0] * c;\n    a[1] = b[1] * c;\n  };\n\n  ret.madd = function (a, b, c, d) {\n    a[0] = b[0] + c[0] * d;\n    a[1] = b[1] + c[1] * d;\n  };\n\n  ret.len = function (a, b) {\n    return Math.sqrt((a[0] - b[0]) * (a[0] - b[0]) + (a[1] - b[1]) * (a[1] - b[1]));\n  };\n\n  ret.len2 = function (a, b) {\n    return (a[0] - b[0]) * (a[0] - b[0]) + (a[1] - b[1]) * (a[1] - b[1]);\n  };\n\n  ret.nrm = function (a, b) {\n    var l = Math.sqrt(b[0] * b[0] + b[1] * b[1]);\n    l = 1 / l;\n    if (!isFinite(l)) return;\n    a[0] *= l;\n    a[1] *= l;\n  };\n\n  ret.norm = function (a) {\n    var l = Math.sqrt(a[0] * a[0] + a[1] * a[1]);\n    l = 1 / l;\n    if (!isFinite(l)) return;\n    a[0] *= l;\n    a[1] *= l;\n  };\n\n  ret.dot = function (a, b) {\n    return a[0] * b[0] + a[1] * b[1];\n  };\n\n  ret.cross = function (a, b) {\n    return a[0] * b[1] - a[1] * b[0];\n  };\n\n  return ret;\n}();\n\nvar Vec3 = function () {\n  var Vec3 = function () {\n    //var o=new Array(3);\n    var o = new Float32Array(3);\n    o[0] = 0;\n    o[1] = 0;\n    o[2] = 0;\n    return o;\n  };\n\n  var ret = Vec3;\n  ret.ZERO = new Vec3();\n\n  ret.set = function (a, x, y, z) {\n    a[0] = x;\n    a[1] = y;\n    a[2] = z;\n  };\n\n  ret.copy = function (a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n  };\n\n  ret.add = function (a, b, c) {\n    a[0] = b[0] + c[0];\n    a[1] = b[1] + c[1];\n    a[2] = b[2] + c[2];\n  };\n\n  ret.sub = function (a, b, c) {\n    a[0] = b[0] - c[0];\n    a[1] = b[1] - c[1];\n    a[2] = b[2] - c[2];\n  };\n\n  ret.copy = function (a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n  };\n\n  ret.mult = function (a, b, c) {\n    a[0] = b[0] * c;\n    a[1] = b[1] * c;\n    a[2] = b[2] * c;\n  };\n\n  ret.mul = function (a, b, c) {\n    a[0] = b[0] * c;\n    a[1] = b[1] * c;\n    a[2] = b[2] * c;\n  };\n\n  ret.madd = function (a, b, c, d) {\n    a[0] = b[0] + c[0] * d;\n    a[1] = b[1] + c[1] * d;\n    a[2] = b[2] + c[2] * d;\n  };\n\n  ret.len = function (b, c) {\n    var buf0 = b[0] - c[0];\n    var buf1 = b[1] - c[1];\n    var buf2 = b[2] - c[2];\n    return Math.sqrt(buf0 * buf0 + buf1 * buf1 + buf2 * buf2);\n  };\n\n  ret.len2 = function (b, c) {\n    var buf0 = b[0] - c[0];\n    var buf1 = b[1] - c[1];\n    var buf2 = b[2] - c[2];\n    return buf0 * buf0 + buf1 * buf1 + buf2 * buf2;\n  };\n\n  ret.scalar = function (a) {\n    return Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2]);\n  };\n\n  ret.scalar2 = function (a) {\n    return a[0] * a[0] + a[1] * a[1] + a[2] * a[2];\n  };\n\n  ret.nrm = function (a, b) {\n    var l = Math.sqrt(b[0] * b[0] + b[1] * b[1] + b[2] * b[2]);\n\n    if (l == 0) {\n      return;\n    }\n\n    l = 1 / l;\n    a[0] = b[0] * l;\n    a[1] = b[1] * l;\n    a[2] = b[2] * l;\n  };\n\n  ret.norm = function (a) {\n    var l = Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2]);\n\n    if (l == 0) {\n      return;\n    }\n\n    l = 1 / l;\n    a[0] *= l;\n    a[1] *= l;\n    a[2] *= l;\n  };\n\n  ret.dot = function (a, b) {\n    return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n  };\n\n  ret.vecmul = function (a, b, c) {\n    a[0] = b[0] * c[0];\n    a[1] = b[1] * c[1];\n    a[2] = b[2] * c[2];\n  };\n\n  ret.cross = function (a, b, c) {\n    var buf0 = b[1] * c[2] - b[2] * c[1];\n    var buf1 = b[2] * c[0] - b[0] * c[2];\n    var buf2 = b[0] * c[1] - b[1] * c[0];\n    a[0] = buf0;\n    a[1] = buf1;\n    a[2] = buf2;\n  };\n\n  var buf1 = new Vec3();\n  var buf2 = new Vec3();\n\n  ret.cross3 = function (a, b, c, d, e) {\n    Vec3.sub(buf1, c, b);\n    Vec3.sub(buf2, e, d);\n    Vec3.cross(a, buf1, buf2);\n  };\n\n  ret.cross2 = function (a, b, c, d) {\n    ret.cross3(a, b, c, b, d);\n  };\n\n  return ret;\n}();\n\nvar Vec4 = function () {\n  var buf0, buf1, buf2, buf3;\n  var x2, y2, z2, xy, yz, zx, xw, yw, zw;\n  var qr, ss, flag, sp, ph, pt, t1, t0;\n\n  var Vec4 = function () {\n    var o = new Float32Array(4);\n    o[0] = 0;\n    o[1] = 0;\n    o[2] = 0;\n    o[3] = 0;\n    return o; //this[0]=0.0\n    //this[1]=0.0\n    //this[2]=0.0\n    //this[3]=1.0\n  };\n\n  var ret = Vec4;\n\n  ret.set = function (a, x, y, z, w) {\n    a[0] = x;\n    a[1] = y;\n    a[2] = z;\n    a[3] = w;\n  };\n\n  ret.copy = function (a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n    a[3] = b[3];\n  };\n\n  ret.add = function (a, b, c) {\n    a[0] = b[0] + c[0];\n    a[1] = b[1] + c[1];\n    a[2] = b[2] + c[2];\n    a[3] = b[3] + c[3];\n  };\n\n  ret.sub = function (a, b, c) {\n    a[0] = b[0] - c[0];\n    a[1] = b[1] - c[1];\n    a[2] = b[2] - c[2];\n    a[3] = b[3] - c[3];\n  };\n\n  ret.mul = function (a, b, c) {\n    a[0] *= c;\n    a[1] *= c;\n    a[2] *= c;\n    a[3] *= c;\n  };\n\n  ret.set = function (a, x, y, z, w) {\n    a[0] = x;\n    a[1] = y;\n    a[2] = z;\n    a[3] = w;\n  };\n\n  ret.qdot = function (a, b, c) {\n    buf0 = b[0] * c[0] - b[1] * c[1] - b[2] * c[2] - b[3] * c[3];\n    buf1 = b[0] * c[1] + c[0] * b[1] + b[2] * c[3] - b[3] * c[2];\n    buf2 = b[0] * c[2] + c[0] * b[2] + b[3] * c[1] - b[1] * c[3];\n    buf3 = b[0] * c[3] + c[0] * b[3] + b[1] * c[2] - b[2] * c[1];\n    a[0] = buf0;\n    a[1] = buf1;\n    a[2] = buf2;\n    a[3] = buf3;\n  };\n\n  ret.qmul = function (a, b, c) {\n    if (b[0] == 1) {\n      a[0] = b[0];\n      a[1] = b[1];\n      a[2] = b[2];\n      a[3] = b[3];\n      return;\n    }\n\n    var theta = Math.acos(b[0]);\n    var r = Math.sin(theta * c) / Math.sin(theta);\n    a[0] = Math.cos(theta * c);\n    a[1] = b[1] * r;\n    a[2] = b[2] * r;\n    a[3] = b[3] * r;\n  };\n\n  ret.qmdot = function (a, b, c) {\n    buf0 = b[0] * c[0] + b[1] * c[1] + b[2] * c[2] + b[3] * c[3];\n    buf1 = -b[0] * c[1] + c[0] * b[1] - b[2] * c[3] + b[3] * c[2];\n    buf2 = -b[0] * c[2] + c[0] * b[2] - b[3] * c[1] + b[1] * c[3];\n    buf3 = -b[0] * c[3] + c[0] * b[3] - b[1] * c[2] + b[2] * c[1];\n    a[0] = Math.min(1, Math.max(-1, buf0));\n    a[1] = buf1;\n    a[2] = buf2;\n    a[3] = buf3;\n  };\n\n  ret.fromRotVector = function (v, w, x, y, z) {\n    var SIN = Math.sin(w * 0.5);\n    v[0] = Math.cos(w * 0.5);\n    ;\n    v[1] = SIN * x;\n    v[2] = SIN * y;\n    v[3] = SIN * z;\n  };\n\n  ret.toTorque = function (v, q) {\n    var w = Math.acos(q[0]) * 2;\n\n    if (w !== 0) {\n      w = w / Math.sin(w * 0.5);\n    } else {\n      w = 0;\n    }\n\n    v[0] = q[1] * w;\n    v[1] = q[2] * w;\n    v[2] = q[3] * w;\n  };\n\n  ret.rotVec3 = function (a, b, c) {\n    //c = (0,x,y,z)\n    buf0 = -b[1] * c[0] - b[2] * c[1] - b[3] * c[2];\n    buf1 = b[0] * c[0] + b[2] * c[2] - b[3] * c[1];\n    buf2 = b[0] * c[1] + b[3] * c[0] - b[1] * c[2];\n    buf3 = b[0] * c[2] + b[1] * c[1] - b[2] * c[0];\n    a[0] = -buf0 * b[1] + b[0] * buf1 - buf2 * b[3] + buf3 * b[2];\n    a[1] = -buf0 * b[2] + b[0] * buf2 - buf3 * b[1] + buf1 * b[3];\n    a[2] = -buf0 * b[3] + b[0] * buf3 - buf1 * b[2] + buf2 * b[1];\n  };\n\n  ret.toMat33 = function (a, b) {\n    x2 = b[1] * b[1] * 2.0;\n    y2 = b[2] * b[2] * 2.0;\n    z2 = b[3] * b[3] * 2.0;\n    xy = b[1] * b[2] * 2.0;\n    yz = b[2] * b[3] * 2.0;\n    zx = b[3] * b[1] * 2.0;\n    xw = b[1] * b[0] * 2.0;\n    yw = b[2] * b[0] * 2.0;\n    zw = b[3] * b[0] * 2.0;\n    a[0] = 1.0 - y2 - z2;\n    a[1] = xy + zw;\n    a[2] = zx - yw;\n    a[3] = xy - zw;\n    a[4] = 1.0 - z2 - x2;\n    a[5] = yz + xw;\n    a[6] = zx + yw;\n    a[7] = yz - xw;\n    a[8] = 1.0 - x2 - y2;\n  };\n\n  ret.toMat43 = ret.qTOm = function (a, b) {\n    x2 = b[1] * b[1] * 2.0;\n    y2 = b[2] * b[2] * 2.0;\n    z2 = b[3] * b[3] * 2.0;\n    xy = b[1] * b[2] * 2.0;\n    yz = b[2] * b[3] * 2.0;\n    zx = b[3] * b[1] * 2.0;\n    xw = b[1] * b[0] * 2.0;\n    yw = b[2] * b[0] * 2.0;\n    zw = b[3] * b[0] * 2.0;\n    a[0] = 1.0 - y2 - z2;\n    a[1] = xy + zw;\n    a[2] = zx - yw;\n    a[3] = xy - zw;\n    a[4] = 1.0 - z2 - x2;\n    a[5] = yz + xw;\n    a[6] = zx + yw;\n    a[7] = yz - xw;\n    a[8] = 1.0 - x2 - y2;\n    a[9] = a[10] = a[11] = 0.0;\n  }; //\n\n\n  ret.slerp = function (a, b, c, t) {\n    qr = b[0] * c[0] + b[1] * c[1] + b[2] * c[2] + b[3] * c[3];\n    ss = 1.0 - qr * qr;\n    flag = 0;\n\n    if (qr < 0) {\n      flag = 1;\n      qr *= -1;\n    }\n\n    if (ss <= 0.0) {\n      a[0] = b[0];\n      a[1] = b[1];\n      a[2] = b[2];\n      a[3] = b[3];\n    } else {\n      sp = Math.sqrt(ss);\n      ph = Math.acos(qr);\n      pt = ph * t;\n      t1 = Math.sin(pt) / sp;\n      t0 = Math.sin(ph - pt) / sp;\n      if (flag) t1 *= -1;\n      a[0] = b[0] * t0 + c[0] * t1;\n      a[1] = b[1] * t0 + c[1] * t1;\n      a[2] = b[2] * t0 + c[2] * t1;\n      a[3] = b[3] * t0 + c[3] * t1;\n    }\n  };\n\n  ret.fromMat44 = function (v, m) {\n    var m33 = Mat33.poolAlloc();\n    m33[0] = m[0];\n    m33[1] = m[1];\n    m33[2] = m[2];\n    m33[3] = m[4];\n    m33[4] = m[5];\n    m33[5] = m[6];\n    m33[6] = m[8];\n    m33[7] = m[9];\n    m33[8] = m[10]; //this.fromMat33(v,m33);\n\n    Mat33.rotToQuat(v, m33);\n    Mat33.poolFree(1);\n  };\n\n  ret.fromMat33 = function (v, m) {\n    var invx = 1 / Math.sqrt(m[0] * m[0] + m[1] * m[1] + m[2] * m[2]);\n    var invy = 1 / Math.sqrt(m[3] * m[3] + m[4] * m[4] + m[5] * m[5]);\n    var invz = 1 / Math.sqrt(m[6] * m[6] + m[7] * m[7] + m[8] * m[8]);\n    var m33 = Mat33.poolAlloc();\n    m33[0] = m[0] * invx;\n    m33[1] = m[1] * invx;\n    m33[2] = m[2] * invx;\n    m33[3] = m[3] * invy;\n    m33[4] = m[4] * invy;\n    m33[5] = m[5] * invy;\n    m33[6] = m[6] * invz;\n    m33[7] = m[7] * invz;\n    m33[8] = m[8] * invz;\n    Mat33.getRotVec(v, m33);\n    var r = Vec3.scalar(v);\n\n    if (r !== 0) {\n      Vec3.mul(v, v, 1 / r);\n      Vec4.fromRotVector(v, r, v[0], v[1], v[2]);\n    } else {\n      Vec4.set(v, 0, 0, 0, 1);\n    }\n\n    Mat33.poolFree(1);\n  };\n\n  return ret;\n}();\n\nvar Mat33 = function () {\n  var Mat33 = function () {\n    var o = new Float32Array(9);\n    Mat33.setInit(o);\n    return o;\n  };\n\n  var ret = Mat33;\n\n  ret.setInit = function (m) {\n    m[0] = 1;\n    m[1] = 0;\n    m[2] = 0;\n    m[3] = 0;\n    m[4] = 1;\n    m[5] = 0;\n    m[6] = 0;\n    m[7] = 0;\n    m[8] = 1;\n  };\n\n  ret.ZERO = new Mat33(); //ret.ZERO.fill(0);\n\n  ret.ZERO[0] = 0;\n  ret.ZERO[4] = 0;\n  ret.ZERO[8] = 0;\n  var buffer = new Mat33();\n  var bufferVec3 = new Vec3();\n\n  ret.set = function (obj, a0, a1, a2, a3, a4, a5, a6, a7, a8) {\n    obj[0] = a0;\n    obj[1] = a1;\n    obj[2] = a2;\n    obj[3] = a3;\n    obj[4] = a4;\n    obj[5] = a5;\n    obj[6] = a6;\n    obj[7] = a7;\n    obj[8] = a8;\n  };\n\n  ret.copy = function (m, a) {\n    m[0] = a[0];\n    m[1] = a[1];\n    m[2] = a[2];\n    m[3] = a[3];\n    m[4] = a[4];\n    m[5] = a[5];\n    m[6] = a[6];\n    m[7] = a[7];\n    m[8] = a[8];\n  };\n\n  ret.add = function (a, b, c) {\n    a[0] = b[0] + c[0];\n    a[1] = b[1] + c[1];\n    a[2] = b[2] + c[2];\n    a[3] = b[3] + c[3];\n    a[4] = b[4] + c[4];\n    a[5] = b[5] + c[5];\n    a[6] = b[6] + c[6];\n    a[7] = b[7] + c[7];\n    a[8] = b[8] + c[8];\n  };\n\n  ret.madd = function (a, b, c, d) {\n    a[0] = b[0] + c[0] * d;\n    a[1] = b[1] + c[1] * d;\n    a[2] = b[2] + c[2] * d;\n    a[3] = b[3] + c[3] * d;\n    a[4] = b[4] + c[4] * d;\n    a[5] = b[5] + c[5] * d;\n    a[6] = b[6] + c[6] * d;\n    a[7] = b[7] + c[7] * d;\n    a[8] = b[8] + c[8] * d;\n  };\n\n  ret.sub = function (a, b, c) {\n    a[0] = b[0] - c[0];\n    a[1] = b[1] - c[1];\n    a[2] = b[2] - c[2];\n    a[3] = b[3] - c[3];\n    a[4] = b[4] - c[4];\n    a[5] = b[5] - c[5];\n    a[6] = b[6] - c[6];\n    a[7] = b[7] - c[7];\n    a[8] = b[8] - c[8];\n  };\n\n  ret.mul = function (a, b, c) {\n    a[0] = b[0] * c;\n    a[1] = b[1] * c;\n    a[2] = b[2] * c;\n    a[3] = b[3] * c;\n    a[4] = b[4] * c;\n    a[5] = b[5] * c;\n    a[6] = b[6] * c;\n    a[7] = b[7] * c;\n    a[8] = b[8] * c;\n  };\n\n  ret.dotVec3 = function (ret, m, v) {\n    var v0 = v[0];\n    var v1 = v[1];\n    var v2 = v[2];\n    ret[0] = m[0] * v0 + m[3] * v1 + m[6] * v2;\n    ret[1] = m[1] * v0 + m[4] * v1 + m[7] * v2;\n    ret[2] = m[2] * v0 + m[5] * v1 + m[8] * v2; //ret.set(bufferVec3);\n  };\n\n  ret.dot = function (ret, ma, mb) {\n    buffer[0] = ma[0] * mb[0] + ma[3] * mb[1] + ma[6] * mb[2];\n    buffer[1] = ma[1] * mb[0] + ma[4] * mb[1] + ma[7] * mb[2];\n    buffer[2] = ma[2] * mb[0] + ma[5] * mb[1] + ma[8] * mb[2];\n    buffer[3] = ma[0] * mb[3] + ma[3] * mb[4] + ma[6] * mb[5];\n    buffer[4] = ma[1] * mb[3] + ma[4] * mb[4] + ma[7] * mb[5];\n    buffer[5] = ma[2] * mb[3] + ma[5] * mb[4] + ma[8] * mb[5];\n    buffer[6] = ma[0] * mb[6] + ma[3] * mb[7] + ma[6] * mb[8];\n    buffer[7] = ma[1] * mb[6] + ma[4] * mb[7] + ma[7] * mb[8];\n    buffer[8] = ma[2] * mb[6] + ma[5] * mb[7] + ma[8] * mb[8];\n    ret.set(buffer);\n  };\n\n  ret.fromRotVector = function (ret, r, x, y, z) {\n    var SIN = Math.sin(r);\n    var COS = Math.cos(r);\n    ret[0] = x * x * (1 - COS) + COS;\n    ret[3] = x * y * (1 - COS) - z * SIN;\n    ret[6] = z * x * (1 - COS) + y * SIN;\n    ret[1] = x * y * (1 - COS) + z * SIN;\n    ret[4] = y * y * (1 - COS) + COS;\n    ret[7] = y * z * (1 - COS) - x * SIN;\n    ret[2] = z * x * (1 - COS) - y * SIN;\n    ret[5] = y * z * (1 - COS) + x * SIN;\n    ret[8] = z * z * (1 - COS) + COS;\n  };\n\n  ret.getRotVec = function (ret, m) {\n    var COS = (m[0] + m[4] + m[8] - 1) * 0.5;\n\n    if (COS * COS >= 1) {\n      Vec3.set(ret, 0, 0, 0);\n      return;\n    }\n\n    var r = Math.acos(COS);\n    var SIN = Math.sin(r);\n    ret[0] = m[5] - m[7];\n    ret[1] = m[6] - m[2];\n    ret[2] = m[1] - m[3];\n    Vec3.mul(ret, ret, r / (SIN * 2.0));\n  };\n\n  ret.rotToQuat = function (r, m) {\n    r[1] = m[0] - m[4] - m[8] + 1;\n    r[2] = -m[0] + m[4] - m[8] + 1;\n    r[3] = -m[0] - m[4] + m[8] + 1;\n    r[0] = m[0] + m[4] + m[8] + 1;\n    var bigest = 0;\n\n    for (var i = 1; i < 4; i++) {\n      if (r[i] > r[bigest]) {\n        bigest = i;\n      }\n    }\n\n    if (r[bigest] < 0) {\n      return;\n    }\n\n    var v = Math.sqrt(r[bigest]) * 0.5;\n    r[bigest] = v;\n    var mult = 0.25 / v;\n\n    switch (bigest) {\n      case 1:\n        r[2] = (m[1] + m[3]) * mult;\n        r[3] = (m[2] + m[6]) * mult;\n        r[0] = (m[5] - m[7]) * mult;\n        break;\n\n      case 2:\n        r[1] = (m[1] + m[3]) * mult;\n        r[3] = (m[7] + m[5]) * mult;\n        r[0] = (m[6] - m[2]) * mult;\n        break;\n\n      case 3:\n        r[1] = (m[7] + m[5]) * mult;\n        r[2] = (m[2] + m[6]) * mult;\n        r[0] = (m[1] - m[3]) * mult;\n        break;\n\n      case 0:\n        r[1] = (m[5] - m[7]) * mult;\n        r[2] = (m[6] - m[2]) * mult;\n        r[3] = (m[1] - m[3]) * mult;\n        break;\n    }\n\n    return;\n  };\n\n  ret.getRotQuat = function (ret, m) {\n    return Mat33.rotToQuat(ret, m);\n    Mat33.getRotVec(ret, m);\n    var r = Vec3.scalar(ret);\n\n    if (!r) {\n      Vec4.set(ret, 1, 0, 0, 0);\n      return;\n    }\n\n    Vec3.mul(ret, ret, 1 / r);\n    Vec4.fromRotVector(ret, r, ret[0], ret[1], ret[2]);\n  };\n\n  ret.getEulerXYZ = function (vec, m) {\n    vec[1] = Math.asin(m[2]);\n\n    if (m[2] == 1 || m[2] == -1) {\n      vec[0] = 0;\n      vec[2] = Math.atan2(-m[3], [4]);\n    } else {\n      vec[0] = Math.atan2(m[5], m[8]);\n      vec[2] = Math.atan2(m[1], m[0]);\n    }\n  };\n\n  ret.getEuler = function (vec, m) {\n    vec[2] = Math.asin(m[1]);\n\n    if (m[1] == 1 || m[1] == -1) {\n      vec[0] = 0;\n      vec[1] = Math.atan2(m[8], [6]);\n    } else {\n      vec[0] = Math.atan2(-m[7], m[4]);\n      vec[1] = Math.atan2(-m[2], m[0]);\n    }\n  };\n\n  ret.getInv = function (ret, m) {\n    var d = m[0] * m[4] * m[8] + m[3] * m[7] * m[2] + m[6] * m[1] * m[5] - m[6] * m[4] * m[2] - m[3] * m[1] * m[8] - m[0] * m[7] * m[5];\n\n    if (!d) {\n      this.mul(m, m, 0);\n      return;\n    }\n\n    d = 1.0 / d;\n    var m0 = (m[4] * m[8] - m[7] * m[5]) * d;\n    var m1 = (m[7] * m[2] - m[1] * m[8]) * d;\n    var m2 = (m[1] * m[5] - m[4] * m[2]) * d;\n    var m3 = (m[6] * m[5] - m[3] * m[8]) * d;\n    var m4 = (m[0] * m[8] - m[6] * m[2]) * d;\n    var m5 = (m[3] * m[2] - m[0] * m[5]) * d;\n    var m6 = (m[3] * m[7] - m[6] * m[4]) * d;\n    var m7 = (m[6] * m[1] - m[0] * m[7]) * d;\n    var m8 = (m[0] * m[4] - m[3] * m[1]) * d;\n    ret[0] = m0;\n    ret[1] = m1;\n    ret[2] = m2;\n    ret[3] = m3;\n    ret[4] = m4;\n    ret[5] = m5;\n    ret[6] = m6;\n    ret[7] = m7;\n    ret[8] = m8;\n  };\n\n  ret.calcTranspose = function (ret, m) {\n    var buf;\n    buf = m[1];\n    ret[1] = m[3];\n    ret[3] = buf;\n    buf = m[2];\n    ret[2] = m[6];\n    ret[6] = buf;\n    buf = m[5];\n    ret[5] = m[7];\n    ret[7] = buf;\n  };\n\n  ret.rotate = function (mat33, r, x, y, z) {\n    var SIN = Math.sin(r);\n    var COS = Math.cos(r);\n    mat33[0] = x * x * (1 - COS) + COS;\n    mat33[3] = x * y * (1 - COS) - z * SIN;\n    mat33[6] = z * x * (1 - COS) + y * SIN;\n    mat33[1] = x * y * (1 - COS) + z * SIN;\n    mat33[4] = y * y * (1 - COS) + COS;\n    mat33[7] = y * z * (1 - COS) - x * SIN;\n    mat33[2] = z * x * (1 - COS) - y * SIN;\n    mat33[5] = y * z * (1 - COS) + x * SIN;\n    mat33[8] = z * z * (1 - COS) + COS;\n  };\n\n  return ret;\n}();\n\nvar Mat43 = function () {\n  //|0 3 6 9 |\n  //|1 4 7 10|\n  //|2 5 8 11|\n  var Mat43 = function () {\n    var o = new Float32Array(12);\n    Mat43.setInit(o);\n    return o;\n  };\n\n  var ret = Mat43;\n  var buf = new Float32Array(12);\n\n  ret.setInit = function (mat) {\n    mat[0] = 1.0;\n    mat[1] = 0.0;\n    mat[2] = 0.0;\n    mat[3] = 0.0;\n    mat[4] = 1.0;\n    mat[5] = 0.0;\n    mat[6] = 0.0;\n    mat[7] = 0.0;\n    mat[8] = 1.0;\n    mat[9] = 0.0;\n    mat[10] = 0.0;\n    mat[11] = 0.0;\n  };\n\n  ret.set = function (obj, a0, a1, a2, a3, a4, a5, a6, a7, a8, a9, a10, a11) {\n    obj[0] = a0;\n    obj[1] = a1;\n    obj[2] = a2;\n    obj[3] = a3;\n    obj[4] = a4;\n    obj[5] = a5;\n    obj[6] = a6;\n    obj[7] = a7;\n    obj[8] = a8;\n    obj[9] = a9;\n    obj[10] = a10;\n    obj[11] = a11;\n  };\n\n  ret.copy = function (a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n    a[3] = b[3];\n    a[4] = b[4];\n    a[5] = b[5];\n    a[6] = b[6];\n    a[7] = b[7];\n    a[8] = b[8];\n    a[9] = b[9];\n    a[10] = b[10];\n    a[11] = b[11];\n  };\n\n  ret.copyMat44 = function (a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n    a[3] = b[4];\n    a[4] = b[5];\n    a[5] = b[6];\n    a[6] = b[8];\n    a[7] = b[9];\n    a[8] = b[10];\n    a[9] = b[12];\n    a[10] = b[13];\n    a[11] = b[14];\n  };\n\n  ret.mul = function (a, b, c) {\n    a[0] = b[0] * c;\n    a[1] = b[1] * c;\n    a[2] = b[2] * c;\n    a[3] = b[3] * c;\n    a[4] = b[4] * c;\n    a[5] = b[5] * c;\n    a[6] = b[6] * c;\n    a[7] = b[7] * c;\n    a[8] = b[8] * c;\n    a[9] = b[9] * c;\n    a[10] = b[10] * c;\n    a[11] = b[11] * c;\n  };\n\n  ret.dotVec3 = function (a, b, c) {\n    var buf0 = c[0];\n    var buf1 = c[1];\n    var buf2 = c[2];\n    a[0] = b[0] * buf0 + b[3] * buf1 + b[6] * buf2 + b[9];\n    a[1] = b[1] * buf0 + b[4] * buf1 + b[7] * buf2 + b[10];\n    a[2] = b[2] * buf0 + b[5] * buf1 + b[8] * buf2 + b[11];\n  };\n\n  ret.dotMat33Vec3 = function (a, b, c) {\n    var buf0 = c[0];\n    var buf1 = c[1];\n    var buf2 = c[2];\n    a[0] = b[0] * buf0 + b[3] * buf1 + b[6] * buf2;\n    a[1] = b[1] * buf0 + b[4] * buf1 + b[7] * buf2;\n    a[2] = b[2] * buf0 + b[5] * buf1 + b[8] * buf2;\n  };\n\n  ret.dotVec4 = function (a, b, c) {\n    var buf0 = c[0];\n    var buf1 = c[1];\n    var buf2 = c[2];\n    var buf3 = c[3];\n    a[0] = b[0] * buf0 + b[3] * buf1 + b[6] * buf2 + b[9] * buf3;\n    a[1] = b[1] * buf0 + b[4] * buf1 + b[7] * buf2 + b[10] * buf3;\n    a[2] = b[2] * buf0 + b[5] * buf1 + b[8] * buf2 + b[11] * buf3;\n    a[3] = buf3;\n  };\n\n  ret.dot = function (a, b, c) {\n    buf[0] = b[0] * c[0] + b[3] * c[1] + b[6] * c[2];\n    buf[1] = b[1] * c[0] + b[4] * c[1] + b[7] * c[2];\n    buf[2] = b[2] * c[0] + b[5] * c[1] + b[8] * c[2];\n    buf[3] = b[0] * c[3] + b[3] * c[4] + b[6] * c[5];\n    buf[4] = b[1] * c[3] + b[4] * c[4] + b[7] * c[5];\n    buf[5] = b[2] * c[3] + b[5] * c[4] + b[8] * c[5];\n    buf[6] = b[0] * c[6] + b[3] * c[7] + b[6] * c[8];\n    buf[7] = b[1] * c[6] + b[4] * c[7] + b[7] * c[8];\n    buf[8] = b[2] * c[6] + b[5] * c[7] + b[8] * c[8];\n    buf[9] = b[0] * c[9] + b[3] * c[10] + b[6] * c[11] + b[9];\n    buf[10] = b[1] * c[9] + b[4] * c[10] + b[7] * c[11] + b[10];\n    buf[11] = b[2] * c[9] + b[5] * c[10] + b[8] * c[11] + b[11];\n    a.set(buf); //if(a == b){\n    //\tvar buf0 = b[0];\n    //\tvar buf1 = b[1];\n    //\tvar buf2 = b[2];\n    //\tvar buf3 = b[3];\n    //\tvar buf4 = b[4];\n    //\tvar buf5 = b[5];\n    //\tvar buf6 = b[6];\n    //\tvar buf7 = b[7];\n    //\tvar buf8 = b[8];\n    //\tvar buf9 = b[9];\n    //\tvar buf10 = b[10];\n    //\tvar buf11 = b[11];\n    //\ta[0]=buf0*c[0] + buf3*c[1] + buf6*c[2];\n    //\ta[1]=buf1*c[0] + buf4*c[1] + buf7*c[2];\n    //\ta[2]=buf2*c[0] + buf5*c[1] + buf8*c[2];\n    //\ta[3]=buf0*c[3] + buf3*c[4] + buf6*c[5];\n    //\ta[4]=buf1*c[3] + buf4*c[4] + buf7*c[5];\n    //\ta[5]=buf2*c[3] + buf5*c[4] + buf8*c[5];\n    //\ta[6]=buf0*c[6] + buf3*c[7] + buf6*c[8];\n    //\ta[7]=buf1*c[6] + buf4*c[7] + buf7*c[8];\n    //\ta[8]=buf2*c[6] + buf5*c[7] + buf8*c[8];\n    //\ta[9]=buf0*c[9] + buf3*c[10] + buf6*c[11] + buf9;\n    //\ta[10]=buf1*c[9] + buf4*c[10] + buf7*c[11] + buf10;\n    //\ta[11]=buf2*c[9] + buf5*c[10] + buf8*c[11] + buf11;\n    //}else{\n    //\tvar buf0 = c[0];\n    //\tvar buf1 = c[1];\n    //\tvar buf2 = c[2];\n    //\tvar buf3 = c[3];\n    //\tvar buf4 = c[4];\n    //\tvar buf5 = c[5];\n    //\tvar buf6 = c[6];\n    //\tvar buf7 = c[7];\n    //\tvar buf8 = c[8];\n    //\tvar buf9 = c[9];\n    //\tvar buf10 = c[10];\n    //\tvar buf11 = c[11];\n    //\ta[0]=b[0]*buf0 + b[3]*buf1 + b[6]*buf2;\n    //\ta[1]=b[1]*buf0 + b[4]*buf1 + b[7]*buf2;\n    //\ta[2]=b[2]*buf0 + b[5]*buf1 + b[8]*buf2;\n    //\ta[3]=b[0]*buf3 + b[3]*buf4 + b[6]*buf5;\n    //\ta[4]=b[1]*buf3 + b[4]*buf4 + b[7]*buf5;\n    //\ta[5]=b[2]*buf3 + b[5]*buf4 + b[8]*buf5;\n    //\ta[6]=b[0]*buf6 + b[3]*buf7 + b[6]*buf8;\n    //\ta[7]=b[1]*buf6 + b[4]*buf7 + b[7]*buf8;\n    //\ta[8]=b[2]*buf6 + b[5]*buf7 + b[8]*buf8;\n    //\ta[9]=b[0]*buf9 + b[3]*buf10 + b[6]*buf11 + b[9];\n    //\ta[10]=b[1]*buf9 + b[4]*buf10 + b[7]*buf11 + b[10];\n    //\ta[11]=b[2]*buf9 + b[5]*buf10 + b[8]*buf11 + b[11];\n    //}\n  };\n\n  ret.dotMat44Mat43 = function (a, b, c) {\n    var buf0 = b[0] * c[0] + b[4] * c[1] + b[8] * c[2];\n    var buf1 = b[1] * c[0] + b[5] * c[1] + b[9] * c[2];\n    var buf2 = b[2] * c[0] + b[6] * c[1] + b[10] * c[2];\n    var buf3 = b[0] * c[3] + b[4] * c[4] + b[8] * c[5];\n    var buf4 = b[1] * c[3] + b[5] * c[4] + b[9] * c[5];\n    var buf5 = b[2] * c[3] + b[6] * c[4] + b[10] * c[5];\n    var buf6 = b[0] * c[6] + b[4] * c[7] + b[8] * c[8];\n    var buf7 = b[1] * c[6] + b[5] * c[7] + b[9] * c[8];\n    var buf8 = b[2] * c[6] + b[6] * c[7] + b[10] * c[8];\n    var buf9 = b[0] * c[9] + b[4] * c[10] + b[8] * c[11] + b[12];\n    var buf10 = b[1] * c[9] + b[5] * c[10] + b[9] * c[11] + b[13];\n    var buf11 = b[2] * c[9] + b[6] * c[10] + b[10] * c[11] + b[14];\n    a[0] = buf0;\n    a[1] = buf1;\n    a[2] = buf2;\n    a[3] = buf3;\n    a[4] = buf4;\n    a[5] = buf5;\n    a[6] = buf6;\n    a[7] = buf7;\n    a[8] = buf8;\n    a[9] = buf9;\n    a[10] = buf10;\n    a[11] = buf11;\n  };\n\n  ret.fromRotVector = function (ret, r, x, y, z) {\n    var SIN = Math.sin(r);\n    var COS = Math.cos(r);\n    ret[0] = x * x * (1 - COS) + COS;\n    ret[3] = x * y * (1 - COS) - z * SIN;\n    ret[6] = z * x * (1 - COS) + y * SIN;\n    ret[1] = x * y * (1 - COS) + z * SIN;\n    ret[4] = y * y * (1 - COS) + COS;\n    ret[7] = y * z * (1 - COS) - x * SIN;\n    ret[2] = z * x * (1 - COS) - y * SIN;\n    ret[5] = y * z * (1 - COS) + x * SIN;\n    ret[8] = z * z * (1 - COS) + COS;\n    ret[9] = ret[10] = ret[11] = 0.0;\n  };\n\n  ret.getRotVector = function (target, angle) {\n    var bM = this.poolAlloc();\n    var dx = angle[0];\n    var dy = angle[1];\n    var dz = angle[2];\n    var ax = Math.atan2(dy, dz) + Math.PI;\n    var ay = Math.atan2(dx, dz);\n    var az = 0;\n    this.fromRotVector(target, -az, 0, 0, 1);\n    this.fromRotVector(bM, -ax, 1, 0, 0);\n    this.dot(target, target, bM);\n    this.fromRotVector(bM, -ay, 0, 1, 0);\n    this.dot(target, target, bM);\n    this.poolFree(1);\n  };\n\n  ret.getInv = function (a, b) {\n    var det = b[0] * b[4] * b[8] + b[3] * b[7] * b[2] + b[6] * b[1] * b[5] - b[0] * b[7] * b[5] - b[3] * b[1] * b[8] - b[6] * b[4] * b[2];\n\n    if (Math.abs(det) < 0.0001) {\n      return;\n    }\n\n    det = 1 / det;\n    var buf0 = b[0];\n    var buf1 = b[1];\n    var buf2 = b[2];\n    var buf3 = b[3];\n    var buf4 = b[4];\n    var buf5 = b[5];\n    var buf6 = b[6];\n    var buf7 = b[7];\n    var buf8 = b[8];\n    var buf9 = b[9];\n    var buf10 = b[10];\n    var buf11 = b[11];\n    a[0] = (buf4 * buf8 - buf7 * buf5) * det;\n    a[1] = (buf2 * buf7 - buf1 * buf8) * det;\n    a[2] = (buf1 * buf5 - buf4 * buf2) * det;\n    a[3] = (buf6 * buf5 - buf3 * buf8) * det;\n    a[4] = (buf0 * buf8 - buf6 * buf2) * det;\n    a[5] = (buf3 * buf2 - buf0 * buf5) * det;\n    a[6] = (buf3 * buf7 - buf4 * buf6) * det;\n    a[7] = (buf6 * buf1 - buf0 * buf7) * det;\n    a[8] = (buf0 * buf4 - buf3 * buf1) * det;\n    a[9] = (buf3 * buf10 * buf8 + buf6 * buf4 * buf11 + buf9 * buf7 * buf5 - buf3 * buf7 * buf11 - buf6 * buf10 * buf5 - buf9 * buf4 * buf8) * det;\n    a[10] = (buf0 * buf7 * buf11 + buf6 * buf10 * buf2 + buf9 * buf1 * buf8 - buf0 * buf10 * buf8 - buf6 * buf1 * buf11 - buf9 * buf7 * buf2) * det;\n    a[11] = (buf0 * buf10 * buf5 + buf3 * buf1 * buf11 + buf9 * buf4 * buf2 - buf0 * buf4 * buf11 - buf3 * buf10 * buf2 - buf9 * buf1 * buf5) * det;\n  };\n\n  ret.fromQuat = function (a, b) {\n    var x2 = b[1] * b[1] * 2.0;\n    var y2 = b[2] * b[2] * 2.0;\n    var z2 = b[3] * b[3] * 2.0;\n    var xy = b[1] * b[2] * 2.0;\n    var yz = b[2] * b[3] * 2.0;\n    var zx = b[3] * b[1] * 2.0;\n    var xw = b[1] * b[0] * 2.0;\n    var yw = b[2] * b[0] * 2.0;\n    var zw = b[3] * b[0] * 2.0;\n    a[0] = 1.0 - y2 - z2;\n    a[1] = xy + zw;\n    a[2] = zx - yw;\n    a[3] = xy - zw;\n    a[4] = 1.0 - z2 - x2;\n    a[5] = yz + xw;\n    a[6] = zx + yw;\n    a[7] = yz - xw;\n    a[8] = 1.0 - x2 - y2;\n    a[9] = a[10] = a[11] = 0.0;\n  }; //eulerAngleから行列を作る (XZY)\n\n\n  ret.fromEuler = function (m, e) {\n    var buf = Mat43.poolAlloc();\n    ret.fromRotVector(m, e[0], 1, 0, 0);\n    ret.fromRotVector(buf, e[2], 0, 0, 1);\n    Mat43.dot(m, buf, m);\n    ret.fromRotVector(buf, e[1], 0, 1, 0);\n    Mat43.dot(m, buf, m);\n    Mat43.poolFree(1);\n  }; //location,scale,eulerAnlge から行列を作る\n\n\n  ret.fromLSE = function (m, l, s, e) {\n    Mat43.fromEuler(m, e);\n    m[0] *= s[0];\n    m[1] *= s[0];\n    m[2] *= s[0];\n    m[3] *= s[1];\n    m[4] *= s[1];\n    m[5] *= s[1];\n    m[6] *= s[2];\n    m[7] *= s[2];\n    m[8] *= s[2];\n    m[9] = l[0];\n    m[10] = l[1];\n    m[11] = l[2];\n  }; //location,scale,quartanionから行列を作る\n\n\n  ret.fromLSR = function (m, l, s, r) {\n    Mat43.fromQuat(m, r);\n    m[0] *= s[0];\n    m[1] *= s[0];\n    m[2] *= s[0];\n    m[3] *= s[1];\n    m[4] *= s[1];\n    m[5] *= s[1];\n    m[6] *= s[2];\n    m[7] *= s[2];\n    m[8] *= s[2];\n    m[9] = l[0];\n    m[10] = l[1];\n    m[11] = l[2];\n  }; //行列をlocation,scale,quartanionに分ける\n\n\n  ret.toLSR = function (l, s, r, m) {\n    Vec3.set(l, m[9], m[10], m[11]);\n    Vec3.set(s, Math.sqrt(m[0] * m[0] + m[1] * m[1] + m[2] * m[2]), Math.sqrt(m[3] * m[3] + m[4] * m[4] + m[5] * m[5]), Math.sqrt(m[6] * m[6] + m[7] * m[7] + m[8] * m[8]));\n    var invx = 1 / s[0];\n    var invy = 1 / s[1];\n    var invz = 1 / s[2];\n    var m33 = new Mat33();\n    m33[0] = m[0] * invx;\n    m33[1] = m[1] * invx;\n    m33[2] = m[2] * invx;\n    m33[3] = m[3] * invy;\n    m33[4] = m[4] * invy;\n    m33[5] = m[5] * invy;\n    m33[6] = m[6] * invz;\n    m33[7] = m[7] * invz;\n    m33[8] = m[8] * invz;\n    Mat33.getRotQuat(r, m33);\n  };\n\n  ret.toLSE = function (l, s, e, m) {\n    Vec3.set(l, m[9], m[10], m[11]);\n    Vec3.set(s, Math.sqrt(m[0] * m[0] + m[1] * m[1] + m[2] * m[2]), Math.sqrt(m[3] * m[3] + m[4] * m[4] + m[5] * m[5]), Math.sqrt(m[6] * m[6] + m[7] * m[7] + m[8] * m[8]));\n    var invx = 1 / s[0];\n    var invy = 1 / s[1];\n    var invz = 1 / s[2];\n    var m33 = new Mat33();\n    m33[0] = m[0] * invx;\n    m33[1] = m[1] * invx;\n    m33[2] = m[2] * invx;\n    m33[3] = m[3] * invy;\n    m33[4] = m[4] * invy;\n    m33[5] = m[5] * invy;\n    m33[6] = m[6] * invz;\n    m33[7] = m[7] * invz;\n    m33[8] = m[8] * invz;\n    Mat33.getEuler(e, m33);\n  };\n\n  return ret;\n}();\n\nvar buf0, buf1, buf2, buf3, buf4, buf5, buf6, buf7, buf8, buf9, buf10, buf11, buf12, buf13, buf14, buf15;\nvar bM = new Float32Array(16);\nclass Mat44 {\n  constructor() {\n    var m = new Float32Array(16);\n    m[0] = 1.0;\n    m[1] = 0.0;\n    m[2] = 0.0;\n    m[3] = 0.0;\n    m[4] = 0.0;\n    m[5] = 1.0;\n    m[6] = 0.0;\n    m[7] = 0.0;\n    m[8] = 0.0;\n    m[9] = 0.0;\n    m[10] = 1.0;\n    m[11] = 0.0;\n    m[12] = 0.0;\n    m[13] = 0.0;\n    m[14] = 0.0;\n    m[15] = 1.0;\n    return m;\n  }\n\n  static setInit(mat) {\n    mat[0] = 1.0;\n    mat[1] = 0.0;\n    mat[2] = 0.0;\n    mat[3] = 0.0;\n    mat[4] = 0.0;\n    mat[5] = 1.0;\n    mat[6] = 0.0;\n    mat[7] = 0.0;\n    mat[8] = 0.0;\n    mat[9] = 0.0;\n    mat[10] = 1.0;\n    mat[11] = 0.0;\n    mat[12] = 0.0;\n    mat[13] = 0.0;\n    mat[14] = 0.0;\n    mat[15] = 1.0;\n  }\n\n  static set(obj, a0, a1, a2, a3, a4, a5, a6, a7, a8, a9, a10, a11, a12, a13, a14, a15) {\n    obj[0] = a0;\n    obj[1] = a1;\n    obj[2] = a2;\n    obj[3] = a3;\n    obj[4] = a4;\n    obj[5] = a5;\n    obj[6] = a6;\n    obj[7] = a7;\n    obj[8] = a8;\n    obj[9] = a9;\n    obj[10] = a10;\n    obj[11] = a11;\n    obj[12] = a12;\n    obj[13] = a13;\n    obj[14] = a14;\n    obj[15] = a15;\n  }\n\n  static copy(a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n    a[3] = b[3];\n    a[4] = b[4];\n    a[5] = b[5];\n    a[6] = b[6];\n    a[7] = b[7];\n    a[8] = b[8];\n    a[9] = b[9];\n    a[10] = b[10];\n    a[11] = b[11];\n    a[12] = b[12];\n    a[13] = b[13];\n    a[14] = b[14];\n    a[15] = b[15];\n  }\n\n  static copyMat43(a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n    a[3] = 0;\n    a[4] = b[3];\n    a[5] = b[4];\n    a[6] = b[5];\n    a[7] = 0;\n    a[8] = b[6];\n    a[9] = b[7];\n    a[10] = b[8];\n    a[11] = 0;\n    a[12] = b[9];\n    a[13] = b[10];\n    a[14] = b[11];\n    a[15] = 1;\n  }\n\n  static mul(a, b, c) {\n    a[0] = b[0] * c;\n    a[1] = b[1] * c;\n    a[2] = b[2] * c;\n    a[3] = b[3] * c;\n    a[4] = b[4] * c;\n    a[5] = b[5] * c;\n    a[6] = b[6] * c;\n    a[7] = b[7] * c;\n    a[8] = b[8] * c;\n    a[9] = b[9] * c;\n    a[10] = b[10] * c;\n    a[11] = b[11] * c;\n    a[12] = b[12] * c;\n    a[13] = b[13] * c;\n    a[14] = b[14] * c;\n    a[15] = b[15] * c;\n  }\n\n  static dotVec3(a, b, c) {\n    buf0 = c[0];\n    buf1 = c[1];\n    buf2 = c[2];\n    a[0] = b[0] * buf0 + b[4] * buf1 + b[8] * buf2 + b[12];\n    a[1] = b[1] * buf0 + b[5] * buf1 + b[9] * buf2 + b[13];\n    a[2] = b[2] * buf0 + b[6] * buf1 + b[10] * buf2 + b[14];\n  }\n\n  static dotMat33Vec3(a, b, c) {\n    buf0 = c[0];\n    buf1 = c[1];\n    buf2 = c[2];\n    a[0] = b[0] * buf0 + b[4] * buf1 + b[8] * buf2;\n    a[1] = b[1] * buf0 + b[5] * buf1 + b[9] * buf2;\n    a[2] = b[2] * buf0 + b[6] * buf1 + b[10] * buf2;\n  }\n\n  static dotVec4(a, b, c) {\n    buf0 = c[0];\n    buf1 = c[1];\n    buf2 = c[2];\n    buf3 = c[3];\n    a[0] = b[0] * buf0 + b[4] * buf1 + b[8] * buf2 + b[12] * buf3;\n    a[1] = b[1] * buf0 + b[5] * buf1 + b[9] * buf2 + b[13] * buf3;\n    a[2] = b[2] * buf0 + b[6] * buf1 + b[10] * buf2 + b[14] * buf3;\n    a[3] = b[3] * buf0 + b[7] * buf1 + b[11] * buf2 + b[15] * buf3;\n  }\n\n  static dot(a, b, c) {\n    if (a == b) {\n      buf0 = b[0];\n      buf1 = b[1];\n      buf2 = b[2];\n      buf3 = b[3];\n      buf4 = b[4];\n      buf5 = b[5];\n      buf6 = b[6];\n      buf7 = b[7];\n      buf8 = b[8];\n      buf9 = b[9];\n      buf10 = b[10];\n      buf11 = b[11];\n      buf12 = b[12];\n      buf13 = b[13];\n      buf14 = b[14];\n      buf15 = b[15];\n      a[0] = buf0 * c[0] + buf4 * c[1] + buf8 * c[2] + buf12 * c[3];\n      a[1] = buf1 * c[0] + buf5 * c[1] + buf9 * c[2] + buf13 * c[3];\n      a[2] = buf2 * c[0] + buf6 * c[1] + buf10 * c[2] + buf14 * c[3];\n      a[3] = buf3 * c[0] + buf7 * c[1] + buf11 * c[2] + buf15 * c[3];\n      a[4] = buf0 * c[4] + buf4 * c[5] + buf8 * c[6] + buf12 * c[7];\n      a[5] = buf1 * c[4] + buf5 * c[5] + buf9 * c[6] + buf13 * c[7];\n      a[6] = buf2 * c[4] + buf6 * c[5] + buf10 * c[6] + buf14 * c[7];\n      a[7] = buf3 * c[4] + buf7 * c[5] + buf11 * c[6] + buf15 * c[7];\n      a[8] = buf0 * c[8] + buf4 * c[9] + buf8 * c[10] + buf12 * c[11];\n      a[9] = buf1 * c[8] + buf5 * c[9] + buf9 * c[10] + buf13 * c[11];\n      a[10] = buf2 * c[8] + buf6 * c[9] + buf10 * c[10] + buf14 * c[11];\n      a[11] = buf3 * c[8] + buf7 * c[9] + buf11 * c[10] + buf15 * c[11];\n      a[12] = buf0 * c[12] + buf4 * c[13] + buf8 * c[14] + buf12 * c[15];\n      a[13] = buf1 * c[12] + buf5 * c[13] + buf9 * c[14] + buf13 * c[15];\n      a[14] = buf2 * c[12] + buf6 * c[13] + buf10 * c[14] + buf14 * c[15];\n      a[15] = buf3 * c[12] + buf7 * c[13] + buf11 * c[14] + buf15 * c[15];\n    } else {\n      buf0 = c[0];\n      buf1 = c[1];\n      buf2 = c[2];\n      buf3 = c[3];\n      buf4 = c[4];\n      buf5 = c[5];\n      buf6 = c[6];\n      buf7 = c[7];\n      buf8 = c[8];\n      buf9 = c[9];\n      buf10 = c[10];\n      buf11 = c[11];\n      buf12 = c[12];\n      buf13 = c[13];\n      buf14 = c[14];\n      buf15 = c[15];\n      a[0] = b[0] * buf0 + b[4] * buf1 + b[8] * buf2 + b[12] * buf3;\n      a[1] = b[1] * buf0 + b[5] * buf1 + b[9] * buf2 + b[13] * buf3;\n      a[2] = b[2] * buf0 + b[6] * buf1 + b[10] * buf2 + b[14] * buf3;\n      a[3] = b[3] * buf0 + b[7] * buf1 + b[11] * buf2 + b[15] * buf3;\n      a[4] = b[0] * buf4 + b[4] * buf5 + b[8] * buf6 + b[12] * buf7;\n      a[5] = b[1] * buf4 + b[5] * buf5 + b[9] * buf6 + b[13] * buf7;\n      a[6] = b[2] * buf4 + b[6] * buf5 + b[10] * buf6 + b[14] * buf7;\n      a[7] = b[3] * buf4 + b[7] * buf5 + b[11] * buf6 + b[15] * buf7;\n      a[8] = b[0] * buf8 + b[4] * buf9 + b[8] * buf10 + b[12] * buf11;\n      a[9] = b[1] * buf8 + b[5] * buf9 + b[9] * buf10 + b[13] * buf11;\n      a[10] = b[2] * buf8 + b[6] * buf9 + b[10] * buf10 + b[14] * buf11;\n      a[11] = b[3] * buf8 + b[7] * buf9 + b[11] * buf10 + b[15] * buf11;\n      a[12] = b[0] * buf12 + b[4] * buf13 + b[8] * buf14 + b[12] * buf15;\n      a[13] = b[1] * buf12 + b[5] * buf13 + b[9] * buf14 + b[13] * buf15;\n      a[14] = b[2] * buf12 + b[6] * buf13 + b[10] * buf14 + b[14] * buf15;\n      a[15] = b[3] * buf12 + b[7] * buf13 + b[11] * buf14 + b[15] * buf15;\n    }\n  }\n\n  static dotMat43(a, b, c) {\n    buf0 = b[0] * c[0] + b[4] * c[1] + b[8] * c[2];\n    buf1 = b[1] * c[0] + b[5] * c[1] + b[9] * c[2];\n    buf2 = b[2] * c[0] + b[6] * c[1] + b[10] * c[2];\n    buf3 = b[3] * c[0] + b[7] * c[1] + b[11] * c[2];\n    buf4 = b[0] * c[3] + b[4] * c[4] + b[8] * c[5];\n    buf5 = b[1] * c[3] + b[5] * c[4] + b[9] * c[5];\n    buf6 = b[2] * c[3] + b[6] * c[4] + b[10] * c[5];\n    buf7 = b[3] * c[3] + b[7] * c[4] + b[11] * c[5];\n    buf8 = b[0] * c[6] + b[4] * c[7] + b[8] * c[8];\n    buf9 = b[1] * c[6] + b[5] * c[7] + b[9] * c[8];\n    buf10 = b[2] * c[6] + b[6] * c[7] + b[10] * c[8];\n    buf11 = b[3] * c[6] + b[7] * c[7] + b[11] * c[8];\n    buf12 = b[0] * c[9] + b[4] * c[10] + b[8] * c[11] + b[12];\n    buf13 = b[1] * c[9] + b[5] * c[10] + b[9] * c[11] + b[13];\n    buf14 = b[2] * c[9] + b[6] * c[10] + b[10] * c[11] + b[14];\n    buf15 = b[3] * c[9] + b[7] * c[10] + b[11] * c[11] + b[15];\n    a[0] = buf0;\n    a[1] = buf1;\n    a[2] = buf2;\n    a[3] = buf3;\n    a[4] = buf4;\n    a[5] = buf5;\n    a[6] = buf6;\n    a[7] = buf7;\n    a[8] = buf8;\n    a[9] = buf9;\n    a[10] = buf10;\n    a[11] = buf11;\n    a[12] = buf12;\n    a[13] = buf13;\n    a[14] = buf14;\n    a[15] = buf15;\n  }\n\n  static getRotVector(target, angle) {\n    Mat43.getRotVector.call(this, target, angle);\n  }\n\n  static getInv(a, b) {\n    var det = b[0] * b[5] * b[10] * b[15] + b[0] * b[9] * b[14] * b[7] + b[0] * b[13] * b[6] * b[11] + b[4] * b[1] * b[14] * b[11] + b[4] * b[9] * b[2] * b[15] + b[4] * b[13] * b[10] * b[3] + b[8] * b[1] * b[6] * b[15] + b[8] * b[5] * b[14] * b[3] + b[8] * b[13] * b[2] * b[7] + b[12] * b[1] * b[10] * b[7] + b[12] * b[5] * b[2] * b[11] + b[12] * b[9] * b[6] * b[3] - b[0] * b[5] * b[14] * b[11] - b[0] * b[9] * b[6] * b[15] - b[0] * b[13] * b[10] * b[7] - b[4] * b[1] * b[10] * b[15] - b[4] * b[9] * b[14] * b[3] - b[4] * b[13] * b[2] * b[11] - b[8] * b[1] * b[14] * b[7] - b[8] * b[5] * b[2] * b[15] - b[8] * b[13] * b[6] * b[3] - b[12] * b[1] * b[6] * b[11] - b[12] * b[5] * b[10] * b[3] - b[12] * b[9] * b[2] * b[7];\n\n    if (Math.abs(det) < 0.000000000001) {\n      return;\n    }\n\n    det = 1 / det;\n    buf0 = b[0];\n    buf1 = b[1];\n    buf2 = b[2];\n    buf3 = b[3];\n    buf4 = b[4];\n    buf5 = b[5];\n    buf6 = b[6];\n    buf7 = b[7];\n    buf8 = b[8];\n    buf9 = b[9];\n    buf10 = b[10];\n    buf11 = b[11];\n    buf12 = b[12];\n    buf13 = b[13];\n    buf14 = b[14];\n    buf15 = b[15];\n    a[0] = (buf5 * buf10 * buf15 + buf9 * buf14 * buf7 + buf13 * buf6 * buf11 - buf5 * buf14 * buf11 - buf9 * buf6 * buf15 - buf13 * buf10 * buf7) * det;\n    a[4] = (buf4 * buf14 * buf11 + buf8 * buf6 * buf15 + buf12 * buf10 * buf7 - buf4 * buf10 * buf15 - buf8 * buf14 * buf7 - buf12 * buf6 * buf11) * det;\n    a[8] = (buf4 * buf9 * buf15 + buf8 * buf13 * buf7 + buf12 * buf5 * buf11 - buf4 * buf13 * buf11 - buf8 * buf5 * buf15 - buf12 * buf9 * buf7) * det;\n    a[12] = (buf4 * buf13 * buf10 + buf8 * buf5 * buf14 + buf12 * buf9 * buf6 - buf4 * buf9 * buf14 - buf8 * buf13 * buf6 - buf12 * buf5 * buf10) * det;\n    a[1] = (buf1 * buf14 * buf11 + buf9 * buf2 * buf15 + buf13 * buf10 * buf3 - buf1 * buf10 * buf15 - buf9 * buf14 * buf3 - buf13 * buf2 * buf11) * det;\n    a[5] = (buf0 * buf10 * buf15 + buf8 * buf14 * buf3 + buf12 * buf2 * buf11 - buf0 * buf14 * buf11 - buf8 * buf2 * buf15 - buf12 * buf10 * buf3) * det;\n    a[9] = (buf0 * buf13 * buf11 + buf8 * buf1 * buf15 + buf12 * buf9 * buf3 - buf0 * buf9 * buf15 - buf8 * buf13 * buf3 - buf12 * buf1 * buf11) * det;\n    a[13] = (buf0 * buf9 * buf14 + buf8 * buf13 * buf2 + buf12 * buf1 * buf10 - buf0 * buf13 * buf10 - buf8 * buf1 * buf14 - buf12 * buf9 * buf2) * det;\n    a[2] = (buf1 * buf6 * buf15 + buf5 * buf14 * buf3 + buf13 * buf2 * buf7 - buf1 * buf14 * buf7 - buf5 * buf2 * buf15 - buf13 * buf6 * buf3) * det;\n    a[6] = (buf0 * buf14 * buf7 + buf4 * buf2 * buf15 + buf12 * buf6 * buf3 - buf0 * buf6 * buf15 - buf4 * buf14 * buf3 - buf12 * buf2 * buf7) * det;\n    a[10] = (buf0 * buf5 * buf15 + buf4 * buf13 * buf3 + buf12 * buf1 * buf7 - buf0 * buf13 * buf7 - buf4 * buf1 * buf15 - buf12 * buf5 * buf3) * det;\n    a[14] = (buf0 * buf13 * buf6 + buf4 * buf1 * buf14 + buf12 * buf5 * buf2 - buf0 * buf5 * buf14 - buf4 * buf13 * buf2 - buf12 * buf1 * buf6) * det;\n    a[3] = (buf1 * buf10 * buf7 + buf5 * buf2 * buf11 + buf9 * buf6 * buf3 - buf1 * buf6 * buf11 - buf5 * buf10 * buf3 - buf9 * buf2 * buf7) * det;\n    a[7] = (buf0 * buf6 * buf11 + buf4 * buf10 * buf3 + buf8 * buf2 * buf7 - buf0 * buf10 * buf7 - buf4 * buf2 * buf11 - buf8 * buf6 * buf3) * det;\n    a[11] = (buf0 * buf9 * buf7 + buf4 * buf1 * buf11 + buf8 * buf5 * buf3 - buf0 * buf5 * buf11 - buf4 * buf9 * buf3 - buf8 * buf1 * buf7) * det;\n    a[15] = (buf0 * buf5 * buf10 + buf4 * buf9 * buf2 + buf8 * buf1 * buf6 - buf0 * buf9 * buf6 - buf4 * buf1 * buf10 - buf8 * buf5 * buf2) * det;\n  }\n\n}\n\n_defineProperty(Mat44, \"fromRotVector\", function (ret, r, x, y, z) {\n  var SIN = Math.sin(r);\n  var COS = Math.cos(r);\n  ret[0] = x * x * (1 - COS) + COS;\n  ret[4] = x * y * (1 - COS) - z * SIN;\n  ret[8] = z * x * (1 - COS) + y * SIN;\n  ret[1] = x * y * (1 - COS) + z * SIN;\n  ret[5] = y * y * (1 - COS) + COS;\n  ret[9] = y * z * (1 - COS) - x * SIN;\n  ret[2] = z * x * (1 - COS) - y * SIN;\n  ret[6] = y * z * (1 - COS) + x * SIN;\n  ret[10] = z * z * (1 - COS) + COS;\n  ret[3] = ret[7] = ret[11] = ret[12] = ret[13] = ret[14] = 0;\n  ret[15] = 1;\n});\n\n;\n\n(function () {\n  //プール\n  var classes = [Vec2, Vec3, Vec4, Mat33, Mat43, Mat44];\n\n  for (var i = 0; i < classes.length; i++) {\n    var ret = classes[i]; //プール\n\n    ret.poolIndex = 0;\n    ret.pool = [];\n\n    for (var j = 0; j < 256; j++) {\n      ret.pool.push(new ret());\n    }\n\n    ret.poolAlloc = function () {\n      this.poolIndex++; //if(this.poolIndex>128){\n      //\talert(this+ \"poolIndex leak!?\");\n      //}\n      //if(this.poolIndex>this.pool.length){\n      //\tfor(var i=0;i<16;i++){\n      //\t\tthis.pool.push(new this());\n      //\t}\n      //}\n\n      return this.pool[this.poolIndex - 1];\n    };\n\n    ret.poolFree = function (num) {\n      this.poolIndex -= num; //if(this.poolIndex<0){\n      //\talert(this+\"poolIndex okashii!\");\n      //}\n    };\n  }\n})();\n\nvar Vec2, Vec3, Vec4, Mat33, Mat43;\n\n//# sourceURL=webpack://hdrpaint/./src/lib/vector.js?");

/***/ }),

/***/ "./src/lib/watcher.js":
/*!****************************!*\
  !*** ./src/lib/watcher.js ***!
  \****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Watcher; }\n/* harmony export */ });\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"./src/lib/util.js\");\n//�ϐ��Ď�\n\n\nclass Watch {\n  constructor(variable_root, variable_name, callback) {\n    this.variable_root = variable_root;\n    this.variable_direction = variable_name.split(\".\");\n    this.callback = callback;\n    this.old_value = {};\n  }\n\n  getValue(n) {\n    //�Ď��Ώۂ̕ϐ��̒l���擾\n    var value = this.variable_root;\n    var v = this.variable_direction;\n\n    for (var j = 0; j < v.length - n; j++) {\n      value = value[v[j]];\n\n      if (value == undefined) {\n        value = null;\n        break;\n      }\n    }\n\n    return value;\n  }\n\n  setValue(value) {\n    //�Ď��ϐ��ɒl���Z�b�g����\n    var val = this.getValue(1); //�Ώۂ̕ϐ��̐e���擾\n\n    val[this.variable_direction[this.variable_direction.length - 1]] = value;\n  }\n\n  refresh() {\n    //�o�C���h���ꂽ�ϐ��̒l���m�[�h�����ɃZ�b�g\n    var value = this.getValue(0);\n\n    if (typeof value === 'object') {\n      value = JSON.stringify(value);\n    }\n\n    this.change_flg = this.old_value !== value;\n    this.old_value = value;\n  }\n\n}\n\nclass Watcher {\n  constructor() {\n    this.watches = [];\n  }\n\n  init() {//������&�o�C���h\n    //\t\tvar func =()=>{\n    //\t\t\tthis.refresh();\n    //\t\t\twindow.requestAnimationFrame(func);\n    //\t\t}\n    //\t\tfunc();\n  }\n\n  watch(variable_root, variable_name, func) {\n    //�Ď��ϐ���ǉ�\n    var watch = new Watch(variable_root, variable_name, func);\n    this.watches.push(watch);\n    return watch;\n  }\n\n  refresh() {\n    //�Ď��Ώۂ��`�F�b�N\n    this.watches.forEach(w => {\n      w.refresh();\n    });\n  }\n\n}\n\n//# sourceURL=webpack://hdrpaint/./src/lib/watcher.js?");

/***/ }),

/***/ "./src/lib/zip.js":
/*!************************!*\
  !*** ./src/lib/zip.js ***!
  \************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Zip; }\n/* harmony export */ });\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _datastream_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./datastream.js */ \"./src/lib/datastream.js\");\n/* harmony import */ var _deflate_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./deflate.js */ \"./src/lib/deflate.js\");\n/* harmony import */ var _zlib_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./zlib.js */ \"./src/lib/zlib.js\");\n\n\n\n\n\nvar calcCrc32 = function (array) {\n  //CRC32を計算する\n  var table = [];\n  var poly = 0xEDB88320;\n  var result = 0xFFFFFFFF; //create table\n\n  for (var i = 0; i < 256; i++) {\n    var u = i;\n\n    for (var j = 0; j < 8; j++) {\n      if (u & 0x1) u = u >>> 1 ^ poly;else u >>>= 1;\n    }\n\n    table.push(u >>> 0);\n  } //calculate\n\n\n  for (var i = 0; i < array.length; i++) result = (result >>> 8 ^ table[array[i] ^ result & 0xFF]) >>> 0;\n\n  return ~result >>> 0;\n};\n\nvar LOCAL_HEADER_SIZE = 30;\nvar CENTRAL_SIZE = 46;\nvar END_SIZE = 22;\nclass Zip {\n  static read(buffer) {\n    var ds = new _datastream_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](buffer);\n    var files = [];\n\n    while (1) {\n      //ローカルファイルヘッダ\n      var sig = ds.getUint32(true); //シグネチャ\n\n      if (sig !== 0x04034b50) {\n        break;\n      }\n\n      var file = {};\n      files.push(file);\n      ds.getUint16(true); //バージョン\n\n      ds.getUint16(true); //ビットフラグ\n\n      ds.getUint16(true); //圧縮メソッド\n\n      ds.getUint16(true); //最終変更時間\n\n      ds.getUint16(true); //最終変更日時\n\n      ds.getUint32(true); //CRC-32\n\n      var data_length = ds.getUint32(true); //圧縮サイズ\n\n      ds.getUint32(true); //非圧縮サイズ\n\n      var file_name_length = ds.getUint16(true); //ファイル名の長さ\n\n      ds.getUint16(0, true); //拡張フィールドの長さ\n\n      file.name = _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].utf8ToString(ds.getBytes(file_name_length)); //ファイル名\n\n      ds.fill(0x0, 0); //拡張フィールド\n\n      file.data = ds.getBytes(data_length); //ファイルデータ\n      //Data descriptor\n      //ds.setUint32(crc,true);//CRC-32\n      //ds.setUint32(filesize,true);//圧縮サイズ\n      //ds.setUint32(filesize,true);//非圧縮サイズ\n    }\n\n    return files;\n  }\n\n  static create(_files, compress) {\n    var files = [];\n    var total_size = 0;\n\n    if (compress == null) {\n      compress = 0;\n    }\n\n    for (var fi = 0; fi < _files.length; fi++) {\n      var file = {};\n      files.push(file);\n      file.name_utf8 = _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].stringToUtf8(_files[fi].name);\n      file.data = _files[fi].data;\n      file.offset = total_size;\n      file.crc = calcCrc32(file.data);\n      total_size += LOCAL_HEADER_SIZE + file.data.length + file.name_utf8.length;\n    }\n\n    total_size += CENTRAL_SIZE * files.length + END_SIZE;\n\n    for (var fi = 0; fi < files.length; fi++) {\n      total_size += files[fi].name_utf8.length;\n    }\n\n    var ds = new _datastream_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](total_size);\n    var offset = 0;\n\n    for (var fi = 0; fi < files.length; fi++) {\n      var file = files[fi]; //ローカルファイルヘッダ\n\n      ds.setUint32(0x04034b50, true); //シグネチャ\n\n      ds.setUint16(20, true); //バージョン\n\n      ds.setUint16(0x0, true); //ビットフラグ\n\n      ds.setUint16(compress, true); //圧縮メソッド\n\n      var compress_data = file.data;\n\n      if (compress === 8) {\n        compress_data = Array.from(_deflate_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].compress(file.data, 1));\n        file.compress_data_length = compress_data.length;\n      }\n\n      ds.setUint16(0x0, true); //最終変更時間\n\n      ds.setUint16(0x0, true); //最終変更日時\n\n      ds.setUint32(file.crc, true); //CRC-32\n\n      ds.setUint32(file.compress_data_length, true); //圧縮サイズ\n\n      ds.setUint32(file.data.length, true); //非圧縮サイズ\n\n      ds.setUint16(file.name_utf8.length, true); //ファイル名の長さ\n\n      ds.setUint16(0, true); //拡張フィールドの長さ\n\n      ds.setBytes(file.name_utf8); //ファイル名\n\n      ds.fill(0x0, 0); //拡張フィールド\n\n      var oldidx = ds.idx;\n      ds.setBytes(compress_data); //ファイルデータ\n      //var filesize=ds.idx-oldidx >>> 3;\n      //Data descriptor\n      //ds.setUint32(crc,true);//CRC-32\n      //ds.setUint32(filesize,true);//圧縮サイズ\n      //ds.setUint32(filesize,true);//非圧縮サイズ\n    }\n\n    var central_idx = ds.getByteIndex();\n\n    for (var fi = 0; fi < files.length; fi++) {\n      var file = files[fi]; //セントラルディレクトリエントリ\n\n      ds.setUint32(0x02014b50, true); //シグネチャ\n\n      ds.setUint8(20, true); //バージョン\n\n      ds.setUint8(10, true); //バージョン\n\n      ds.setUint16(20, true); //最小バージョン\n\n      ds.setUint16(0x0, true); //ビットフラグ\n\n      ds.setUint16(compress, true); //圧縮メソッド\n\n      ds.setUint16(0x0, true); //最終変更時間\n\n      ds.setUint16(0x0, true); //最終変更日時\n\n      ds.setUint32(file.crc, true); //CRC-32\n\n      ds.setUint32(file.compress_data_length, true); //圧縮サイズ\n\n      ds.setUint32(file.data.length, true); //非圧縮サイズ\n\n      ds.setUint16(file.name_utf8.length, true); //ファイル名の長さ\n\n      ds.setUint16(0, true); //拡張フィールドの長さ\n\n      ds.setUint16(0, true); //ファイルコメントの長さ\n\n      ds.setUint16(0, true); //ファイルが開始するディスク番号\n\n      ds.setUint16(0, true); //内部ファイル属性\n\n      ds.setUint32(0, true); //外部ファイル属性\n\n      ds.setUint32(offset, true); //ローカルファイルヘッダの相対オフセット\n\n      ds.setBytes(file.name_utf8); //ファイル名\n\n      ds.fill(0x0, 0); //拡張フィールド\n\n      ds.fill(0x0, 0); //ファイルコメント\n\n      offset += LOCAL_HEADER_SIZE + file.compress_data_length + file.name_utf8.length;\n    }\n\n    var central_size = ds.getByteIndex() - central_idx; //終端レコード\n\n    ds.setUint32(0x06054b50, true); //シグネチャ\n\n    ds.setUint16(0, true); //このディスクの数\n\n    ds.setUint16(0, true); //セントラルディレクトリが開始するディスク\n\n    ds.setUint16(files.length, true); //セントラルディレクトリレコードの数\n\n    ds.setUint16(files.length, true); //セントラルディレクトリレコードの合計数\n\n    ds.setUint32(central_size, true); //セントラルディレクトリレコードのサイズ\n\n    ds.setUint32(central_idx, true); //セントラルディレクトリの開始位置のオフセット\n\n    ds.setUint16(0, true); //コメント長さ\n\n    ds.setTextBuf(\"\"); //コメント\n\n    return ds.byteBuffer.buffer.slice(0, ds.idx >> 3); //return ds.byteBuffer;\n  }\n\n}\n\n//# sourceURL=webpack://hdrpaint/./src/lib/zip.js?");

/***/ }),

/***/ "./src/lib/zlib.js":
/*!*************************!*\
  !*** ./src/lib/zlib.js ***!
  \*************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Zlib; }\n/* harmony export */ });\n/* harmony import */ var _deflate_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./deflate.js */ \"./src/lib/deflate.js\");\n\n\nvar adler32 = function (data) {\n  //パリティ計算\n  var aa = 1,\n      bb = 0;\n  var len = data.length;\n\n  for (var ai = 0; ai < len;) {\n    var bmax = Math.min(5550, len - ai);\n\n    for (var bi = 0; bi < bmax; bi++, ai++) {\n      aa += data[ai];\n      bb += aa;\n    }\n\n    aa %= 65521;\n    bb %= 65521;\n  }\n\n  return bb * 65536 + aa;\n};\n\nclass Zlib {\n  constructor() {}\n\n  static compress(buffer, flg, block) {\n    var header = [];\n    header[0] = (7 << 4) + 8;\n    header[1] = 2 << 6;\n    header[1] += 31 - ((header[0] << 8) + header[1]) % 31;\n    var body = Array.from(_deflate_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].compress(buffer, flg, block)); //var check = Deflate.expand(new Uint8Array(body).buffer);\n\n    var ad = adler32(buffer);\n    var footer = new DataView(new ArrayBuffer(4));\n    footer.setUint32(0, ad);\n    footer = Array.from(new Uint8Array(footer.buffer));\n    return header.concat(body).concat(Array.from(footer));\n  }\n\n  static expand(buffer, offset, length) {\n    var dv = new DataView(buffer);\n    var c = dv.getUint16(0);\n    var adl = dv.getUint32(offset + (length - 4));\n    var data = _deflate_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].expand(buffer, offset + 2, length - 6);\n    var ad2 = adler32(data);\n    return data;\n  }\n\n}\n\n//# sourceURL=webpack://hdrpaint/./src/lib/zlib.js?");

/***/ }),

/***/ "./src/main.js":
/*!*********************!*\
  !*** ./src/main.js ***!
  \*********************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _lib_slider_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./lib/slider.js */ \"./src/lib/slider.js\");\n/* harmony import */ var _lib_geono_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./lib/geono.js */ \"./src/lib/geono.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _commandlog_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./commandlog.js */ \"./src/commandlog.js\");\n/* harmony import */ var _file_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./file.js */ \"./src/file.js\");\n/* harmony import */ var _redraw_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./redraw.js */ \"./src/redraw.js\");\n/* harmony import */ var _penfunc_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./penfunc.js */ \"./src/penfunc.js\");\n/* harmony import */ var _brush_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./brush.js */ \"./src/brush.js\");\n/* harmony import */ var _penpoint_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./penpoint.js */ \"./src/penpoint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./layer.js */ \"./src/layer.js\");\n/* harmony import */ var _lib_util_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./lib/util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _lib_colorpickerhdr_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./lib/colorpickerhdr.js */ \"./src/lib/colorpickerhdr.js\");\n/* harmony import */ var _lib_colorselector_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./lib/colorselector.js */ \"./src/lib/colorselector.js\");\n/* harmony import */ var _lib_binder_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./lib/binder.js */ \"./src/lib/binder.js\");\n/* harmony import */ var _lib_watcher_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./lib/watcher.js */ \"./src/lib/watcher.js\");\n/* harmony import */ var _command_copy_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./command/copy.js */ \"./src/command/copy.js\");\n/* harmony import */ var _command_paste_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./command/paste.js */ \"./src/command/paste.js\");\n/* harmony import */ var _command_drawLine_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./command/drawLine.js */ \"./src/command/drawLine.js\");\n/* harmony import */ var _command_changeLayerAttribute_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./command/changeLayerAttribute.js */ \"./src/command/changeLayerAttribute.js\");\n/* harmony import */ var _command_changeModifierAttribute_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./command/changeModifierAttribute.js */ \"./src/command/changeModifierAttribute.js\");\n/* harmony import */ var _command_clear_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./command/clear.js */ \"./src/command/clear.js\");\n/* harmony import */ var _command_composite_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./command/composite.js */ \"./src/command/composite.js\");\n/* harmony import */ var _command_createNewLayer_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./command/createNewLayer.js */ \"./src/command/createNewLayer.js\");\n/* harmony import */ var _command_copylayer_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./command/copylayer.js */ \"./src/command/copylayer.js\");\n/* harmony import */ var _command_createmodifier_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./command/createmodifier.js */ \"./src/command/createmodifier.js\");\n/* harmony import */ var _command_deleteLayer_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./command/deleteLayer.js */ \"./src/command/deleteLayer.js\");\n/* harmony import */ var _command_fill_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./command/fill.js */ \"./src/command/fill.js\");\n/* harmony import */ var _command_joinLayer_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./command/joinLayer.js */ \"./src/command/joinLayer.js\");\n/* harmony import */ var _command_loadImage_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./command/loadImage.js */ \"./src/command/loadImage.js\");\n/* harmony import */ var _command_moveLayer_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./command/moveLayer.js */ \"./src/command/moveLayer.js\");\n/* harmony import */ var _command_multiCommand_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./command/multiCommand.js */ \"./src/command/multiCommand.js\");\n/* harmony import */ var _command_resizeCanvas_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./command/resizeCanvas.js */ \"./src/command/resizeCanvas.js\");\n/* harmony import */ var _command_resizeLayer_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./command/resizeLayer.js */ \"./src/command/resizeLayer.js\");\n/* harmony import */ var _command_translate_js__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./command/translate.js */ \"./src/command/translate.js\");\n/* harmony import */ var _blendfuncs_normal_js__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./blendfuncs/normal.js */ \"./src/blendfuncs/normal.js\");\n/* harmony import */ var _blendfuncs_mul_js__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./blendfuncs/mul.js */ \"./src/blendfuncs/mul.js\");\n/* harmony import */ var _blendfuncs_add_js__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./blendfuncs/add.js */ \"./src/blendfuncs/add.js\");\n/* harmony import */ var _blendfuncs_sub_js__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./blendfuncs/sub.js */ \"./src/blendfuncs/sub.js\");\n/* harmony import */ var _blendfuncs_transmit_js__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./blendfuncs/transmit.js */ \"./src/blendfuncs/transmit.js\");\n/* harmony import */ var _modifier_grayscale_js__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ./modifier/grayscale.js */ \"./src/modifier/grayscale.js\");\n/* harmony import */ var _modifier_shift_js__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ./modifier/shift.js */ \"./src/modifier/shift.js\");\n/* harmony import */ var _modifier_blur_js__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ./modifier/blur.js */ \"./src/modifier/blur.js\");\n/* harmony import */ var _modifier_gradient_js__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ./modifier/gradient.js */ \"./src/modifier/gradient.js\");\n/* harmony import */ var _modifier_colormap_js__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ./modifier/colormap.js */ \"./src/modifier/colormap.js\");\n/* harmony import */ var _modifier_noise_js__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ./modifier/noise.js */ \"./src/modifier/noise.js\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar binder = new _lib_binder_js__WEBPACK_IMPORTED_MODULE_15__[\"default\"]();\nwindow.binder = binder;\nwindow.Redraw = _redraw_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"];\nwindow.inputs = [];\nvar shortcuts = [];\nwindow.pen_log = null;\nwindow.pen_func = null;\nwindow.bloomed_img = null;\nwindow.bloom_img = null;\nwindow.preview = null;\nwindow.preview_ctx = null;\nwindow.preview_ctx_imagedata = null; //コマンド\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n //合成function\n\n\n\n\n\n //モデファイア\n\n\n\n\n\n\n\nwindow.Hdrpaint = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"];\nwindow.Brush = _brush_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"];\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].inputs = inputs;\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc = {};\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.draw_col = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.background_color = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\n_lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.set(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.background_color, 1, 1, 1, 1);\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.scale = 100;\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.canvas_pos = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\nvar canvas_field; //最初に全コントロールを配列に入れる\n\nvar elements = Array.prototype.slice.call(document.getElementsByTagName(\"input\"));\nelements = elements.concat(Array.prototype.slice.call(document.getElementsByTagName(\"select\")));\nelements = elements.concat(Array.prototype.slice.call(document.getElementsByTagName(\"button\")));\n\nfor (var i = 0; i < elements.length; i++) {\n  var input = elements[i];\n  var id = input.getAttribute(\"id\");\n  inputs[id] = elements[i];\n  var input = inputs[id];\n\n  if (input.getAttribute(\"shortcut\")) {\n    var shortcut = {};\n    var ka = input.getAttribute(\"shortcut\");\n\n    if (ka.length === 1) {\n      ka = ka.charCodeAt(0);\n    }\n\n    shortcut.key = ka;\n    shortcut.command = input;\n    shortcuts.push(shortcut);\n  }\n}\n\nvar getPos = function (e) {\n  var rect = preview.getBoundingClientRect();\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[0] = e.clientX - rect.left - 1;\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[1] = e.clientY - rect.top - 1;\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[0] *= 100 / _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.scale;\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[1] *= 100 / _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.scale;\n};\n\nvar onloadfunc = function (e) {\n  if (_lib_util_js__WEBPACK_IMPORTED_MODULE_12__[\"default\"].getLoadingCount() > 0) {\n    window.setTimeout(onloadfunc, 1000);\n    return;\n  }\n\n  preview = document.getElementById('preview');\n  preview_ctx = preview.getContext('2d');\n  preview_ctx_imagedata = preview_ctx.createImageData(preview.width, preview.height);\n  window.addEventListener(\"beforeunload\", function (event) {\n    if (_commandlog_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].command_logs.length > 1) {\n      event.returnValue = '移動前に表示する確認のメッセージ';\n      return false;\n    }\n\n    return true;\n  }); //blendfuncセット\n\n  var layer_blendfunc = document.querySelector(\"#layer_blendfunc\");\n\n  while (layer_blendfunc.firstChild) {\n    layer_blendfunc.removeChild(layer_blendfunc.firstChild);\n  }\n\n  for (var i = 0; i < _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].blendfuncsname.length; i++) {\n    var name = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].blendfuncsname[i];\n    var option = document.createElement(\"option\");\n    option.value = name;\n    _lib_util_js__WEBPACK_IMPORTED_MODULE_12__[\"default\"].setText(option, name);\n    layer_blendfunc.appendChild(option);\n  } //ダイアログ閉じる処理\n  //document.querySelector(\".dialog_parent\").addEventListener(\"click\",function(e){\n  //\tif(this !== e.target)return false;\n  //\tHdrpaint.closeDialog();\n  //});\n\n\n  var keys = Object.keys(inputs);\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var input = inputs[key];\n\n    if (input.getAttribute(\"title\") === null) {\n      input.setAttribute(\"title\", key);\n    }\n  }\n\n  var rag = null;\n  var absolute = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\n\n  var drawfunc = function (e) {\n    //描画関数\n    var x = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[0];\n    var y = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[1];\n\n    if (e.buttons & 2 || _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool === \"color_picker\") {\n      //カラーピッカー\n      var img = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].root_layer.img;\n\n      if (inputs[\"selected_layer_only\"].checked) {\n        img = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.img;\n      }\n\n      if (x < 0 || x >= img.width || y < 0 || y > img.height) {} else {\n        var data = img.data;\n        var idx = ((y | 0) * img.width + (x | 0)) * 4;\n        selectorhdr.R_txt.value = data[idx];\n        selectorhdr.G_txt.value = data[idx + 1];\n        selectorhdr.B_txt.value = data[idx + 2];\n        selectorhdr.A_txt.value = data[idx + 3];\n        _lib_util_js__WEBPACK_IMPORTED_MODULE_12__[\"default\"].fireEvent(selectorhdr.A_txt, \"change\");\n      }\n\n      return;\n    }\n\n    if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool === \"rectangle\") {\n      if (!(e.buttons & 1)) {\n        return;\n      } //矩形選択時\n\n\n      var rectangle = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select_rectangle;\n      var x2 = Math.floor(x);\n      var y2 = Math.floor(y);\n\n      if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].mode === \"areamove\") {\n        rectangle.x += -drag_start[0] + x2;\n        rectangle.y += -drag_start[1] + y2;\n        drag_start[0] = x2;\n        drag_start[1] = y2;\n      } else {\n        if (!rectangle) {\n          rectangle = {\n            x: 0,\n            y: 0,\n            w: 0,\n            h: 0\n          };\n          _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select_rectangle = rectangle;\n        }\n\n        rectangle.x = Math.min(drag_start[0], x2);\n        rectangle.y = Math.min(drag_start[1], y2);\n        rectangle.w = Math.abs(drag_start[0] - x2);\n        rectangle.h = Math.abs(drag_start[1] - y2);\n      }\n\n      var rect = document.querySelector(\".select_rectangle\");\n      var doc = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc;\n      rect.style.left = rectangle.x + doc.canvas_pos[0] + \"px\";\n      rect.style.top = rectangle.y + doc.canvas_pos[1] + \"px\";\n      rect.style.width = rectangle.w + \"px\";\n      rect.style.height = rectangle.h + \"px\";\n      rect.style.display = \"inline-block\";\n    } else if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool === \"pen\") {\n      //inputs[\"pen\"].checked){\n      //ペンのとき\n      if (!pen_log) return;\n      var point = new _penpoint_js__WEBPACK_IMPORTED_MODULE_10__[\"default\"]();\n      point.pos[0] = x;\n      point.pos[1] = y;\n\n      if (e.buttons & 1) {\n        if (e.pointerType === \"mouse\") {\n          point.pressure = 1;\n        } else {\n          point.pressure = e.pressure;\n        }\n      } else {\n        point.pressure = 0;\n      }\n\n      var points = pen_log.obj.param.points; //今回座標をパスに追加\n\n      point.time = Date.now();\n      points.push(point);\n\n      if (inputs[\"stroke_correction\"].checked) {\n        if (points.length >= 3 && pen_func.idx < points.length - 2) {\n          var buf = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(buf, points[points.length - 2].pos, points[points.length - 3].pos);\n          var a = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar(buf);\n\n          if (a > 20) {\n            _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.norm(buf);\n            _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mul(buf, buf, a - 20);\n          }\n\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.add(points[points.length - 2].pos, points[points.length - 3].pos, buf);\n        }\n      }\n\n      if (!(e.buttons & 1)) {\n        //描画前ポイントを補正\n        var points = pen_log.obj.param.points;\n\n        if (pen_func.idx + 1 < points.length) {\n          var len = points.length - (pen_func.idx + 1);\n          var a = points[pen_func.idx].pressure;\n          var b = points[points.length - 1].pressure;\n\n          for (var pi = pen_func.idx + 1; pi < points.length; pi++) {\n            var r = (pi - pen_func.idx) / len;\n            points[pi].pressure = a + (b - a) * r;\n          }\n        }\n      }\n\n      if (!(e.buttons & 1)) {\n        pen_func.end();\n        point.pressure = 0;\n        pen_log = null;\n      }\n\n      pen_func.actualDraw();\n    } else if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool === \"translate\") {\n      //移動のとき\n      if (e.buttons & 1 && pen_log) {\n        var oldx = pen_log.obj.param.x;\n        var oldy = pen_log.obj.param.y;\n        x = (x | 0) - drag_start[0];\n        y = (y | 0) - drag_start[1]; //一旦元の座標に戻してから再度移動させる\n\n        pen_log.obj.param.x = x - oldx;\n        pen_log.obj.param.y = y - oldy;\n        pen_log.obj.func();\n        pen_log.obj.param.x = x;\n        pen_log.obj.param.y = y;\n        pen_log.refreshLabel(); //CommandLog.appendOption();\n      }\n\n      if (!(e.buttons & 1)) {\n        pen_log = null;\n      }\n    }\n  };\n\n  inputs[\"background_color\"].addEventListener(\"change\", function (e) {\n    var sp = this.value.split(\",\");\n    var rgb = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.background_color;\n    rgb[0] = Number(sp[0]);\n    rgb[1] = Number(sp[1]);\n    rgb[2] = Number(sp[2]);\n    rgb[3] = Number(sp[3]);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].root_layer.composite();\n  });\n  window.addEventListener(\"pointerup\", function (e) {\n    getPos(e);\n\n    if (pen_log) {\n      drawfunc(e);\n      e.preventDefault();\n    }\n\n    _layer_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].enableRefreshThumbnail = true;\n  });\n  var drag_start = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\n  var canvas_field = document.querySelector(\"#canvas_field\");\n  canvas_field.addEventListener(\"pointermove\", function (e) {\n    getPos(e); //Redraw.refreshPreviewStatus(e);\n\n    if (e.buttons) {\n      drawfunc(e);\n      e.preventDefault();\n    }\n  });\n  preview.addEventListener(\"contextmenu\", function (e) {\n    event.preventDefault();\n  }, false);\n  canvas_field.addEventListener(\"pointerdown\", function (e) {\n    if (e.buttons & 4) {\n      //キャンバス移動\n      oldpos[0] = e.pageX;\n      oldpos[1] = e.pageY;\n      e.preventDefault();\n    }\n\n    getPos(e);\n    var x = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[0];\n    var y = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[1];\n    drag_start[0] = x;\n    drag_start[1] = y;\n    _layer_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].enableRefreshThumbnail = false;\n\n    if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer === null) {\n      return;\n    }\n\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].mode = \"\";\n\n    if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool === \"rectangle\" && e.buttons & 1) {\n      var rectangle = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select_rectangle;\n      x = Math.floor(x);\n      y = Math.floor(y);\n\n      if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select_rectangle) {\n        if (x >= rectangle.x && x < rectangle.x + rectangle.w && y >= rectangle.y && y < rectangle.y + rectangle.h) {\n          //選択領域内で押下された場合は移動モードにする\n          _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].mode = \"areamove\";\n          return;\n        }\n      }\n\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].mode = \"areaselect\";\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select_rectangle = null;\n      var rect = document.querySelector(\".select_rectangle\");\n      rect.style.display = \"none\";\n      return;\n    } else if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool === \"fill\" && e.buttons & 1) {\n      if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.type === 1) {\n        return;\n      } //塗りつぶし\n\n\n      var joined_img = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].root_layer.img;\n\n      if (x < 0 || x >= joined_img.width || y < 0 || y >= joined_img.height) {\n        //範囲外は無視\n        return;\n      }\n\n      var layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer; //Hdrpaint.selected_layer.getAbsolutePosition(absolute);\n      //x -= absolute[0];\n      //y -= absolute[1];\n\n      if (x < 0 || x >= layer.img.width || y < 0 || y >= layer.img.height) {\n        //範囲外は無視\n        return;\n      }\n\n      var color = new Float32Array(4);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.copy(color, _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].color);\n      var flg_active_layer_only = inputs[\"selected_layer_only\"].checked;\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"fill\", {\n        \"layer_id\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.id,\n        \"x\": x,\n        \"y\": y,\n        \"color\": color,\n        \"is_layer\": flg_active_layer_only\n      });\n    } else if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool === \"translate\" && e.buttons & 1) {\n      //レイヤ位置移動\n      drag_start[0] = x | 0;\n      drag_start[1] = y | 0;\n      var layer_id = -1; //全レイヤ移動\n\n      var flg_active_layer_only = inputs[\"selected_layer_only\"].checked; //if(flg_active_layer_only){\n      //アクティブレイヤ\n\n      layer_id = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.id; //}\n\n      pen_log = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"translateLayer\", {\n        \"layer_id\": layer_id,\n        \"x\": 0,\n        \"y\": 0\n      }, {\n        \"x\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.position[0],\n        \"y\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.position[1]\n      }, 1);\n    } else if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool === \"pen\" && e.buttons & 1) {\n      //ペンもしくは消しゴム\n      if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.type !== 0) {\n        //通常レイヤ以外は無効\n        return;\n      }\n\n      if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.mask_alpha && inputs[\"eraser\"].checked) {\n        //アルファマスクありで消しゴムの場合無視\n        return;\n      } //ペン状態取得\n\n\n      var param = {};\n      _brush_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].setParam(param);\n      param.alpha_mask = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.mask_alpha;\n      param.points = [];\n      param.layer_id = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.id;\n      pen_log = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"brush\", param);\n\n      if (pen_log) {\n        pen_func = new _penfunc_js__WEBPACK_IMPORTED_MODULE_8__[\"default\"]();\n        pen_func.pen_log = pen_log;\n\n        if (inputs[\"stroke_correction\"].checked) {\n          pen_func.ragtime = 40;\n        } else {\n          pen_func.ragtime = 18;\n        }\n\n        drawfunc(e);\n      }\n    }\n\n    drawfunc(e);\n  }, false);\n  inputs[\"history\"].addEventListener('change', function (event) {\n    var index = this.selectedIndex;\n    var option = this.options[index];\n    _commandlog_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].moveLog(parseInt(option.value));\n  });\n  var ctrlkey;\n  document.addEventListener('keyup', function (event) {\n    if (event.keyCode == 17) {\n      ctrlkey = false;\n    }\n\n    switch (event.keyCode) {\n      case 81:\n        //q\n        if (old_tool) {\n          _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool = old_tool;\n          old_tool = null;\n        }\n\n        break;\n      //case 32://space\n\n      case 87:\n        //w\n        //flg_active_layer_only=false;\n        _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer_only = false;\n      //\tinputs[\"selected_layer_only\"].checked=false;\n      //\tUtil.fireEvent(inputs[\"selected_layer_only\"],\"change\");\n    }\n  });\n  var old_tool = null;\n  document.addEventListener('keydown', async function (event) {\n    if (event.ctrlKey) {\n      ctrlkey = true;\n    }\n\n    var keycode = event.keyCode;\n\n    if (!event.shiftKey && keycode <= 96 && keycode >= 65) {\n      keycode += 32;\n    } //キーショートカット\n\n\n    if (event.target.tagName === \"INPUT\") {\n      if (event.target.type === \"text\") {\n        return;\n      }\n    }\n\n    var shortcut = shortcuts.find(a => {\n      return a.key === keycode;\n    });\n\n    if (shortcut) {\n      var command = shortcut.command;\n\n      if (command.nodeName === \"INPUT\") {\n        if (command.type === \"checkbox\" || command.type === \"radio\") {\n          command.checked = true;\n        }\n\n        _lib_util_js__WEBPACK_IMPORTED_MODULE_12__[\"default\"].fireEvent(command, \"change\");\n      }\n\n      return;\n    }\n\n    for (var bi = 0; bi < _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].brushes.length; bi++) {\n      var brush = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].brushes[bi];\n      if (!brush.shortcut) continue;\n      var shortcut = brush.shortcut.charCodeAt(0);\n\n      if (shortcut === keycode) {\n        brush.select();\n        return;\n      }\n    }\n\n    switch (keycode) {\n      case 113:\n        //q\n        if (!old_tool) {\n          old_tool = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool;\n        }\n\n        _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool = \"color_picker\";\n        break;\n\n      case 82:\n        //R\n        _redraw_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].compositeAll();\n        break;\n\n      case 99:\n        //c\n        if (event.ctrlKey) {\n          //コピー\n          var range = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getSelectArea();\n          var src_layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer;\n          var img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"](range.w, range.h);\n          _lib_img_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].copy(img, 0, 0, src_layer.img, range.x, range.y, range.w, range.h);\n          _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].clipboard = img;\n        }\n\n        break;\n\n      case 118 - 32:\n        //V\n        //クリップボードからペースト\n        navigator.clipboard.read().then(async data => {\n          if (data.length === 0) return;\n\n          for (let i = 0; i < data[0].types.length; i++) {\n            const blob = await data[0].getType(\"image/png\");\n            if (!blob) break;\n            var file = new File([blob], \"paste.png\", {\n              type: \"image/png\"\n            }); //var imageFile = data.getAsFile();\n\n            _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].loadImageFile_(file);\n            break;\n          }\n        }); //var imageFile = data.getAsFile();\n        //Hdrpaint.loadImageFile_(imageFile);\n\n        event.preventDefault();\n        break;\n\n      case 118:\n        //v\n        if (event.ctrlKey) {\n          //ペースト\n          var data = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getPosition();\n          _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"paste\", {\n            \"position\": data.position,\n            \"parent\": data.parent_layer.id\n          });\n        }\n\n        break;\n\n      case 120:\n        //x\n        if (event.ctrlKey) {\n          //カット\n          var src_layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer;\n          var range = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getSelectArea();\n          var img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"](range.w, range.h);\n          _lib_img_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].copy(img, 0, 0, src_layer.img, range.x, range.y, range.w, range.h);\n          _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].clipboard = img;\n          var data = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getPosition();\n          var rectangle = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getSelectArea(); //Hdrpaint.executeCommand(\"copy\",{\"position\":data.position,\"parent\":data.parent_layer.id,\"src_layer_id\":Hdrpaint.selected_layer.id,range:rectangle});\n          //選択範囲をクリア\n\n          _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"clear\", {\n            \"layer_id\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.id,\n            \"range\": range\n          });\n        }\n\n        break;\n\n      case 122 - 32:\n        //Z\n        if (event.ctrlKey) {\n          //リドゥ\n          _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redo();\n        }\n\n        event.preventDefault();\n        break;\n\n      case 122:\n        //z\n        if (event.ctrlKey) {\n          if (event.shiftKey) {\n            //リドゥ\n            _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redo();\n          } else {\n            //アンドゥ\n            _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].undo();\n          }\n        }\n\n        event.preventDefault();\n        break;\n\n      case 46:\n        //delete\n        if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.type !== 0) {\n          //通常レイヤ以外は無視\n          break;\n        }\n\n        var rectangle = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getSelectArea(); //選択範囲をクリア\n\n        _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"clear\", {\n          \"layer_id\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.id,\n          range: rectangle\n        });\n        break;\n\n      case 119:\n        //w\n        _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer_only = true;\n        break;\n    }\n  });\n\n  window.changeGamma = function (arg) {\n    _redraw_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].refreshPreview(2);\n    _layer_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].eachLayers(function (layer) {\n      layer.registRefreshThumbnail();\n    });\n  };\n\n  var resizeCanvas = function () {\n    var width = parseInt(inputs[\"canvas_width\"].value);\n    var height = parseInt(inputs[\"canvas_height\"].value);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"resizeCanvas\", {\n      \"width\": width,\n      \"height\": height\n    });\n  };\n\n  inputs[\"canvas_width\"].addEventListener(\"change\", resizeCanvas);\n  inputs[\"canvas_height\"].addEventListener(\"change\", resizeCanvas);\n  inputs[\"btn_resize_layer\"].addEventListener(\"click\", function (e) {\n    var width = parseInt(preview.width);\n    var height = parseInt(preview.height);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"resizeLayer\", {\n      \"layer_id\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.id,\n      \"width\": width,\n      \"height\": height\n    });\n  });\n  inputs[\"btn_resize_layers\"].addEventListener(\"click\", function (e) {\n    var width = parseInt(preview.width);\n    var height = parseInt(preview.height);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"resizeLayer\", {\n      \"layer_id\": -1,\n      \"width\": width,\n      \"height\": height\n    });\n  });\n  inputs[\"open_layer\"].addEventListener(\"change\", function (e) {\n    var file = this.files[0];\n\n    if (file) {\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].loadImageFile_(file);\n    }\n\n    this.value = null;\n  });\n  document.getElementById(\"open_hpd\").addEventListener(\"click\", function (e) {\n    var file_hpd = inputs['file_hpd'];\n\n    file_hpd.onchange = function () {\n      var file = file_hpd.files[0];\n      _file_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].loadHpd(file); //\t\tUtil.loadBinary(file,function(buffer){\n      //\t\t\tloadHpd(buffer);\n      //\t\t\tvar log =CommandLog.createLog(\"loadDocumentFile\",{\"file\":file.name});\n      //\t\t\tCommandLog.appendOption(log);\n      //\t\t});\n\n      file_hpd.value = null;\n    };\n\n    file_hpd.click();\n    e.preventDefault();\n    return false;\n  });\n  document.getElementById(\"add_brush\").addEventListener(\"click\", function (e) {\n    var file_hpd = inputs['file_hpd'];\n\n    file_hpd.onchange = function () {\n      var file = file_hpd.files[0];\n      _lib_util_js__WEBPACK_IMPORTED_MODULE_12__[\"default\"].loadBinary(file, function (buffer) {\n        addBrush(buffer);\n      });\n      file_hpd.value = null;\n    };\n\n    file_hpd.click();\n    e.preventDefault();\n    return false;\n  });\n  inputs[\"down_layer\"].addEventListener(\"click\", function (e) {\n    if (!_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer) {\n      return;\n    }\n\n    var parent_layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.parent;\n    var layers = parent_layer.children;\n    var position = layers.indexOf(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer);\n\n    if (position <= 0) {\n      return;\n    }\n\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"moveLayer\", {\n      \"layer_id\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.id,\n      \"parent_layer_id\": parent_layer.id,\n      \"position\": position - 1\n    });\n  });\n  inputs[\"up_layer\"].addEventListener(\"click\", function (e) {\n    var parent_layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.parent;\n    var layers = parent_layer.children;\n    var position = layers.indexOf(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer);\n\n    if (position + 1 >= layers.length) {\n      return;\n    }\n\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"moveLayer\", {\n      \"layer_id\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.id,\n      \"parent_layer_id\": parent_layer.id,\n      \"position\": position + 1\n    });\n  }); //レイヤ結合ボタン押下時\n\n  inputs[\"join_layer\"].addEventListener(\"click\", function (e) {\n    if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.type === 1) {\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"composite\", {\n        \"layer_id\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.id\n      });\n      return;\n    }\n\n    var parent_layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.parent;\n    var position = parent_layer.children.indexOf(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer);\n\n    if (position === 0) {\n      return;\n    }\n\n    if (parent_layer.children[position - 1].type === 1) {\n      return;\n    }\n\n    var id2 = parent_layer.children[position - 1].id;\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"joinLayer\", {\n      \"layer_id\": id2,\n      \"layer_id2\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.id\n    });\n  });\n  inputs[\"delete_layer\"].addEventListener(\"click\", function (e) {\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"deleteLayer\", {\n      \"layer_id\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.id\n    });\n  });\n  var oldpos = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\n  canvas_field = document.getElementById(\"canvas_field\");\n  var canvas_area = document.getElementById(\"canvas_area\"); //canvas_area.addEventListener(\"paste\", function(e){\n  //\t//navigator.clipboard.write(data);\n  //\t//if(Hdrpaint.floating_layer){\n  //\t//\tvar data =Hdrpaint.getPosition();\n  //\t//\tHdrpaint.executeCommand(\"paste\",{\"position\":data.position,\"parent\":data.parent_layer.id});\n  //\t//}else{\n  //\t//\n  //\t//\n  //\t\tvar data =null;\n  //\t\tfor(var i=0;i<navigator.clipboard.types.length;i++){\n  //\t\t\tif(navigator.clipboard.types[i] ===\"Files\"){\n  //\t\t\t\tdata = e.clipboardData.items[i];\n  //\t\t\t\tbreak;\n  //\t\t\t}\n  //\t\t}\n  //\t\tif(!data){\n  //\t\t\treturn true;\n  //\t\t}\n  //\t\t\n  //\t\tvar imageFile = data.getAsFile();\n  //\t\tHdrpaint.loadImageFile_(imageFile);\n  //\t//}\n  //});\n\n  canvas_area.addEventListener(\"copy\", function (e) {\n    //OSのクリップボードにSDR結合画像をコピー\n    const selection = document.getSelection();\n    var url = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].root_layer.img.toBlob(blob => {\n      let data = [new ClipboardItem({\n        [blob.type]: blob\n      })];\n      navigator.clipboard.write(data);\n    }, \"image/png\");\n    event.preventDefault();\n  }); //レイヤパラメータコントロール変更時反映\n\n  document.querySelector(\"#layer_param\").addEventListener(\"change\", function (e) {\n    var input = e.target;\n\n    if (!_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer) {\n      return;\n    }\n\n    if (!input) {\n      return;\n    }\n\n    var layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer;\n    var member = input.id.replace(\"layer_\", \"\");\n\n    if (input.getAttribute(\"type\") === \"radio\") {\n      member = input.name;\n    }\n\n    if (member === \"\") {\n      member = input.title;\n    }\n\n    var value;\n\n    if (input.getAttribute(\"type\") === \"checkbox\") {\n      value = input.checked;\n    } else {\n      value = input.value;\n    }\n\n    if (input.hasAttribute(\"number\")) {\n      value = Number(value);\n    }\n\n    switch (member) {\n      case \"width\":\n      case \"height\":\n        var width = parseInt(inputs[\"layer_width\"].value);\n        var height = parseInt(inputs[\"layer_height\"].value);\n        _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"resizeLayer\", {\n          \"layer_id\": layer.id,\n          \"width\": width,\n          \"height\": height\n        });\n        break;\n\n      case \"x\":\n      case \"y\":\n        var x = parseInt(inputs[\"layer_x\"].value);\n        var y = parseInt(inputs[\"layer_y\"].value);\n        x -= layer.position[0];\n        y -= layer.position[1];\n        _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"translateLayer\", {\n          \"layer_id\": layer.id,\n          \"x\": x,\n          \"y\": y\n        });\n        break;\n\n      default:\n        _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"changeLayerAttribute\", {\n          \"layer_id\": layer.id,\n          \"name\": member,\n          \"value\": value\n        });\n    }\n  });\n\n  function arrayToBase64(array) {\n    return btoa(String.fromCharCode(...array));\n  }\n\n  function base64ToArray(base64) {\n    var binary = atob(base64);\n    var len = binary.length;\n    var bytes = new Uint8Array(len);\n\n    for (var i = 0; i < len; i++) {\n      bytes[i] = binary.charCodeAt(i);\n    }\n\n    return bytes;\n  }\n\n  function dataURIConverter(dataURI) {\n    // base64/URLEncodedデータを文字列としてバイナリデータに変換する\n    var buffer = base64ToArray(dataURI.split(',')[1]); // mimetypeを抜き出す\n\n    var mimeType = dataURI.split(',')[0].split(':')[1].split(';')[0]; // 第一引数は配列で渡し、Fileオブジェクトを返す。\n\n    return new File([buffer], 'ファイル名', {\n      type: mimeType\n    });\n  }\n\n  canvas_field.addEventListener(\"pointermove\", function (e) {\n    if (e.buttons & 4) {\n      //中ボタンドラッグでキャンバス移動\n      //c.scrollLeft-=e.pageX-oldpos[0];\n      //c.scrollTop-=e.pageY-oldpos[1];\n      var doc = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc;\n      doc.canvas_pos[0] += e.pageX - oldpos[0];\n      doc.canvas_pos[1] += e.pageY - oldpos[1];\n      var c = document.getElementById(\"canvas_field\");\n      var spacer = document.getElementById(\"spcaer\");\n\n      if (doc.canvas_pos[0] < 0) {\n        c.scrollLeft -= doc.canvas_pos[0];\n        doc.canvas_pos[0] = 0;\n      }\n\n      if (doc.canvas_pos[1] < 0) {\n        doc.canvas_pos[1] = 0;\n      }\n\n      preview.style.left = doc.canvas_pos[0] + \"px\";\n      preview.style.top = doc.canvas_pos[1] + \"px\";\n      oldpos[0] = e.pageX;\n      oldpos[1] = e.pageY;\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].refreshLayerRectangle();\n    }\n  });\n  document.getElementById(\"canvas_area\").addEventListener(\"wheel\", function (e) {\n    if (!e.ctrlKey) {\n      return;\n    }\n\n    var doc = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc;\n    var add = 0;\n    e.preventDefault();\n\n    if (e.buttons & 4) {\n      return;\n    }\n\n    if (event.deltaY > 0) {\n      if (doc.scale <= 100) {\n        doc.scale /= 2;\n      } else {\n        doc.scale -= 100;\n      }\n    } else {\n      if (doc.scale <= 100) {\n        doc.scale *= 2;\n      } else {\n        doc.scale += 100;\n      }\n    }\n\n    if (doc.scale < 25) {\n      doc.scale = 25;\n    }\n\n    if (doc.scale > 2000) {\n      doc.scale = 2000;\n    }\n\n    if (doc.scale > 100) {\n      preview.style.imageRendering = \"pixelated\";\n    } else {\n      preview.style.imageRendering = \"auto\";\n    }\n\n    var cx = canvas_field.scrollX + canvas_field.clientWidth / 2;\n    var cy = canvas_field.scrollY + canvas_field.clientHeight / 2;\n    preview.style.width = preview.width * doc.scale / 100 + \"px\";\n    preview.style.height = preview.height * doc.scale / 100 + \"px\"; //Redraw.refreshPreviewStatus(e);\n  });\n  var a = document.getElementById(\"save_hpd\");\n  a.addEventListener(\"contextmenu\", _file_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].saveHpd);\n  a.addEventListener(\"click\", _file_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].saveHpd);\n  a = document.getElementById(\"save_ldr\");\n  a.addEventListener(\"contextmenu\", _file_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].saveLdr);\n  a.addEventListener(\"click\", _file_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].saveLdr);\n  a = document.getElementById(\"save_hdr\");\n  a.addEventListener(\"contextmenu\", _file_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].saveHdr);\n  a.addEventListener(\"click\", _file_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].saveHdr);\n  var url = location.search.substring(1, location.search.length);\n  var args = url.split(\"&\");\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.set(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.draw_col, 0.8, 0.2, 0.2, 1);\n\n  for (i = args.length; i--;) {\n    var arg = args[i].split(\"=\");\n\n    if (arg.length > 1) {\n      var name = arg[0];\n\n      if (!isNaN(arg[1]) && arg[1] != \"\") {\n        if (arg[1].length > 1 && arg[1].indexOf(0) == \"0\") {\n          globalParam[name] = arg[1];\n        } else {\n          globalParam[name] = +arg[1];\n        }\n      } else {\n        globalParam[name] = arg[1];\n      }\n    }\n\n    if (inputs.hasOwnProperty(name)) {\n      if ((inputs[name].type == \"checkbox\" || inputs[name].type == \"radio\") && globalParam[name]) {\n        inputs[name].checked = true;\n      } else {\n        inputs[name].value = globalParam[name];\n      }\n\n      _lib_util_js__WEBPACK_IMPORTED_MODULE_12__[\"default\"].fireEvent(inputs[name], \"input\");\n    }\n  }\n\n  if (globalParam.hasOwnProperty(\"file\")) {\n    //パラメタ渡されてる場合はそれ開く\n    _file_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].loadHpd(globalParam.file); //Util.loadBinary(globalParam.file,function(buffer){\n    //\tloadHpd(buffer);\n    //});\n  } else {\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].root_layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].createLayer(new _lib_img_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"](1, 1), 1); //Hdrpaint.executeCommand(\"resizeLayer\",{\"layer_id\":root_layer.id,\"width\":512,\"height\":512});\n\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"resizeCanvas\", {\n      \"width\": 512,\n      \"height\": 512\n    });\n    var canvas_field = document.querySelector(\"#canvas_field\");\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.canvas_pos[0] = canvas_field.clientWidth - 512 >> 1;\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.canvas_pos[1] = canvas_field.clientHeight - 512 >> 1;\n    preview.style.left = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.canvas_pos[0] + \"px\";\n    preview.style.top = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.canvas_pos[1] + \"px\";\n    _commandlog_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].reset();\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"createNewLayer\", {\n      \"position\": 1,\n      \"parent\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].root_layer.id,\n      \"width\": preview.width,\n      \"height\": preview.height\n    });\n    var layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].root_layer.children[0];\n    layer.name = \"default\";\n    layer.refreshDiv();\n    layer.registRefreshThumbnail();\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].root_layer.refreshDiv();\n  }\n\n  binder.bind(document.querySelector(\"#status2\"), \"\", _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"], [\"cursor_pos.0\", \"cursor_pos.1\"], v => {\n    var img = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].root_layer.img;\n    var data = img.data;\n    var width = img.width;\n    var height = img.height;\n\n    if (v[0] < 0 || v[1] < 0 || v[0] >= width || v[1] >= height) {\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_color[0] = NaN;\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_color[1] = NaN;\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_color[2] = NaN;\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_color[3] = NaN;\n      return \"倍率\" + \"X:- Y:-\";\n    }\n\n    var idx = img.getIndex(v[0] | 0, v[1] | 0) << 2;\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_color[0] = data[idx];\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_color[1] = data[idx + 1];\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_color[2] = data[idx + 2];\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_color[3] = data[idx + 3];\n    return \"倍率\" + \"X:\" + v[0] + \" Y:\" + v[1];\n  });\n\n  var f = v => isNaN(v[0]) ? \"-\" : v[0].toFixed(3);\n\n  binder.bind(document.querySelector(\"#pos_R\"), \"\", _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"], [\"cursor_color.0\"], f);\n  binder.bind(document.querySelector(\"#pos_G\"), \"\", _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"], [\"cursor_color.1\"], f);\n  binder.bind(document.querySelector(\"#pos_B\"), \"\", _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"], [\"cursor_color.2\"], f);\n  binder.bind(document.querySelector(\"#pos_A\"), \"\", _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"], [\"cursor_color.3\"], f);\n  _brush_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].init();\n  var brush = _brush_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].create();\n  var brush1 = brush;\n  brush.name = \"ペン\";\n  brush.shortcut = \"a\";\n  brush.weight_pressure_effect = true;\n  brush.weight = 5;\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].brushes.push(brush);\n  brush.refresh();\n  brush = _brush_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].create();\n  brush.name = \"消しゴム\";\n  brush.eraser = true;\n  brush.shortcut = \"s\";\n  brush.weight = 10;\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].brushes.push(brush);\n  brush.refresh();\n  _brush_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].refreshBrush();\n  brush1.select();\n  binder.init(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"]); //\tvar nodes = document.querySelectorAll(\"[bind\\\\:]\");\n  //\tnodes.forEach((node)=>{\n  //\t\tconst bind = binder.binds.find(function(elem){return elem.node===node});\n  //\t\tif(!bind)return;\n  //\t\tnode.addEventListener(\"change\",function(){\n  //\t\t\tbind.feedBackValue(this.value);\n  //\t\t});\n  //\t});\n  //\n};\n\nvar selectorhdr = new _lib_colorselector_js__WEBPACK_IMPORTED_MODULE_14__[\"default\"]();\ndocument.querySelector(\"#color_selector\").appendChild(selectorhdr.div);\n\nselectorhdr.changeCallback = function () {\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].color[0] = Number(this.R_txt.value);\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].color[1] = Number(this.G_txt.value);\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].color[2] = Number(this.B_txt.value);\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].color[3] = Number(this.A_txt.value);\n  _brush_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].refreshPreview();\n};\n\n_lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.set(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].color, 1, 0.5, 0.5, 1);\nselectorhdr.setColor(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].color);\ndocument.body.onload = onloadfunc;\n\n//# sourceURL=webpack://hdrpaint/./src/main.js?");

/***/ }),

/***/ "./src/modifier/blur.js":
/*!******************************!*\
  !*** ./src/modifier/blur.js ***!
  \******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_slider_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/slider.js */ \"./src/lib/slider.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n\n\n\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].registModifier(class extends _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"] {\n  constructor() {\n    super();\n    this.scale = 16;\n  }\n\n  showDivParam() {\n    return \"blursize:\" + this.scale;\n  }\n\n  before(area) {\n    var size = Math.ceil(this.scale) * 2;\n    area[0] -= size;\n    area[1] -= size;\n    area[2] += size << 1;\n    area[3] += size << 1;\n  }\n\n  reflect(img, composite_area) {\n    var scale = Math.ceil(this.scale);\n    composite_area[0] += scale;\n    composite_area[1] += scale;\n    composite_area[2] -= scale << 1;\n    composite_area[3] -= scale << 1;\n    var x = Math.max(0, composite_area[0] - img.offsetx);\n    var y = Math.max(0, composite_area[1] - img.offsety);\n    var x1 = Math.min(img.width, composite_area[2] + x);\n    var y1 = Math.min(img.height, composite_area[3] + y);\n    img.gauss(scale >> 1, scale, x, y, x1 - x, y1 - y);\n  }\n\n}, \"blur\", `ぼかし半径:<input class=\"slider modifier_scale\" name=\"scale\" step=\"1\" min=\"1\" max=\"128\" ><br>`);\n_lib_slider_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].init();\n\n//# sourceURL=webpack://hdrpaint/./src/modifier/blur.js?");

/***/ }),

/***/ "./src/modifier/colormap.js":
/*!**********************************!*\
  !*** ./src/modifier/colormap.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n\n\n\nvar clip = function (v, min, max) {\n  return Math.max(min, Math.min(max, v));\n};\n\nclass ColorMap extends _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"] {\n  constructor() {\n    super();\n    this.effect = 4;\n    this.children = [];\n    this.gradtype = \"0\";\n  }\n\n  showDivParam() {\n    return \"gradtype:\" + this.gradtype;\n  }\n\n  beforeReflect() {\n    if (this.children.length < 1) {\n      return;\n    }\n\n    this.children[0].beforeReflect();\n  }\n\n  reflect(img, composite_area) {\n    var x = Math.max(0, composite_area[0]);\n    var y = Math.max(0, composite_area[1]);\n    var x1 = Math.min(this.parent.size[0], composite_area[2] + x);\n    var y1 = Math.min(this.parent.size[1], composite_area[3] + y);\n    var layer = this;\n    var offx = img.offsetx;\n    var offy = img.offsety;\n    img.scan(function (r, idx, x, y) {\n      layer.getPixel(r, idx, x + offx, y + offy);\n    }, x - img.offsetx, y - img.offsety, x1 - x, y1 - y);\n  }\n\n  getPixel(ret_pixel, idx, x, y) {\n    if (this.children.length < 1) {\n      return;\n    }\n\n    if (y === undefined) {\n      y = x;\n      x = idx;\n      idx = 0;\n    }\n\n    var total;\n\n    if (this.gradtype === \"0\") {\n      total = (ret_pixel[idx] + ret_pixel[idx + 1] + ret_pixel[idx + 2]) * 0.33333;\n    } else {\n      total = ret_pixel[idx + 3];\n    }\n\n    total = clip(total, 0, 1);\n    var a = ret_pixel[idx + 3];\n    var child = this.children[0];\n    child.getPixel(ret_pixel, idx, total * (child.size[0] - 1), 0);\n  }\n\n}\n\n;\nvar html = `\n\t\t<label><input type=\"radio\" name=\"gradtype\"  value=\"0\" />明るさで判定</label>\n\t\t<label><input type=\"radio\" name=\"gradtype\"  value=\"1\" />アルファ値で判定</label>\n\t`;\nColorMap.prototype.name = \"colormap\";\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].registModifier(ColorMap, \"colormap\", html);\n\n//# sourceURL=webpack://hdrpaint/./src/modifier/colormap.js?");

/***/ }),

/***/ "./src/modifier/gradient.js":
/*!**********************************!*\
  !*** ./src/modifier/gradient.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _lib_slider_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/slider.js */ \"./src/lib/slider.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n\n\n\n\n\nvar arr = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec4();\nvar backimg = new _lib_img_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](128, 1);\nvar points = new Array();\n\nfor (var i = 0; i < 4; i++) {\n  var point = {};\n  point.color = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec4();\n  point.pos = 0.0;\n  points.push(point);\n}\n\nvar width, height;\nvar mat33 = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Mat33();\n\nvar _mat33 = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Mat33();\n\nclass Gradient extends _layer_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"] {\n  constructor() {\n    super();\n\n    for (var i = 0; i < 4; i++) {\n      var nam = \"col\" + i;\n      this[nam] = \"0,0,0,1\";\n      this[nam + \"pos\"] = 1;\n    }\n\n    this[\"col1\"] = \"1,1,1,1\";\n    this.col0pos = 0;\n    this.col1pos = 1;\n    this.radius = 0;\n  }\n\n  showDivParam() {\n    //\n    //\t\tvar layer = this;\n    //\t\tlayer.beforeReflect();\n    //\t\tmat33[0]=1/128;\n    //\t\tmat33[1]=1;\n    //\t\twidth=64;\n    //\t\theight=0;\n    //\t\tbackimg.scan(function(ret,idx,x,y){layer.getPixel(ret,idx,x,y);});\n    //\t\tlayer.dom.style.backgroundImage = \"url(\" + backimg.toDataURL() + \"),url(./back.png)\";\n    //\n    return \"\";\n  }\n\n  beforeReflect(img) {\n    for (var i = 0; i < 4; i++) {\n      var nam = \"col\" + i;\n      var a = this[nam].split(\",\");\n      points[i].color[0] = 0;\n      points[i].color[1] = 0;\n      points[i].color[2] = 0;\n      points[i].color[3] = 0;\n\n      if (a.length === 4) {\n        points[i].color[0] = Number(a[0]);\n        points[i].color[1] = Number(a[1]);\n        points[i].color[2] = Number(a[2]);\n        points[i].color[3] = Number(a[3]);\n      }\n\n      points[i].pos = this[nam + \"pos\"];\n    }\n\n    points.sort(function (a, b) {\n      return a.pos - b.pos;\n    });\n\n    for (var i = 1; i < 4; i++) {\n      points[i]._r = points[i].pos - points[i - 1].pos;\n\n      if (points[i]._r) {\n        points[i]._r = 1.0 / points[i]._r;\n      }\n    }\n\n    var parent = this.parent;\n\n    if (parent) {\n      width = parent.size[0];\n      height = parent.size[1];\n    }\n\n    if (img) {\n      width = img.width;\n      height = img.height;\n    }\n\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Mat33.rotate(mat33, this.radius * Math.PI / 180, 0, 0, 1);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Mat33.set(_mat33, 1 / width, 0, 0, 0, 1 / height, 0, 0, 0, 1);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Mat33.dot(mat33, mat33, _mat33);\n    width = width >> 1;\n    height = height >> 1;\n  }\n\n  reflect(img, area) {\n    var layer = this;\n    var offx = -this.position[0] + img.offsetx;\n    var offy = -this.position[1] + img.offsety;\n    img.scan(function (ret, idx, x, y) {\n      layer.getPixel(arr, x + offx, y + offy);\n      ret[idx + 0] = arr[0];\n      ret[idx + 1] = arr[1];\n      ret[idx + 2] = arr[2];\n      ret[idx + 3] = arr[3];\n    }, area[0] - img.offsetx, area[1] - img.offsety, area[2], area[3]);\n  }\n\n  getPixel(ret, x, y) {\n    var b = mat33[0] * (x - width) + mat33[1] * (y - height) + 0.5;\n    b = Math.max(0, Math.min(b, 1));\n    var i = 1;\n\n    for (; i < 3; i++) {\n      if (b <= points[i].pos) {\n        break;\n      }\n    }\n\n    b = (b - points[i - 1].pos) * points[i]._r;\n    b = Math.max(0, Math.min(b, 1));\n    var color0 = points[i - 1].color;\n    var color1 = points[i].color;\n    var a = 1 - b;\n    ret[0] = color0[0] * a + color1[0] * b;\n    ret[1] = color0[1] * a + color1[1] * b;\n    ret[2] = color0[2] * a + color1[2] * b;\n    ret[3] = color0[3] * a + color1[3] * b;\n  }\n\n}\n\nvar html = `\n\t\t角度:<input class=\"slider modifier_scale\" name=\"radius\" value=\"0\" min=\"0\" max=\"360\"><br>\n\n\t\t<div class=\"modifier_gradient \">\n\t\tR,G,B,A pos<br>\n\t\t<ul>\n\t\t<li>\n\t\t<input type=\"text\" class=\"col colorpickerhdr\" name=\"col0\">\n\t\t<input class=\"slider pos\" name=\"col0pos\" min=\"0\" max=\"1\">\n\t\t</li>\n\n\t\t<li>\n\t\t<input type=\"text\" class=\"col colorpickerhdr\" name=\"col1\">\n\t\t<input class=\"slider pos\" name=\"col1pos\" min=\"0\" max=\"1\">\n\t\t</li>\n\n\t\t<li>\n\t\t<input type=\"text\" class=\"col colorpickerhdr\" name=\"col2\">\n\t\t<input class=\"slider pos\" name=\"col2pos\" min=\"0\" max=\"1\">\n\t\t</li>\n\n\t\t<li>\n\t\t<input type=\"text\" class=\"col colorpickerhdr\" name=\"col3\">\n\t\t<input class=\"slider pos\" name=\"col3pos\" min=\"0\" max=\"1\">\n\t\t</li>\n\t\t</ul>\n\n\t\t</div>\n\t\t`;\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].registModifier(Gradient, \"gradient\", html);\n_lib_slider_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].init();\n\n//# sourceURL=webpack://hdrpaint/./src/modifier/gradient.js?");

/***/ }),

/***/ "./src/modifier/grayscale.js":
/*!***********************************!*\
  !*** ./src/modifier/grayscale.js ***!
  \***********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n\n\nvar img;\nvar img_data;\n\nclass Grayscale extends _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"] {\n  constructor() {\n    super();\n    this.children = null;\n  }\n\n  beforeReflect() {}\n\n  reflect(_img, composite_area) {\n    this.beforeReflect();\n    img = _img;\n    img_data = img.data;\n    var x = Math.max(0, composite_area[0]);\n    var y = Math.max(0, composite_area[1]);\n    var x1 = Math.min(this.parent.size[0], composite_area[2] + x);\n    var y1 = Math.min(this.parent.size[1], composite_area[3] + y);\n    var layer = this;\n    img.scan(layer.getPixel, x - img.offsetx, y - img.offsety, x1 - x, y1 - y);\n  }\n\n  getPixel(ret, idx, x, y) {\n    if (y == undefined) {\n      y = x;\n      x = idx;\n      idx = 0;\n    }\n\n    if (!img) {\n      return;\n    }\n\n    var idx = img.getIndex(x, y) << 2;\n    var total = img_data[idx] + img_data[idx + 1] + img_data[idx + 2];\n    total *= 0.33333;\n    ret[idx + 0] = total;\n    ret[idx + 1] = total;\n    ret[idx + 2] = total;\n    ret[idx + 3] = img_data[idx + 3];\n  }\n\n}\n\nGrayscale.prototype.name = \"grayscale\";\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].registModifier(Grayscale, \"grayscale\", \"\");\n\n//# sourceURL=webpack://hdrpaint/./src/modifier/grayscale.js?");

/***/ }),

/***/ "./src/modifier/noise.js":
/*!*******************************!*\
  !*** ./src/modifier/noise.js ***!
  \*******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_slider_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/slider.js */ \"./src/lib/slider.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _lib_noise_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/noise.js */ \"./src/lib/noise.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n\n\n\n\nvar scale;\nvar octave;\n\nvar _total;\n\nvar betsu;\nvar z;\nvar func;\nvar funcs = {\n  \"perlin\": _lib_noise_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].perlinnoise,\n  \"simplex\": _lib_noise_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].simplexnoise,\n  \"value\": _lib_noise_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].valuenoise\n};\n\nclass _Noise extends _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"] {\n  constructor() {\n    super();\n    this.scale = 128;\n    this.zoffset = 0;\n    this.octave = 0;\n    this.betsu = false;\n    this.func = \"simplex\";\n    this.children = null;\n  }\n\n  beforeReflect() {\n    scale = 1 / this.scale;\n    octave = Number(this.octave);\n    _total = 1 / ((1 << octave + 1) - 1);\n    betsu = this.betsu;\n    func = funcs[this.func];\n    z = this.zoffset;\n  }\n\n  reflect(img, composite_area) {\n    var x = composite_area[0];\n    var y = composite_area[1];\n    var w = composite_area[2];\n    var h = composite_area[3];\n    this.beforeReflect();\n    var layer = this;\n    var offx = -this.position[0] + img.offsetx;\n    var offy = -this.position[1] + img.offsety;\n    img.scan(function (r, idx, x, y) {\n      layer.calcPixel(r, idx, x + offx, y + offy);\n    }, x - img.offsetx, y - img.offsety, w, h);\n  }\n\n  getPixel(ret, x, y) {\n    this.calcPixel(ret, 0, x, y);\n  }\n\n  calcPixel(ret, idx, x, y) {\n    var r = 0;\n    var scale2 = scale;\n    var pow = 1 << octave;\n    var nmax = 1;\n\n    if (betsu) {\n      nmax = 3;\n    }\n\n    for (var n = 0; n < nmax; n++) {\n      r = 0;\n\n      for (var i = 0; i < octave + 1; i++) {\n        scale2 = (1 << i) * scale;\n        r += func(x * scale2 + i * 0.123 + n * 0.321, y * scale2 + i * 0.123 + n * 0.321, z * scale2 + i * 0.123 + n) * (1 << octave - i);\n      }\n\n      ret[n + idx] = r * _total;\n    }\n\n    if (!betsu) {\n      ret[1 + idx] = ret[0 + idx];\n      ret[2 + idx] = ret[0 + idx];\n    }\n\n    ret[3 + idx] = 1;\n  }\n\n}\n\n;\nvar html = `\n\t\t\tfunc:<select class=\"modifier_func\" name=\"func\">\n\t\t\t\t<option value=\"perlin\">Perlin</option>\n\t\t\t\t<option value=\"simplex\">Simplex</option>\n\t\t\t\t<option value=\"value\">Value</option>\n\t\t\t\t</select><br>\n\t\t\tスケール:<input class=\"slider modifier_scale\" name=\"scale\" value=\"32\" min=\"1\" max=\"256\"><br>\n\t\t\tオクターブ数:<input class=\"slider modifier_octabe\" name=\"octave\" value=\"0\" min=\"0\" max=\"10\" step=\"1\"><br>\n\t\t\tZ(seed):<input class=\"slider modifier_z\" name=\"zoffset\" max=\"255\"><br>\n\t\t\trgb別:<input type=\"checkbox\" class=\"modifier_betsu\" name=\"betsu\"><br>\n\t\t`;\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].registModifier(_Noise, \"noise\", html);\n_lib_slider_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].init();\n\n//# sourceURL=webpack://hdrpaint/./src/modifier/noise.js?");

/***/ }),

/***/ "./src/modifier/shift.js":
/*!*******************************!*\
  !*** ./src/modifier/shift.js ***!
  \*******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\n\nvar ret_pixel = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec4();\nvar bufimg = new _lib_img_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](1024, 1024);\nvar layer;\nvar xmod = 1;\nvar ymod = 1;\nvar offx;\nvar offy;\n\nvar clip = function (v, min, max) {\n  return Math.max(min, Math.min(max, v));\n};\n\nclass Shift extends _layer_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"] {\n  constructor() {\n    super();\n\n    _defineProperty(this, \"beforeReflect\", function () {\n      offx = 0;\n      offy = 0;\n\n      if (this.children.length >= 1) {\n        var child = this.children[0];\n        child.beforeReflect();\n        offx = -this.position[0] - child.position[0];\n        offy = -this.position[1] - child.position[1];\n      }\n    });\n\n    this.effect = 4;\n    this.children = [];\n  }\n\n  before(area) {\n    var size = this.effect;\n    area[0] -= size;\n    area[1] -= size;\n    area[2] += size << 1;\n    area[3] += size << 1;\n  }\n\n  reflect(img, composite_area) {\n    var scale = this.effect >> 1;\n    composite_area[0] += scale;\n    composite_area[1] += scale;\n    composite_area[2] -= scale << 1;\n    composite_area[3] -= scale << 1;\n\n    if (bufimg.data.length < img.data.length) {\n      bufimg = new _lib_img_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](img.width, img.height);\n    }\n\n    bufimg.width = img.width;\n    bufimg.height = img.height;\n    bufimg.offsetx = img.offsetx;\n    bufimg.offsety = img.offsety;\n    _lib_img_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].copy(bufimg, 0, 0, img, 0, 0, img.width, img.height);\n    this.beforeReflect();\n    var x = Math.max(0, composite_area[0]);\n    var y = Math.max(0, composite_area[1]);\n    var x1 = Math.min(this.parent.size[0], composite_area[2] + x);\n    var y1 = Math.min(this.parent.size[1], composite_area[3] + y);\n    var imgdata = img.data;\n\n    for (var j = y; j < y1; j++) {\n      var idx = img.getIndex(x - img.offsetx, j - img.offsety) << 2;\n\n      for (var i = x; i < x1; i++) {\n        this.getPixel(ret_pixel, i, j);\n        imgdata[idx + 0] = ret_pixel[0];\n        imgdata[idx + 1] = ret_pixel[1];\n        imgdata[idx + 2] = ret_pixel[2];\n        imgdata[idx + 3] = ret_pixel[3];\n        idx += 4;\n      }\n    }\n  }\n\n  getPixel(ret_pixel, x, y) {\n    var img = bufimg;\n    var sx = 0;\n    var sy = 0;\n\n    if (this.children.length >= 1) {\n      var child = this.children[0];\n      child.getPixel(ret_pixel, x + offx, y + offy);\n      sx = ret_pixel[0] - 0.5;\n      sy = ret_pixel[1] - 0.5; //sz = ret_pixel[2]-0.5;\n\n      var pow = this.effect;\n      sx = sx * pow | 0;\n      sy = sy * pow | 0; //sz = sz* pow|0;\n    }\n\n    var d_idx2 = img.getIndex(clip(x + sx - img.offsetx, 0, img.width - 1), clip(y + sy - img.offsety, 0, img.height - 1)) << 2;\n    ret_pixel[0] = img.data[d_idx2 + 0];\n    ret_pixel[1] = img.data[d_idx2 + 1];\n    ret_pixel[2] = img.data[d_idx2 + 2];\n    ret_pixel[3] = img.data[d_idx2 + 3];\n  }\n\n}\n\nvar html = `\n\t\t\t影響度:<input type=\"text\" class=\"slider modifier_effect\" name=\"effect\" value=\"0.5\" min=\"0\" max=\"100\">\n\t\t`;\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].registModifier(Shift, \"shift\", html);\n\n//# sourceURL=webpack://hdrpaint/./src/modifier/shift.js?");

/***/ }),

/***/ "./src/penfunc.js":
/*!************************!*\
  !*** ./src/penfunc.js ***!
  \************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ PenFunc; }\n/* harmony export */ });\n/* harmony import */ var _lib_util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lib/util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./layer.js */ \"./src/layer.js\");\n\n\n\nvar id = -1;\nclass PenFunc {\n  constructor() {\n    this.pen_log = null;\n    this.endFlg = 0;\n    this.idx = 0;\n    this.ragtime = 0;\n    var aaa = this;\n    setTimeout(function () {\n      aaa.actualDraw();\n    }, 1);\n  }\n\n  end() {\n    this.endFlg = 1;\n  }\n\n  actualDraw() {\n    var aaa = this;\n    var log = this.pen_log;\n    var points = log.obj.param.points;\n\n    if (id >= 0) {\n      clearTimeout(id);\n      id = -1;\n    }\n\n    if (this.endFlg && points.length <= this.idx) {\n      var layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(log.obj.param.layer_id);\n      var funcs = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].blendfuncs;\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].painted_mask.fill(0);\n      return;\n    }\n\n    if (points.length <= this.idx) {\n      id = setTimeout(function () {\n        aaa.actualDraw();\n      }, 16);\n      return;\n    }\n\n    var now = Date.now();\n    var org = points[this.idx];\n    var d = this.ragtime - (now - org.time);\n\n    if (d > 0) {\n      id = setTimeout(function () {\n        aaa.actualDraw();\n      }, d * 0.5);\n      return;\n    }\n\n    if (this.idx >= 1) {\n      //ログ文面変更\n      log.refreshLabel(); //今回と前回の座標で直線描画\n\n      log.obj.draw(this.idx);\n    }\n\n    this.idx++;\n\n    if (points.length <= this.idx) {\n      id = setTimeout(function () {\n        aaa.actualDraw();\n      }, 16);\n      return;\n    }\n\n    d = Math.max(this.ragtime - (now - org.time), 1);\n    id = setTimeout(function () {\n      aaa.actualDraw();\n    }, d * 0.5);\n    return;\n  }\n\n}\n\n//# sourceURL=webpack://hdrpaint/./src/penfunc.js?");

/***/ }),

/***/ "./src/penpoint.js":
/*!*************************!*\
  !*** ./src/penpoint.js ***!
  \*************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ PenPoint; }\n/* harmony export */ });\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lib/vector.js */ \"./src/lib/vector.js\");\n\nclass PenPoint {\n  constructor() {\n    this.pos = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\n    this.pressure = 1;\n  }\n\n}\n\n//# sourceURL=webpack://hdrpaint/./src/penpoint.js?");

/***/ }),

/***/ "./src/redraw.js":
/*!***********************!*\
  !*** ./src/redraw.js ***!
  \***********************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Redraw; }\n/* harmony export */ });\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _lib_util_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lib/util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./layer.js */ \"./src/layer.js\");\n\n\n\n\n\nvar absolute = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\nvar refresh_stack = [];\n\nvar refreshMain_ = function () {\n  if (Redraw.refreshoff) {\n    //更新禁止フラグが立っている場合は処理しない\n    return;\n  }\n\n  if (refresh_stack.length === 0) {\n    return;\n  }\n\n  for (var ri = 0; ri < refresh_stack.length; ri++) {\n    var r = refresh_stack[ri];\n    refreshMain_sub(r.step, r.x, r.y, r.w, r.h);\n  }\n\n  refresh_stack = []; //if(refresh_stack.length>0){\n  //\twindow.requestAnimationFrame(function(e){\n  //\t\trefreshMain_();\n  //\t});\n  //}\n};\n\nvar refreshMain_sub = function (step, x, y, w, h) {\n  //プレビュー画面を更新\n  if (typeof step === 'undefined') {\n    step = 0;\n  }\n\n  var bloom_size = parseFloat(Hdrpaint.post_effect.bloom_size);\n  var joined_img = Hdrpaint.root_layer.img; //引数無しの場合、デフォルトで更新領域は全域\n\n  var left = 0;\n  var right = joined_img.width;\n  var top = 0;\n  var bottom = joined_img.height;\n  var joined_img_data = joined_img.data;\n  var joined_img_width = joined_img.width;\n\n  if (w) {\n    left = x;\n    right = x + w;\n    top = y;\n    bottom = y + h; //更新領域設定、はみ出している場合はクランプする\n\n    left -= bloom_size;\n    right += bloom_size;\n    top -= bloom_size;\n    bottom += bloom_size;\n    left = Math.max(0, left);\n    right = Math.min(joined_img.width, right);\n    top = Math.max(0, top);\n    bottom = Math.min(joined_img.height, bottom);\n    left = Math.floor(left);\n    right = Math.ceil(right);\n    top = Math.floor(top);\n    bottom = Math.ceil(bottom);\n  }\n\n  var width = right - left;\n  var height = bottom - top;\n  var flg_active_layer_only = inputs[\"selected_layer_only\"].checked;\n\n  if (flg_active_layer_only) {\n    //選択レイヤのみ表示\n    var img = bloom_img;\n    var img_data = img.data;\n    var img_width = img.width;\n    var layer = Hdrpaint.selected_layer;\n    bloom_img.clear(left, top, width, height);\n    layer.getAbsolutePosition(absolute);\n\n    if (layer.typename === \"normal_layer\") {\n      bloom_img.copy(left, top, layer.img, left - absolute[0], top - absolute[1], width, height);\n    } else {\n      layer.beforeReflect();\n      bloom_img.scan(function (ret, idx, x, y) {\n        layer.getPixel(ret, idx, x - absolute[0], y - absolute[1]);\n      }, left, top, width, height);\n    }\n  } else {\n    if (step <= 0) {\n      if (Hdrpaint.post_effect.ch_bloom) {\n        //ブルーム処理ありの場合は前処理を行う\n        bloom_img.copy(left - bloom_size, top - bloom_size, Hdrpaint.root_layer.img, left - bloom_size, top - bloom_size, right - left + bloom_size * 2, bottom - top + bloom_size * 2);\n        bloom_img.gauss(bloom_size >> 1, bloom_size, left, top, right - left, bottom - top);\n        bloomed_img.copy(left, top, bloom_img, left, top, right - left, bottom - top);\n      }\n    } //ブルーム処理\n    //ブルーム前の絵はjoined_imgに残し、結果はbloomed_imgに出力\n\n\n    if (step <= 1) {\n      var bloom = parseFloat(Hdrpaint.post_effect.bloom_power);\n\n      var _bloom = 1 - bloom;\n\n      var bloom_img_data = bloom_img.data;\n      var bloomed_img_data = bloomed_img.data;\n\n      if (Hdrpaint.post_effect.ch_bloom && bloom > 0) {\n        for (var yi = top; yi < bottom; yi++) {\n          var idx = yi * joined_img_width + left << 2;\n          var max = yi * joined_img_width + right << 2;\n\n          for (; idx < max; idx += 4) {\n            bloom_img_data[idx] = joined_img_data[idx] * _bloom + bloomed_img_data[idx] * bloom;\n            bloom_img_data[idx + 1] = joined_img_data[idx + 1] * _bloom + bloomed_img_data[idx + 1] * bloom;\n            bloom_img_data[idx + 2] = joined_img_data[idx + 2] * _bloom + bloomed_img_data[idx + 2] * bloom;\n            bloom_img_data[idx + 3] = joined_img_data[idx + 3];\n          }\n        }\n      } else {\n        bloom_img.copy(left, top, joined_img, left, top, width, height);\n      }\n    }\n  }\n\n  if (step <= 2) {\n    //ガンマ補正とトーンマッピング\n    var ctx_imagedata_data = preview_ctx_imagedata.data;\n    var ev = parseFloat(Hdrpaint.post_effect.ev);\n    var gamma = 1.0 / parseFloat(Hdrpaint.post_effect.gamma);\n    joined_img_data = bloom_img.data;\n\n    if (Hdrpaint.post_effect.ch_gamma) {\n      var r = Math.pow(2, -ev);\n\n      for (var yi = top; yi < bottom; yi++) {\n        var idx = yi * joined_img_width + left << 2;\n        var max = yi * joined_img_width + right << 2;\n\n        for (; idx < max; idx += 4) {\n          ctx_imagedata_data[idx + 0] = Math.pow(joined_img_data[idx + 0] * r, gamma) * 255;\n          ctx_imagedata_data[idx + 1] = Math.pow(joined_img_data[idx + 1] * r, gamma) * 255;\n          ctx_imagedata_data[idx + 2] = Math.pow(joined_img_data[idx + 2] * r, gamma) * 255;\n          ctx_imagedata_data[idx + 3] = joined_img_data[idx + 3] * 255;\n        }\n      }\n    } else {\n      var r = Math.pow(2, -ev) * 255;\n\n      for (var yi = top; yi < bottom; yi++) {\n        var idx = yi * joined_img_width + left << 2;\n        var max = yi * joined_img_width + right << 2;\n\n        for (; idx < max; idx += 4) {\n          ctx_imagedata_data[idx + 0] = joined_img_data[idx + 0] * r;\n          ctx_imagedata_data[idx + 1] = joined_img_data[idx + 1] * r;\n          ctx_imagedata_data[idx + 2] = joined_img_data[idx + 2] * r;\n          ctx_imagedata_data[idx + 3] = joined_img_data[idx + 3] * 255;\n        }\n      }\n    }\n  } //結果をキャンバスに表示\n\n\n  preview_ctx.putImageData(preview_ctx_imagedata, 0, 0, left, top, right - left, bottom - top);\n};\n\nlet refreshoff = 0;\nclass Redraw {\n  constructor() {}\n\n  static disableRefresh() {\n    refreshoff = true;\n  }\n\n  static enableRefresh() {\n    refreshoff = false;\n  }\n\n  static refreshPreview(step, x, y, w, h) {\n    if (refresh_stack.length === 1) {\n      //全更新がある場合は無視\n      if (refresh_stack[0].step === 0 && refresh_stack[0].w === 0) {\n        return;\n      }\n    }\n\n    if (typeof x === 'undefined') {\n      //全更新の場合はコレまでのは無視する\n      refresh_stack = [];\n      x = 0;\n      y = 0;\n      w = Hdrpaint.root_layer.img.width;\n      h = Hdrpaint.root_layer.img.height;\n    }\n\n    var refresh_data = {};\n    refresh_data.step = step;\n    refresh_data.x = x;\n    refresh_data.y = y;\n    refresh_data.w = w;\n    refresh_data.h = h;\n    refresh_stack.push(refresh_data);\n\n    if (refresh_stack.length === 1) {\n      window.requestAnimationFrame(function (e) {\n        refreshMain_();\n      });\n    }\n  }\n\n  static compositeAll() {\n    //全レイヤ更新\n    var f = function (layer, left, top, right, bottom) {\n      if (layer.type !== _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].COMPOSITE) {\n        return;\n      }\n\n      var lower_layers = layer.children;\n\n      for (var li = 0; li < lower_layers.length; li++) {\n        var lower_layer = lower_layers[li];\n        f(lower_layer, left, top, right, bottom);\n      }\n\n      layer.composite(left, top, right, bottom);\n    };\n\n    f(Hdrpaint.root_layer);\n  }\n\n  static refreshPreviewStatus(e) {\n    //カーソル下情報表示\n    var img = Hdrpaint.root_layer.img;\n    var data = img.data;\n    var doc = Hdrpaint.doc;\n    var x = Hdrpaint.cursor_pos[0];\n    var y = Hdrpaint.cursor_pos[1];\n    var width = img.width;\n    var height = img.height;\n    var status2 = document.getElementById(\"status2\");\n    var r = 0;\n    var g = 0;\n    var b = 0;\n    var a = 0;\n\n    if (x < 0 || y < 0 || x >= width || y >= height) {\n      Hdrpaint.cursor_color[0] = NaN;\n      Hdrpaint.cursor_color[1] = NaN;\n      Hdrpaint.cursor_color[2] = NaN;\n      Hdrpaint.cursor_color[3] = NaN;\n    } else {\n      var idx = img.getIndex(x | 0, y | 0) << 2;\n      Hdrpaint.cursor_color[0] = data[idx];\n      Hdrpaint.cursor_color[1] = data[idx + 1];\n      Hdrpaint.cursor_color[2] = data[idx + 2];\n      Hdrpaint.cursor_color[3] = data[idx + 3];\n      g = data[idx + 1];\n      b = data[idx + 2];\n      a = data[idx + 3];\n      x.toFixed(2);\n      y.toFixed(2);\n      var str = \"倍率[scale]% X:[x],Y:[y]\";\n      str = str.replace(/\\[scale\\]/, doc.scale);\n      str = str.replace(/\\[x\\]/, x);\n      str = str.replace(/\\[y\\]/, y); //\t\t\tUtil.setText(status2,str );\n\n      _lib_util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].setText(document.getElementById(\"pos_R\"), r.toFixed(3));\n      _lib_util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].setText(document.getElementById(\"pos_G\"), g.toFixed(3));\n      _lib_util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].setText(document.getElementById(\"pos_B\"), b.toFixed(3));\n      _lib_util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].setText(document.getElementById(\"pos_A\"), a.toFixed(3));\n    }\n  }\n\n}\n\n//# sourceURL=webpack://hdrpaint/./src/redraw.js?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	!function() {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = function(exports, definition) {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	}();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	!function() {
/******/ 		__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }
/******/ 	}();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	!function() {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = function(exports) {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	}();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./src/index.js");
/******/ 	
/******/ })()
;